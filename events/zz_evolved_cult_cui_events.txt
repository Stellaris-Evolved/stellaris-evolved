
namespace = tec_cult_cui

country_event = {
    id = tec_cult_cui.1
    title = tec_blank
    desc = tec_blank
    is_triggered_only = yes
    diplomatic = yes
    custom_gui = "tec_cui_cult_view"
    trigger = { always = yes }

    immediate = {
        set_country_flag = tec_cui_cult_basic_tab_active
    }

    option = {
        name = tec_blank
        tec_reset_cult_cui = yes
    }

    abort_trigger = {
        has_active_event = {
            tec_cult_cui.5
            tec_cult_cui.7
        }
    }

    after = { tec_reset_cult_cui = yes }
}

country_event = {
    id = tec_cult_cui.2
    title = tec_cui_cult_title_activate_cult
    desc = tec_cui_cult_title_activate_cult_desc
    is_triggered_only = yes
    diplomatic = yes
    custom_gui = "tec_cui_confirm_view"
    trigger = { always = yes }

    option = {
        name = YES

        switch = {
            trigger = has_country_flag
            inline_script = {
                script = iterators/tec_iterate_cult
                code = "
                    tec_cui_cult_queue_$name$ = {
                        tec_activate_cult = {
                            cult = $name$
                            tooltip = yes
                        }
                    }
                "
            }
        }
        custom_gui = tec_cui_confirm_option_yes
    }

    option = {
        name = NO
        default_hide_option = yes
        custom_gui = tec_cui_confirm_option_no
    }

    after = {
        inline_script = {
            script = iterators/tec_iterate_cult
            code = "
                remove_country_flag = tec_cui_cult_queue_$name$
            "
        }
        remove_country_flag = tec_cui_cult_decision_pending
    }
}

country_event = {
    id = tec_cult_cui.3
    title = tec_cui_cult_title_deactivate_cult
    desc = tec_cui_cult_title_deactivate_cult_desc
    is_triggered_only = yes
    diplomatic = yes
    custom_gui = "tec_cui_confirm_view"
    trigger = { always = yes }

    option = {
        name = YES

        switch = {
            trigger = has_country_flag
            inline_script = {
                script = iterators/tec_iterate_cult
                code = "
                    tec_cui_cult_queue_$name$ = {
                        tec_deactivate_cult = {
                            cult = $name$
                            tooltip = yes
                        }
                    }
                "
            }
        }
        custom_gui = tec_cui_confirm_option_yes
    }

    option = {
        name = NO
        default_hide_option = yes
        custom_gui = tec_cui_confirm_option_no
    }

    after = {
        inline_script = {
            script = iterators/tec_iterate_cult
            code = "
                remove_country_flag = tec_cui_cult_queue_$name$
            "
        }
        remove_country_flag = tec_cui_cult_decision_pending
    }
}


country_event = {
    id = tec_cult_cui.4
    is_triggered_only = yes
    hide_window = yes


    trigger = { always = yes }

    immediate = {
        tec_clear_invalid_cults = yes
        tec_recalculate_cult_points = yes
    }
}


country_event = {
    id = tec_cult_cui.5
    title = tec_cult_cui.5.name
    desc = tec_cult_cui.5.desc
    is_triggered_only = yes
    diplomatic = yes
    custom_gui = "tec_cui_cult_view"
    auto_opens = no
    notification_event_icon = "GFX_message_unknown"

    trigger = { always = yes }

    immediate = {
        set_country_flag = tec_cui_cult_basic_tab_active
    }

    option = {
        name = tec_blank
        tec_reset_cult_cui = yes
    }

    abort_trigger = {
        has_active_event = {
            tec_cult_cui.1
            tec_cult_cui.7
        }
    }

    after = { tec_reset_cult_cui = yes }
}

# THIS = country
# Fired by: on_post_government_changed
country_event = {
    id = tec_cult_cui.6
    hide_window = yes
    is_triggered_only = yes

    immediate = {
        tec_clear_invalid_cults = yes
        tec_recalculate_cult_points = yes
    }
}

country_event = {
    id = tec_cult_cui.7
    title = tec_cult_cui.7.name
    desc = tec_cult_cui.7.desc
    is_triggered_only = yes
    diplomatic = yes
    custom_gui = "tec_cui_cult_view"
    auto_opens = no
    notification_event_icon = "GFX_message_unknown"

    trigger = { always = yes }

    immediate = {
        set_country_flag = tec_cui_cult_basic_tab_active
    }

    option = {
        name = tec_blank
        tec_reset_cult_cui = yes
    }

    abort_trigger = {
        has_active_event = {
            tec_cult_cui.1
            tec_cult_cui.5
        }
    }

    after = { tec_reset_cult_cui = yes }
}


country_event = {
    id = tec_cult_cui.8
    hide_window = yes
    is_triggered_only = yes

    trigger = {
        is_ai = no
        NOR = {
            has_active_event = {
                tec_cult_cui.1
                tec_cult_cui.5
                tec_cult_cui.7
            }
        }
        check_variable_arithmetic = {
            which = value:tec_cult_points_available
            value > 0
        }
    }

    immediate = {
        tec_internal_cult_points_available_alarm = yes
    }
}