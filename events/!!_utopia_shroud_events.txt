# events\!!_utopia_shroud_events.txt
# - - - - - - - - - - - - - - - - - - - - - 
# Shroud Events OVERWRITE
# - - - - - - - - - - - - - - - - - - - - - 

# ID 3000 - 3999

namespace = utopia

# The Shroud Lobby
country_event = {	# MEMESIS GESTALTS
	id = utopia.3000
	title = "utopia.3000.name"
	# Descs
		# First time
		desc = {
			text = utopia.3000.intro.desc
			trigger = {
				has_country_flag = shroud_intro
				is_gestalt = no
			}
		}
		desc = {
			text = utopia.3000.intro.desc.tec.hivemind
			trigger = {
				has_country_flag = shroud_intro
				is_hive_empire = yes
			}
		}
		desc = {
			text = utopia.3000.intro.desc.tec.machine
			trigger = {
				has_country_flag = shroud_intro
				is_machine_empire = yes
			}
		}
		# Regular empire normal descs
		desc = {
			text = utopia.3000.1.desc
			trigger = {
				normal_shroud_message = yes
				is_gestalt = no
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
			}
		}
		desc = {
			text = utopia.3000.2.desc
			trigger = {
				normal_shroud_message = yes
				is_gestalt = no
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
			}
		}
		desc = {
			text = utopia.3000.3.desc
			trigger = {
				normal_shroud_message = yes
				is_gestalt = no
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
			}
		}
		desc = {
			text = utopia.3000.4.desc
			trigger = {
				normal_shroud_message = yes
				is_gestalt = no
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
			}
		}
		desc = {
			text = utopia.3000.5.desc
			trigger = {
				normal_shroud_message = yes
				is_gestalt = no
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
			}
		}
		desc = {
			text = utopia.3000.6.desc
			trigger = {
				normal_shroud_message = yes
				is_gestalt = no
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
			}
		}
		desc = {
			text = utopia.3000.7.desc
			trigger = {
				normal_shroud_message = yes
				is_gestalt = no
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
			}
		}
		desc = {
			text = utopia.3000.8.desc
			trigger = {
				normal_shroud_message = yes
				is_gestalt = no
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
			}
		}
		desc = {
			text = utopia.3000.9.desc
			trigger = {
				normal_shroud_message = yes
				is_gestalt = no
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
			}
		}
		desc = {
			text = utopia.3000.10.desc
			trigger = {
				normal_shroud_message = yes
				is_gestalt = no
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
			}
		}
		desc = {
			text = utopia.3000.11.desc
			trigger = {
				normal_shroud_message = yes
				is_gestalt = no
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
			}
		}
		desc = {
			text = utopia.3000.12.desc
			trigger = {
				normal_shroud_message = yes
				is_gestalt = no
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
			}
		}
		desc = {
			text = utopia.3000.13.desc
			trigger = {
				normal_shroud_message = yes
				is_gestalt = no
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
			}
		}
		desc = {
			text = utopia.3000.14.desc
			trigger = {
				normal_shroud_message = yes
				is_gestalt = no
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
			}
		}
		desc = {
			text = utopia.3000.15.desc
			trigger = {
				normal_shroud_message = yes
				is_gestalt = no
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
			}
		}
		desc = {
			text = utopia.3000.16.desc
			trigger = {
				normal_shroud_message = yes
				is_gestalt = no
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
			}
		}
		desc = {
			text = utopia.3000.17.desc
			trigger = {
				normal_shroud_message = yes
				is_gestalt = no
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
			}
		}
		desc = {
			text = utopia.3000.18.desc
			trigger = {
				normal_shroud_message = yes
				is_gestalt = no
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
			}
		}
		desc = {
			text = utopia.3000.19.desc
			trigger = {
				normal_shroud_message = yes
				is_gestalt = no
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
			}
		}
		# Hive normal descs
		desc = {
			text = utopia.3000.1.desc.tec.hive
			trigger = {
				normal_shroud_message = yes
				is_hive_empire = yes
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
			}
		}
		desc = {
			text = utopia.3000.2.desc.tec.hive
			trigger = {
				normal_shroud_message = yes
				is_hive_empire = yes
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
			}
		}
		desc = {
			text = utopia.3000.3.desc.tec.hive
			trigger = {
				normal_shroud_message = yes
				is_hive_empire = yes
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
			}
		}
		desc = {
			text = utopia.3000.4.desc.tec.hive
			trigger = {
				normal_shroud_message = yes
				is_hive_empire = yes
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
			}
		}
		desc = {
			text = utopia.3000.5.desc.tec.hive
			trigger = {
				normal_shroud_message = yes
				is_hive_empire = yes
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
			}
		}
		# Machine normal descs
		desc = {
			text = utopia.3000.1.desc.tec.machi.low
			trigger = {
				crisis_shroud_message = yes
				is_machine_empire = yes
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
				check_variable = {
					which = tec_machine_shroud_incursions
					value < 6
				}
			}
		}
		desc = {
			text = utopia.3000.2.desc.tec.machi.low
			trigger = {
				crisis_shroud_message = yes
				is_machine_empire = yes
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
				check_variable = {
					which = tec_machine_shroud_incursions
					value < 6
				}
			}
		}
		desc = {
			text = utopia.3000.3.desc.tec.machi.low
			trigger = {
				crisis_shroud_message = yes
				is_machine_empire = yes
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
				check_variable = {
					which = tec_machine_shroud_incursions
					value < 6
				}
			}
		}
		desc = {
			text = utopia.3000.4.desc.tec.machi.low
			trigger = {
				crisis_shroud_message = yes
				is_machine_empire = yes
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
				check_variable = {
					which = tec_machine_shroud_incursions
					value < 6
				}
			}
		}
		desc = {
			text = utopia.3000.5.desc.tec.machi.low
			trigger = {
				crisis_shroud_message = yes
				is_machine_empire = yes
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
				check_variable = {
					which = tec_machine_shroud_incursions
					value < 6
				}
			}
		}
		desc = {
			text = utopia.3000.1.desc.tec.machi.mid
			trigger = {
				crisis_shroud_message = yes
				is_machine_empire = yes
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
				check_variable = {
					which = tec_machine_shroud_incursions
					value > 5
				}
				check_variable = {
					which = tec_machine_shroud_incursions
					value < 11
				}
			}
		}
		desc = {
			text = utopia.3000.2.desc.tec.machi.mid
			trigger = {
				crisis_shroud_message = yes
				is_machine_empire = yes
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
				check_variable = {
					which = tec_machine_shroud_incursions
					value > 5
				}
				check_variable = {
					which = tec_machine_shroud_incursions
					value < 11
				}
			}
		}
		desc = {
			text = utopia.3000.3.desc.tec.machi.mid
			trigger = {
				crisis_shroud_message = yes
				is_machine_empire = yes
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
				check_variable = {
					which = tec_machine_shroud_incursions
					value > 5
				}
				check_variable = {
					which = tec_machine_shroud_incursions
					value < 11
				}
			}
		}
		desc = {
			text = utopia.3000.4.desc.tec.machi.mid
			trigger = {
				crisis_shroud_message = yes
				is_machine_empire = yes
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
				check_variable = {
					which = tec_machine_shroud_incursions
					value > 5
				}
				check_variable = {
					which = tec_machine_shroud_incursions
					value < 11
				}
			}
		}
		desc = {
			text = utopia.3000.5.desc.tec.machi.mid
			trigger = {
				crisis_shroud_message = yes
				is_machine_empire = yes
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
				check_variable = {
					which = tec_machine_shroud_incursions
					value > 10
				}
			}
		}
		desc = {
			text = utopia.3000.1.desc.tec.machi.full
			trigger = {
				crisis_shroud_message = yes
				is_machine_empire = yes
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
				check_variable = {
					which = tec_machine_shroud_incursions
					value > 10
				}
			}
		}
		desc = {
			text = utopia.3000.2.desc.tec.machi.full
			trigger = {
				crisis_shroud_message = yes
				is_machine_empire = yes
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
				check_variable = {
					which = tec_machine_shroud_incursions
					value > 10
				}
			}
		}
		desc = {
			text = utopia.3000.3.desc.tec.machi.full
			trigger = {
				crisis_shroud_message = yes
				is_machine_empire = yes
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
				check_variable = {
					which = tec_machine_shroud_incursions
					value > 10
				}
			}
		}
		desc = {
			text = utopia.3000.4.desc.tec.machi.full
			trigger = {
				crisis_shroud_message = yes
				is_machine_empire = yes
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
				check_variable = {
					which = tec_machine_shroud_incursions
					value > 10
				}
			}
		}
		desc = {
			text = utopia.3000.5.desc.tec.machi.full
			trigger = {
				crisis_shroud_message = yes
				is_machine_empire = yes
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
				check_variable = {
					which = tec_machine_shroud_incursions
					value > 10
				}
			}
		}
		# Aethero Crisis messages regular
		desc = {
			text = utopia.3000.20.desc
			trigger = {
				crisis_shroud_message = yes
				is_gestalt = no
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
			}
		}
		desc = {
			text = utopia.3000.21.desc
			trigger = {
				crisis_shroud_message = yes
				is_gestalt = no
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
			}
		}
		desc = {
			text = utopia.3000.22.desc
			trigger = {
				crisis_shroud_message = yes
				is_gestalt = no
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
			}
		}
		desc = {
			text = utopia.3000.23.desc
			trigger = {
				crisis_shroud_message = yes
				is_gestalt = no
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
			}
		}
		desc = {
			text = utopia.3000.24.desc
			trigger = {
				crisis_shroud_message = yes
				is_gestalt = no
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
			}
		}
		desc = {
			text = utopia.3000.25.desc
			trigger = {
				crisis_shroud_message = yes
				is_gestalt = no
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
			}
		}
		# Aethero Crisis hive
		desc = {
			text = utopia.3000.20.desc.tec.hive.crisis
			trigger = {
				crisis_shroud_message = yes
				is_hive_empire = yes
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
			}
		}
		desc = {
			text = utopia.3000.21.desc.tec.hive.crisis
			trigger = {
				crisis_shroud_message = yes
				is_hive_empire = yes
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
			}
		}
		desc = {
			text = utopia.3000.22.desc.tec.hive.crisis
			trigger = {
				crisis_shroud_message = yes
				is_hive_empire = yes
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
			}
		}
		# Aethero Crisis machine
		desc = {
			text = utopia.3000.20.desc.tec.machi.low.crisis
			trigger = {
				crisis_shroud_message = yes
				is_machine_empire = yes
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
				check_variable = {
					which = tec_machine_shroud_incursions
					value < 6
				}
			}
		}
		desc = {
			text = utopia.3000.21.desc.tec.machi.low.crisis
			trigger = {
				crisis_shroud_message = yes
				is_machine_empire = yes
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
				check_variable = {
					which = tec_machine_shroud_incursions
					value < 6
				}
			}
		}
		desc = {
			text = utopia.3000.22.desc.tec.machi.low.crisis
			trigger = {
				crisis_shroud_message = yes
				is_machine_empire = yes
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
				check_variable = {
					which = tec_machine_shroud_incursions
					value < 6
				}
			}
		}
		desc = {
			text = utopia.3000.20.desc.tec.machi.mid.crisis
			trigger = {
				crisis_shroud_message = yes
				is_machine_empire = yes
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
				check_variable = {
					which = tec_machine_shroud_incursions
					value > 5
				}
				check_variable = {
					which = tec_machine_shroud_incursions
					value < 11
				}
			}
		}
		desc = {
			text = utopia.3000.21.desc.tec.machi.mid.crisis
			trigger = {
				crisis_shroud_message = yes
				is_machine_empire = yes
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
				check_variable = {
					which = tec_machine_shroud_incursions
					value > 5
				}
				check_variable = {
					which = tec_machine_shroud_incursions
					value < 11
				}
			}
		}
		desc = {
			text = utopia.3000.22.desc.tec.machi.mid.crisis
			trigger = {
				crisis_shroud_message = yes
				is_machine_empire = yes
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
				check_variable = {
					which = tec_machine_shroud_incursions
					value > 5
				}
				check_variable = {
					which = tec_machine_shroud_incursions
					value < 11
				}
			}
		}
		desc = {
			text = utopia.3000.20.desc.tec.machi.full.crisis
			trigger = {
				crisis_shroud_message = yes
				is_machine_empire = yes
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
				check_variable = {
					which = tec_machine_shroud_incursions
					value > 10
				}
			}
		}
		desc = {
			text = utopia.3000.21.desc.tec.machi.full.crisis
			trigger = {
				crisis_shroud_message = yes
				is_machine_empire = yes
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
				check_variable = {
					which = tec_machine_shroud_incursions
					value > 10
				}
			}
		}
		desc = {
			text = utopia.3000.22.desc.tec.machi.full.crisis
			trigger = {
				crisis_shroud_message = yes
				is_machine_empire = yes
				NOT = {
					has_ascension_perk = ap_become_the_crisis
				}
				check_variable = {
					which = tec_machine_shroud_incursions
					value > 10
				}
			}
		}
		# Become the crisis desc
		desc = {
			text = utopia.3000.1.desc.tec.regu.becomecrisis
			trigger = {
				crisis_shroud_message = yes
				is_gestalt = no
				has_ascension_perk = ap_become_the_crisis
			}
		}

		desc = {
			text = utopia.3000.1.desc.tec.hive.becomecrisis
			trigger = {
				crisis_shroud_message = yes
				is_hive_empire = yes
				has_ascension_perk = ap_become_the_crisis
			}
		}

		desc = {
			text = utopia.3000.1.desc.tec.machi.low.becomecrisis
			trigger = {
				crisis_shroud_message = yes
				is_machine_empire = yes
				has_ascension_perk = ap_become_the_crisis
				check_variable = {
					which = tec_machine_shroud_incursions
					value < 6
				}
			}
		}
		desc = {
			text = utopia.3000.1.desc.tec.machi.mid.becomecrisis
			trigger = {
				crisis_shroud_message = yes
				is_machine_empire = yes
				has_ascension_perk = ap_become_the_crisis
				check_variable = {
					which = tec_machine_shroud_incursions
					value > 5
				}
				check_variable = {
					which = tec_machine_shroud_incursions
					value < 11
				}
			}
		}
		desc = {
			text = utopia.3000.1.desc.tec.machi.high.becomecrisis
			trigger = {
				crisis_shroud_message = yes
				is_machine_empire = yes
				has_ascension_perk = ap_become_the_crisis
				check_variable = {
					which = tec_machine_shroud_incursions
					value > 10
				}
			}
		}
	# /

	diplomatic_title = BLANK_STRING
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	trigger = {
		OR = {
			from = {
				is_country_type = shroud 
			}
			has_country_flag = shroud_intro
		}
		NOR = {
			has_country_flag = shroud_diplomacy_engaged
			has_modifier = shroud_cooldown
			has_modifier = shroud_precog_cooldown
			has_modifier = promised_no_shroud
		}
	}

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	# Regular empire - Reach into the shroud
	option = {
		name = "utopia.3000.a"
		custom_tooltip = "venture.shroud.a.tooltip"
		trigger = {
			is_gestalt = no
			NOT = {
				has_country_flag = shroud_intro
			}
		}
		allow = {
			resource_stockpile_compare = {
				resource = energy 
				value >= 1000
				mult = value:scripted_modifier_mult|MODIFIER|shroud_delve_cost|
			}
		}

		add_resource = {
			energy = -1000
			mult = value:scripted_modifier_mult|MODIFIER|shroud_delve_cost|
		}

		hidden_effect = {
			random_list = {
				10 = {
					if = {
						limit = { NOT = { has_country_flag = shroud_vision_1 } }
						country_event = { id = utopia.3100 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = {
							count_controlled_ship = {
								limit = { is_ship_size = psionic_avatar }
								count < 1
							}
							count_owned_army = {
								limit = { army_type = shroud_army }
								count < 1
							}
						}
						country_event = { id = utopia.3110 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = { NOT = { has_country_flag = shroud_vision_3 } }
						country_event = { id = utopia.3120 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = { NOT = { has_country_flag = shroud_vision_4 } }
						country_event = { id = utopia.3130 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = { NOT = { has_country_flag = shroud_vision_5 } }
						country_event = { id = utopia.3140 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = {
							any_country = {
								is_country_type = fallen_empire
								NOT = { has_ethic = ethic_gestalt_consciousness }
								has_communications = root
								NOT = { is_at_war_with = root }
							}
							NOT = { has_country_flag = shroud_fallen_empire }
						}
						country_event = { id = utopia.3150 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = {
							NOR = {
								has_technology = tech_psionic_shield 
								has_tech_option = tech_psionic_shield
							} 
						}
						country_event = { id = utopia.3170 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = {
							NOR = {
								has_technology = tech_precognition_interface
								has_tech_option = tech_precognition_interface
							} 
						}
						country_event = { id = utopia.3180 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = {
							NOR = {
								has_technology = tech_psi_jump_drive_1 
								has_tech_option = tech_psi_jump_drive_1 
							}
						}
						country_event = { id = utopia.3160 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = {
							NOR = {
								has_country_flag = shroud_vision_10
								any_owned_leader = {
									has_trait = leader_trait_chosen
								}
							}

						}
						country_event = { id = utopia.3190 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				20 = {
					if = {
						limit = {
							NOT = {
								has_country_flag = has_shroud_patron
							}
							has_country_flag = offered_covenant # Can't randomly form a covenant unless you've offered one previously and failed.
						}
						country_event = { id = utopia.3300 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = { country_event = { id = utopia.3200 } }
			}
			tec_add_shroud_cd_effect = yes
			set_country_flag = tec_entered_shroud			
		}
	}
	option = {
		name = "utopia.3000.c"
		custom_tooltip = "venture.shroud.c.tooltip"
		trigger = {
			has_country_flag = tec_shroud_premium_incursion
			is_gestalt = no
			NOT = {
				has_country_flag = shroud_intro
			}
		}
		allow = {
			resource_stockpile_compare = {
				resource = energy
				value >= 2500
				mult = value:scripted_modifier_mult|MODIFIER|shroud_delve_cost|
			}
			resource_stockpile_compare = {
				resource = sr_zro
				value >= 250
				mult = value:scripted_modifier_mult|MODIFIER|shroud_delve_cost|
			}
		}

		add_resource = {
			energy = -2500
			sr_zro = -250
			mult = value:scripted_modifier_mult|MODIFIER|shroud_delve_cost|
		}

		hidden_effect = {
			# Avoid negatives
			set_country_flag = tec_shroud_premium_incursion
			random_list = {
				10 = {
					if = {
						limit = { NOT = { has_country_flag = shroud_vision_1 } }
						country_event = { id = utopia.3100 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = {
							count_controlled_ship = {
								limit = { is_ship_size = psionic_avatar }
								count < 1
							}
							count_owned_army = {
								limit = { army_type = shroud_army }
								count < 1
							}
						}
						country_event = { id = utopia.3110 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = { NOT = { has_country_flag = shroud_vision_3 } }
						country_event = { id = utopia.3120 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = { NOT = { has_country_flag = shroud_vision_4 } }
						country_event = { id = utopia.3130 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = { NOT = { has_country_flag = shroud_vision_5 } }
						country_event = { id = utopia.3140 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {	# FE ESPIONAGE
					if = {
						limit = {
							any_country = {
								is_country_type = fallen_empire
								NOT = { has_ethic = ethic_gestalt_consciousness }
								has_communications = root
								NOT = { is_at_war_with = root }
							}
							NOT = { has_country_flag = shroud_fallen_empire }
						}
						country_event = { id = utopia.3150 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = {
							NOR = {
								has_technology = tech_psionic_shield 
								has_tech_option = tech_psionic_shield
							} 
						}
						country_event = { id = utopia.3170 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = {
							NOR = {
								has_technology = tech_precognition_interface
								has_tech_option = tech_precognition_interface
							} 
						}
						country_event = { id = utopia.3180 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = {
							NOR = {
								has_technology = tech_psi_jump_drive_1 
								has_tech_option = tech_psi_jump_drive_1 
							}
						}
						country_event = { id = utopia.3160 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {	# THE CHOSEN ONE
					if = {
						limit = {
							NOR = {
								has_country_flag = shroud_vision_10
								any_owned_leader = {
									OR = {
										has_trait = leader_trait_chosen
									}
								}
							}

						}
						country_event = { id = utopia.3190 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				20 = {	# SHROUD COVENANTS
					modifier = {
						weight = 1
						OR = {
							has_country_flag = tec_shroud_premium_incursion
							has_country_flag = tec_shroud_deluxe_incursion
						}
						check_variable = {
							which = tec_patron_chance
							value = 1
						}
					}
					modifier = {
						weight = 2
						OR = {
							has_country_flag = tec_shroud_premium_incursion
							has_country_flag = tec_shroud_deluxe_incursion
						}
						check_variable = {
							which = tec_patron_chance
							value = 2
						}
					}
					modifier = {
						weight = 3
						OR = {
							has_country_flag = tec_shroud_premium_incursion
							has_country_flag = tec_shroud_deluxe_incursion
						}
						check_variable = {
							which = tec_patron_chance
							value = 3
						}
					}
					modifier = {
						weight = 4
						OR = {
							has_country_flag = tec_shroud_premium_incursion
							has_country_flag = tec_shroud_deluxe_incursion
						}
						check_variable = {
							which = tec_patron_chance
							value = 4
						}
					}
					modifier = {
						weight = 5
						OR = {
							has_country_flag = tec_shroud_premium_incursion
							has_country_flag = tec_shroud_deluxe_incursion
						}
						check_variable = {
							which = tec_patron_chance
							value = 5
						}
					}
					modifier = {
						weight = 5
						OR = {
							has_country_flag = tec_shroud_premium_incursion
							has_country_flag = tec_shroud_deluxe_incursion
						}
						check_variable = {
							which = tec_patron_chance
							value > 5
						}
					}
					if = {
						limit = {
							NOT = {
								has_country_flag = has_shroud_patron
							}

						}
						country_event = { id = utopia.3300 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = { country_event = { id = utopia.3200 } }
			}
			tec_add_shroud_cd_effect = yes
			set_country_flag = tec_entered_shroud			
		}
	}
	option = {
		name = "utopia.3000.d"
		custom_tooltip = "venture.shroud.d.tooltip"
		trigger = {
			has_country_flag = tec_shroud_deluxe_incursion
			is_gestalt = no
			NOT = {
				has_country_flag = shroud_intro
			}
		}
		allow = {
			resource_stockpile_compare = {
				resource = energy 
				value >= 5000
				mult = value:scripted_modifier_mult|MODIFIER|shroud_delve_cost|
			}
			resource_stockpile_compare = {
				resource = sr_zro
				value >= 500
				mult = value:scripted_modifier_mult|MODIFIER|shroud_delve_cost|
			}
		}

		add_resource = {
			energy = -5000
			sr_zro = -500
			mult = value:scripted_modifier_mult|MODIFIER|shroud_delve_cost|
		}

		hidden_effect = {
			# Always good positives
			set_country_flag = tec_shroud_deluxe_incursion
			random_list = {
				10 = {
					if = {
						limit = { NOT = { has_country_flag = shroud_vision_1 } }
						country_event = { id = utopia.3100 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = {
							count_controlled_ship = {
								limit = { is_ship_size = psionic_avatar }
								count < 1
							}
							count_owned_army = {
								limit = { army_type = shroud_army }
								count < 1
							}
						}
						country_event = { id = utopia.3110 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = { NOT = { has_country_flag = shroud_vision_3 } }
						country_event = { id = utopia.3120 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = { NOT = { has_country_flag = shroud_vision_4 } }
						country_event = { id = utopia.3130 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = { NOT = { has_country_flag = shroud_vision_5 } }
						country_event = { id = utopia.3140 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {	# FE ESPIONAGE
					if = {
						limit = {
							any_country = {
								is_country_type = fallen_empire
								NOT = { has_ethic = ethic_gestalt_consciousness }
								has_communications = root
								NOT = { is_at_war_with = root }
							}
							NOT = { has_country_flag = shroud_fallen_empire }
						}
						country_event = { id = utopia.3150 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = {
							NOR = {
								has_technology = tech_psionic_shield 
								has_tech_option = tech_psionic_shield
							} 
						}
						country_event = { id = utopia.3170 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = {
							NOR = {
								has_technology = tech_precognition_interface
								has_tech_option = tech_precognition_interface
							} 
						}
						country_event = { id = utopia.3180 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = {
							NOR = {
								has_technology = tech_psi_jump_drive_1 
								has_tech_option = tech_psi_jump_drive_1 
							}
						}
						country_event = { id = utopia.3160 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {	# THE CHOSEN ONE
					if = {
						limit = {
							NOR = {
								has_country_flag = shroud_vision_10
								any_owned_leader = {
									OR = {
										has_trait = leader_trait_chosen
									}
								}
							}

						}
						country_event = { id = utopia.3190 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				20 = {	# SHROUD COVENANTS
					modifier = {
						weight = 1
						OR = {
							has_country_flag = tec_shroud_premium_incursion
							has_country_flag = tec_shroud_deluxe_incursion
						}
						check_variable = {
							which = tec_patron_chance
							value = 1
						}
					}
					modifier = {
						weight = 2
						OR = {
							has_country_flag = tec_shroud_premium_incursion
							has_country_flag = tec_shroud_deluxe_incursion
						}
						check_variable = {
							which = tec_patron_chance
							value = 2
						}
					}
					modifier = {
						weight = 3
						OR = {
							has_country_flag = tec_shroud_premium_incursion
							has_country_flag = tec_shroud_deluxe_incursion
						}
						check_variable = {
							which = tec_patron_chance
							value = 3
						}
					}
					modifier = {
						weight = 4
						OR = {
							has_country_flag = tec_shroud_premium_incursion
							has_country_flag = tec_shroud_deluxe_incursion
						}
						check_variable = {
							which = tec_patron_chance
							value = 4
						}
					}
					modifier = {
						weight = 5
						OR = {
							has_country_flag = tec_shroud_premium_incursion
							has_country_flag = tec_shroud_deluxe_incursion
						}
						check_variable = {
							which = tec_patron_chance
							value = 5
						}
					}
					modifier = {
						weight = 5
						OR = {
							has_country_flag = tec_shroud_premium_incursion
							has_country_flag = tec_shroud_deluxe_incursion
						}
						check_variable = {
							which = tec_patron_chance
							value > 5
						}
					}
					if = {
						limit = {
							NOT = {
								has_country_flag = has_shroud_patron
							}

						}
						country_event = { id = utopia.3300 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = { country_event = { id = utopia.3200 } }
			}
			tec_add_shroud_cd_effect = yes
			set_country_flag = tec_entered_shroud
		}
	}
	# Hive empire - Expand influence in the shroud
	option = {
		name = "utopia.3000.hive"
		custom_tooltip = "tec.hive.shroud.expansion.tooltip"
		#"venture.shroud.tooltip"
		trigger = {
			is_hive_empire = yes
			NOT = {
				has_country_flag = shroud_intro
			}
		}
		allow = {
			resource_stockpile_compare = {
				resource = energy 
				value >= 1000
				mult = value:scripted_modifier_mult|MODIFIER|shroud_delve_cost|
			}
		}

		add_resource = {
			energy = -1000
			mult = value:scripted_modifier_mult|MODIFIER|shroud_delve_cost|
		}

		hidden_effect = {
			country_event = { id = tec_shroud.1001 }
		}
	}
	# Machine non psi empire - Use shroud as conduit
	option = {
		name = "utopia.3000.nonpsimachi"
		custom_tooltip = "tec.machine.shroud.extraction.tooltip"
		#"venture.shroud.tooltip"
		trigger = {
			is_machine_empire = yes
			has_relic = r_zro_crystal
			NOR = {
				has_ascension_perk = @ap_tec_machine_psi_2
			}
			NOT = {
				has_country_flag = shroud_intro
			}
		}
		allow = {
			resource_stockpile_compare = {
				resource = energy 
				value >= 1000
				mult = value:scripted_modifier_mult|MODIFIER|shroud_delve_cost|
			}
		}

		add_resource = {
			energy = -1000
			mult = value:scripted_modifier_mult|MODIFIER|shroud_delve_cost|
		}

		hidden_effect = {
			random_list = {
				10 = {
					if = {
						limit = { NOT = { has_country_flag = shroud_vision_1 } }
						country_event = { id = utopia.3100 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = {
							count_controlled_ship = {
								limit = { is_ship_size = psionic_avatar }
								count < 1
							}
							count_owned_army = {
								limit = { army_type = shroud_army }
								count < 1
							}
						}
						country_event = { id = utopia.3110 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = { NOT = { has_country_flag = shroud_vision_3 } }
						country_event = { id = utopia.3120 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = { NOT = { has_country_flag = shroud_vision_4 } }
						country_event = { id = utopia.3130 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = { NOT = { has_country_flag = shroud_vision_5 } }
						country_event = { id = utopia.3140 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = {
							any_country = {
								is_country_type = fallen_empire
								NOT = { has_ethic = ethic_gestalt_consciousness }
								has_communications = root
								NOT = { is_at_war_with = root }
							}
							NOT = { has_country_flag = shroud_fallen_empire }
						}
						country_event = { id = utopia.3150 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = {
							NOR = {
								has_technology = tech_psionic_shield 
								has_tech_option = tech_psionic_shield
							} 
						}
						country_event = { id = utopia.3170 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = {
							NOR = {
								has_technology = tech_precognition_interface
								has_tech_option = tech_precognition_interface
							} 
						}
						country_event = { id = utopia.3180 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = {
							NOR = {
								has_technology = tech_psi_jump_drive_1 
								has_tech_option = tech_psi_jump_drive_1 
							}
						}
						country_event = { id = utopia.3160 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = {
							NOR = {
								has_country_flag = shroud_vision_10
								any_owned_leader = {
									OR = {
										has_trait = leader_trait_chosen
									}
								}
							}

						}
						country_event = { id = utopia.3190 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				20 = {
					if = {
						limit = {
							NOT = {
								has_country_flag = has_shroud_patron
							}

						}
						country_event = { id = utopia.3300 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = { country_event = { id = utopia.3200 } }
			}
			tec_add_shroud_cd_effect = yes
		}
	}
	# Machine psi empire - Analyze the shroud
	option = {
		name = "utopia.3000.psimachi"
		custom_tooltip = "tec.machine.shroud.analysis.tooltip"
		#"venture.shroud.tooltip"
		trigger = {
			is_machine_empire = yes
			has_ascension_perk = @ap_tec_machine_psi_2
			NOT = {
				has_country_flag = shroud_intro
			}
		}
		allow = {
			resource_stockpile_compare = {
				resource = energy 
				value >= 1000
				mult = value:scripted_modifier_mult|MODIFIER|shroud_delve_cost|
			}
		}

		add_resource = {
			energy = -1000
			mult = value:scripted_modifier_mult|MODIFIER|shroud_delve_cost|
		}

		hidden_effect = {
			random_list = {
				10 = {
					if = {
						limit = { NOT = { has_country_flag = shroud_vision_1 } }
						country_event = { id = utopia.3100 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = {
							count_controlled_ship = {
								limit = { is_ship_size = psionic_avatar }
								count < 1
							}
							count_owned_army = {
								limit = { army_type = shroud_army }
								count < 1
							}
						}
						country_event = { id = utopia.3110 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = { NOT = { has_country_flag = shroud_vision_3 } }
						country_event = { id = utopia.3120 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = { NOT = { has_country_flag = shroud_vision_4 } }
						country_event = { id = utopia.3130 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = { NOT = { has_country_flag = shroud_vision_5 } }
						country_event = { id = utopia.3140 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = {
							any_country = {
								is_country_type = fallen_empire
								NOT = { has_ethic = ethic_gestalt_consciousness }
								has_communications = root
								NOT = { is_at_war_with = root }
							}
							NOT = { has_country_flag = shroud_fallen_empire }
						}
						country_event = { id = utopia.3150 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = {
							NOR = {
								has_technology = tech_psionic_shield 
								has_tech_option = tech_psionic_shield
							} 
						}
						country_event = { id = utopia.3170 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = {
							NOR = {
								has_technology = tech_precognition_interface
								has_tech_option = tech_precognition_interface
							} 
						}
						country_event = { id = utopia.3180 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = {
							NOR = {
								has_technology = tech_psi_jump_drive_1 
								has_tech_option = tech_psi_jump_drive_1 
							}
						}
						country_event = { id = utopia.3160 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = {
					if = {
						limit = {
							NOR = {
								has_country_flag = shroud_vision_10
								any_owned_leader = {
									OR = {
										has_trait = leader_trait_chosen
									}
								}
							}

						}
						country_event = { id = utopia.3190 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				20 = {
					if = {
						limit = {
							NOT = {
								has_country_flag = has_shroud_patron
							}

						}
						country_event = { id = utopia.3300 }
					}
					else = { country_event = { id = utopia.3200 } }
				}
				10 = { country_event = { id = utopia.3200 } }
			}
			tec_add_shroud_cd_effect = yes
		}
	}
	# First time?
	option = { #First time trying to breach
		name = "utopia.3000.a"
		trigger = {
			has_country_flag = shroud_intro
		}
		allow = {
			resource_stockpile_compare = {
				resource = energy
				value >= 1000
				mult = value:scripted_modifier_mult|MODIFIER|shroud_delve_cost|
			}
		}

		add_resource = {
			energy = -1000
			mult = value:scripted_modifier_mult|MODIFIER|shroud_delve_cost|
		}

		hidden_effect = {
			country_event = { id = utopia.2657 }
			tec_add_shroud_cd_effect = yes

			remove_country_flag = shroud_intro
		}
	}
	option = { #Try to contact a specific patron
		name = "utopia.3000.b"
		trigger = {
			NOR = {
				has_country_flag = shroud_intro
				has_country_flag = has_shroud_patron
				has_special_project = FORM_COVENANT_PROJECT
			}
		}
		allow = {
			resource_stockpile_compare = {
				resource = energy
				value >= 2000
				mult = value:scripted_modifier_mult|MODIFIER|shroud_delve_cost|
			}
			resource_stockpile_compare = {
				resource = sr_zro
				value >= 500
				mult = value:scripted_modifier_mult|MODIFIER|shroud_delve_cost|
			}
		}

		add_resource = {
			energy = -2000
			sr_zro = -500
			mult = value:scripted_modifier_mult|MODIFIER|shroud_delve_cost|
		}


		hidden_effect = {
			country_event = { id = utopia.3005 }
			tec_add_shroud_cd_effect = yes
		}
	}

	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		default_hide_option = yes
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
			if = {
				limit = {
					has_country_flag = tec_entered_shroud
				}
				remove_country_flag = tec_entered_shroud
	
				
				# VARIABLE TIME!!!
				if = {	# Shroud covenant chance handler
					limit = {
						is_regular_empire = yes
						OR = {
							NOT = {
								has_country_flag = has_shroud_patron
							}
							has_country_flag = tec_wants_to_change_patron
						}
					}
					change_variable = {
						which = tec_patron_chance
						value = 1
					}
				}
	
				if = {	# Reg incursion count
					limit = {
						is_gestalt = no
					}
					change_variable = {
						which = tec_regular_shroud_incursions
						value = 1
					}
				}
	
				if = {	# Machine incursion count
					limit = {
						is_machine_empire = yes
					}
					change_variable = {
						which = tec_machine_shroud_incursions
						value = 1
					}
				}
	
				if = {	# Hive incursion count
					limit = {
						is_hive_empire = yes
					}
					change_variable = {
						which = tec_hive_shroud_incursions
						value = 1
					}
				}
					
				event_target:global_event_country = {
					if = {	# Reg incursion count
						limit = {
							root = {
								is_gestalt = no
							}
						}
						change_variable = {
							which = tec_regular_global_shroud_incursions
							value = 1
						}
					}
	
					if = {	# Machine incursion count
						limit = {
							root = {
								is_machine_empire = yes
							}
						}
						change_variable = {
							which = tec_machine_global_shroud_incursions
							value = 1
						}
					}
	
					if = {	# Hive incursion count
						limit = {
							root = {
								is_hive_empire = yes
							}
						}
						change_variable = {
							which = tec_hive_global_shroud_incursions
							value = 1
						}
					}
					
				}
			}
		}
	}
}

# The Shroud Unavailable - WORSE OUTCOME
country_event = {
	id = utopia.3010
	title = "utopia.3000.name"
	# Regular
	desc = {
		text = utopia.3010.desc
		trigger = {
			is_gestalt = no
		}
	}

	# Hive
	desc = {
		text = utopia.3010.desc.tec.hivemind
		trigger = {
			is_hive_empire = yes
		}
	}

	# Machine nonpsi
	desc = {
		text = utopia.3010.desc.tec.nonpsimachi
		trigger = {
			is_machine_empire = yes
			NOT = {
				has_ascension_perk = @ap_tec_machine_psi_2
			}
			has_relic = r_zro_crystal
		}
	}

	# Machine psi
	desc = {
		text = utopia.3010.desc.tec.psimachi
		trigger = {
			is_machine_empire = yes
			has_ascension_perk = @ap_tec_machine_psi_2
		}
	}


	diplomatic_title = BLANK_STRING
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	trigger = {
		from = { is_country_type = shroud }
		NOT = { has_country_flag = shroud_diplomacy_engaged }
		OR = {
			has_modifier = shroud_cooldown
			has_modifier = shroud_precog_cooldown
			has_modifier = promised_no_shroud
		}
	}

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}

	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		default_hide_option = yes
	}
}

### Summon Avatar
# Summon Avatar (SUCCESS SHIP) REGULAR AND HIVE, UNTOUCHED
# utopia.3020

# Summon Avatar (SUCCESS ARMY)
# utopia.3021

# Summon Avatar (FAILURE)
# utopia.3022

# Summon Avatar (CRITICAL FAILURE) # MEMESIS HIVEMINDS
country_event = {
	id = utopia.3023
	title = "utopia.3000.name"
	desc = {
		text = utopia.3023.desc
		trigger = {
			is_gestalt = no
		}
	}
	desc = {
		text = utopia.3023.desc.tec.hive
		trigger = {
			is_hive_empire = yes
		}
	}
	diplomatic_title = BLANK_STRING
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
			set_timed_country_flag = {
				flag = negative_shroud_outcome
				days = 1800 # 5 years
			}
		}
	}

	option = {
		name = "exit.shroud"
		hidden_effect = {
			country_event = { id = utopia.3024 }
		}
		default_hide_option = yes
	}
}

# Shroud Incursion
# utopia.3024

# Shroud Avatar Banished (HIDDEN)
# utopia.3025

# Shroud Avatar Banished (HIDDEN)
# utopia.3026

### Modifiers

# Happiness (SUCCESS)
# utopia.3030

# Ship Upkeep (SUCCESS)
# utopia.3031

# Research Speed (SUCCESS)
# utopia.3032

# Shield Boost (SUCCESS)
# utopia.3033

# Weapon Boost (SUCCESS)
# utopia.3034

# Firing Rate (SUCCESS)
# utopia.3035

# Ethic Boost (SUCCESS)
# utopia.3036

# Influence Boost (SUCCESS)
# utopia.3037

# Unity Boost (SUCCESS)
# utopia.3038

# Evasion (SUCCESS)
# utopia.3039

# Ship Repair (SUCCESS)
# utopia.3040

# Lifespan (SUCCESS)	# MEMESIS
country_event = {
	id = utopia.3041
	title = "boon.bestowed"
	desc = "utopia.3041.desc"
	diplomatic_title = BLANK_STRING
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
			set_timed_country_flag = {
				flag = positive_shroud_outcome
				days = 1800 # 5 years
			}
		}
	}

	option = {
		name = "exit.shroud"
		custom_tooltip = utopia.3041.tooltip
		hidden_effect = {
			every_owned_leader = {
				limit = {
					OR = {
						species = {
							tec_is_total_psionic_species = yes
						}
					}
					NOT = { has_trait = leader_trait_chosen }
				}
				add_trait = leader_trait_shroud_age
			}
		}
		default_hide_option = yes
	}
}

# Ship Speed (SUCCESS)
# utopia.3042

# Army Morale (SUCCESS)
# utopia.3043

# Sensor Range (SUCCESS)
# utopia.3044

# No Effect (FAILURE)
# utopia.3045

# Negative Happiness (CRITICAL FAILURE)
# utopia.3050

# Negative Ethics Attraction (CRITICAL FAILURE)
# utopia.3051

# Negative Ship Armor (CRITICAL FAILURE)
# utopia.3052

# Negative Population Growth (CRITICAL FAILURE)
# utopia.3053

# Negative Research (CRITICAL FAILURE)
# utopia.3054

# Negative Influence (CRITICAL FAILURE)
# utopia.3055

# Negative Unity (CRITICAL FAILURE)
# utopia.3056

# Negative Ship Speed (CRITICAL FAILURE)
# utopia.3057

# Negative Army Morale (CRITICAL FAILURE)
# utopia.3058

# Negative Sensor Range (CRITICAL FAILURE)
# utopia.3059


### VISIONS

# Vision 1
# utopia.3100

# Vision 2
# utopia.3110

# Vision 3
# utopia.3120

# Vision 4
# utopia.3130

# Vision 5
# utopia.3140

# Vision 6 - Fallen Empire
country_event = {
	id = utopia.3150
	title = "utopia.3000.name"
	desc = "utopia.3150.desc"
	diplomatic = yes
	diplomatic_title = BLANK_STRING
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
		random_country = {
			limit = {
				is_country_type = fallen_empire
				NOT = { has_ethic = ethic_gestalt_consciousness }
				NOT = { is_at_war_with = root }
				has_communications = root
			}
			save_event_target_as = fallen_empire
		}
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}

	option = {
		name = "utopia.3150.a"
		custom_tooltip = "shroud.unknown.chances.medium"
		hidden_effect = {
			random_list = {
				60 = {
					country_event = { id = utopia.3151 }
				}
				40 = {
					modifier = {
						factor = 0.5
						has_relic = r_zro_crystal
					}
					country_Event = { id = utopia.3152 }
				}
			}
		}
	}

	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		default_hide_option = yes
	}
}

# Stole Secrets
country_event = {
	id = utopia.3151
	title = "utopia.3000.name"
	desc = { text = utopia.3151.v1.desc }
	desc = { text = utopia.3151.v2.desc }
	desc = { text = utopia.3151.v3.desc }
	diplomatic = yes
	diplomatic_title = BLANK_STRING
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
		set_country_flag = shroud_fallen_empire
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}

	option = {
		name = "exit.shroud"
		give_fe_tech = yes
		default_hide_option = yes
	}
}

# Failed to Steal Secrets
country_event = {
	id = utopia.3152
	title = "utopia.3000.name"
	desc = "utopia.3152.desc"
	diplomatic = yes
	diplomatic_title = BLANK_STRING
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
		set_country_flag = shroud_fallen_empire
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}

	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		default_hide_option = yes
		hidden_effect = {
			country_event = { id = utopia.3153 days = 20 random = 15 }
		}
	}
}

# Diplomatic Consequences
country_event = {
	id = utopia.3153
	title = "TRANSMISSION"
	desc = "utopia.3153.desc"
	diplomatic = yes
	diplomatic_title = BLANK_STRING
	force_open = yes
	
	picture_event_data = {
		portrait = event_target:fallen_empire
		room = event_target:fallen_empire
	}
	
	is_triggered_only = yes

	immediate = {
		event_target:fallen_empire = {
			add_opinion_modifier = {
				who = root 
				modifier = opinion_invaded_mind
			}
		}
	}

	option = {
		name = "utopia.3053.a"
		tooltip = {
			event_target:fallen_empire = {
				add_opinion_modifier = {
					who = root 
					modifier = opinion_invaded_mind
				}
			}
		}
	}
}

# Vision 7 - Psi Jump Drives
country_event = {
	id = utopia.3160
	title = "utopia.3000.name"
	desc = "utopia.3160.desc"
	diplomatic = yes
	diplomatic_title = BLANK_STRING
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}

	option = {
		name = "utopia.3160.a"
		custom_tooltip = "shroud.unknown.chances.medium"
		hidden_effect = {
			random_list = {
				60 = {
					modifier = {
						factor = 1.5
						has_country_flag = jaunted_traveler_secret_revealed
					}
					country_event = { id = utopia.3161 }
				}
				40 = {
					modifier = {
						factor = 0.5
						has_relic = r_zro_crystal
					}
					country_event = { id = utopia.3162 }
				}
			}
		}
	}
	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		default_hide_option = yes
	}
}

# Success
country_event = {
	id = utopia.3161
	title = "utopia.3161.name"
	desc = "utopia.3161.desc"
	diplomatic = yes
	diplomatic_title = BLANK_STRING
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}

	option = {
		name = "exit.shroud"
		if = {
			limit = {
				NOR = {
					has_technology = tech_psi_jump_drive_1
					has_tech_option = tech_psi_jump_drive_1
				}
			}
			add_research_option = tech_psi_jump_drive_1
		}
		default_hide_option = yes
	}
}

# Failure
country_event = {
	id = utopia.3162
	title = "curse.bestowed"
	desc = "utopia.3162.desc"
	diplomatic = yes
	diplomatic_title = BLANK_STRING
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}

	option = {
		name = "exit.shroud"
		default_hide_option = yes
		add_modifier = {
			modifier = "shroud_neg_speed"
			days = 1800
		}
	}
}

# Vision 8 - Psionic Shield
country_event = {
	id = utopia.3170
	title = "utopia.3000.name"
	desc = "utopia.3170.desc"
	diplomatic = yes
	diplomatic_title = BLANK_STRING
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}

	option = {
		name = "utopia.3170.a"
		custom_tooltip = "shroud.unknown.chances.medium"
		hidden_effect = {
			random_list = {
				60 = {
					country_event = { id = utopia.3171 }
				}
				40 = {
					modifier = {
						factor = 0.5
						has_relic = r_zro_crystal
					}
					country_Event = { id = utopia.3172 }
				}
			}
		}
	}

	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		default_hide_option = yes
	}
}

# Shield Penetrated
country_event = {
	id = utopia.3171
	title = "utopia.3171.name"
	desc = "utopia.3171.desc"
	diplomatic = yes
	diplomatic_title = BLANK_STRING
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}

	option = {
		name = "exit.shroud"
		if = {
			limit = {
				NOR = {
					has_technology = tech_psionic_shield
					has_tech_option = tech_psionic_shield
				}
			}
			add_research_option = tech_psionic_shield
		}
		default_hide_option = yes
	}
}

# Failed to Penetrate Shield
country_event = {
	id = utopia.3172
	title = "utopia.3000.name"
	desc = "utopia.3172.desc"
	diplomatic = yes
	diplomatic_title = BLANK_STRING
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}

	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		hidden_effect = {
			country_event = { id = utopia.3024 }
		}
		default_hide_option = yes
	}
}

# Vision 9 - Precognition Interface
country_event = {
	id = utopia.3180
	title = "utopia.3000.name"
	desc = "utopia.3180.desc"
	diplomatic = yes
	diplomatic_title = BLANK_STRING
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}

	option = {
		name = "utopia.3180.a"
		custom_tooltip = "shroud.unknown.chances.medium"
		hidden_effect = {
			random_list = {
				60 = {
					country_event = { id = utopia.3181 }
				}
				40 = {
					modifier = {
						factor = 0.5
						has_relic = r_zro_crystal
					}
					country_Event = { id = utopia.3182 }
				}
			}
		}
	}
	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		default_hide_option = yes
	}
}

# Success
country_event = {
	id = utopia.3181
	title = "utopia.3181.name"
	desc = "utopia.3181.desc"
	diplomatic = yes
	diplomatic_title = BLANK_STRING
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}

	option = {
		name = "exit.shroud"
		if = {
			limit = {
				NOR = {
					has_technology = tech_precognition_interface
					has_tech_option = tech_precognition_interface
				}
			}
			add_research_option = tech_precognition_interface
		}
		default_hide_option = yes
	}
}

# Failure
country_event = {
	id = utopia.3182
	title = "utopia.3000.name"
	desc = "utopia.3182.desc"
	diplomatic = yes
	diplomatic_title = BLANK_STRING
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}

	option = {
		name = "exit.shroud"
		default_hide_option = yes
		hidden_effect = {
			remove_modifier = "shroud_cooldown"
			if = {
				limit = {
					has_relic = r_zro_crystal
				}
				add_modifier = {
					modifier = "shroud_precog_cooldown"
					days = 1800
				}
			}
			else = {
				add_modifier = {
					modifier = "shroud_precog_cooldown"
					days = 3600
				}
			}
		}
	}
}

# Vision 10 - Chosen One
country_event = {
	id = utopia.3190
	title = "utopia.3000.name"
	desc = "utopia.3190.desc"
	diplomatic = yes
	diplomatic_title = BLANK_STRING
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
		random_owned_leader = {
			limit = {
				tec_is_psionic_leader_is_chosen = yes
			}
			save_event_target_as = leader_1
			set_leader_flag = high_psi
		}
		random_owned_leader = {
			limit = {
				tec_is_psionic_leader = yes
				is_ruler = yes
			}

			if = {
				limit = {
					exists = event_target:leader_1
				}
				save_event_target_as = leader_2
			} else = {
				save_event_target_as = leader_1
			}
			random_list = {
				33 = { set_leader_flag = high_psi }
				33 = { set_leader_flag = medium_psi }
				33 = { set_leader_flag = low_psi }
			}
		}

		random_owned_leader = {
			limit = {
				NOT = { exists = event_target:leader_1 }
				tec_is_psionic_leader = yes
			}
			save_event_target_as = leader_1
			random_list = {
				33 = { set_leader_flag = high_psi }
				33 = { set_leader_flag = medium_psi }
				33 = { set_leader_flag = low_psi }
			}
		}
		random_owned_leader = {
			limit = {
				NOT = { exists = event_target:leader_2 }
				tec_is_psionic_leader = yes
				NOT = { is_same_value = event_target:leader_1 }
			}
			save_event_target_as = leader_2
			random_list = {
				33 = { set_leader_flag = high_psi }
				33 = { set_leader_flag = medium_psi }
				33 = { set_leader_flag = low_psi }
			}
		}

		random_owned_leader = {
			limit = {
				tec_is_psionic_leader = yes
				NOR = {
					is_same_value = event_target:leader_1
					is_same_value = event_target:leader_2
				}
			}
			save_event_target_as = leader_3
			random_list = {
				33 = { set_leader_flag = high_psi }
				33 = { set_leader_flag = medium_psi }
				33 = { set_leader_flag = low_psi }
			}
		}
		random_owned_leader = {
			limit = {
				tec_is_psionic_leader = yes
				NOR = {
					is_same_value = event_target:leader_1
					is_same_value = event_target:leader_2
					is_same_value = event_target:leader_3
				}
			}
			save_event_target_as = leader_4
			random_list = {
				33 = { set_leader_flag = high_psi }
				33 = { set_leader_flag = medium_psi }
				33 = { set_leader_flag = low_psi }
			}
		}

	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
			event_target:leader_1 = {
				remove_leader_flag = high_psi
				remove_leader_flag = medium_psi
				remove_leader_flag = low_psi
			}
			event_target:leader_2 = {
				remove_leader_flag = high_psi
				remove_leader_flag = medium_psi
				remove_leader_flag = low_psi
			}
			event_target:leader_3 = {
				remove_leader_flag = high_psi
				remove_leader_flag = medium_psi
				remove_leader_flag = low_psi
			}
			event_target:leader_4 = {
				remove_leader_flag = high_psi
				remove_leader_flag = medium_psi
				remove_leader_flag = low_psi
			}
		}
	}

	option = {
		name = "utopia.3190.1.a"
		custom_tooltip = "shroud.unknown.chances.high"
		trigger = {
			event_target:leader_1 = { has_leader_flag = high_psi }
		}
		event_target:leader_1 = { save_event_target_as = chosen_leader }
		hidden_effect = {
			random_list = {
				70 = { country_event = { id = utopia.3191 } }
				20 = { country_event = { id = utopia.3192 } }
				10 = {
					modifier = {
						factor = 0
						has_relic = r_zro_crystal
					}
					country_event = { id = utopia.3193 }
				}
			}
		}
	}
	option = {
		name = "utopia.3190.2.a"
		custom_tooltip = "shroud.unknown.chances.medium"
		trigger = {
			event_target:leader_1 = { has_leader_flag = medium_psi }
		}
		event_target:leader_1 = { save_event_target_as = chosen_leader }
		hidden_effect = {
			random_list = {
				50 = { country_event = { id = utopia.3191 } }
				30 = { country_event = { id = utopia.3192 } }
				20 = {
					modifier = {
						factor = 0
						has_relic = r_zro_crystal
					}
					country_event = { id = utopia.3193 }
				}
			}
		}
	}
	option = {
		name = "utopia.3190.3.a"
		custom_tooltip = "shroud.unknown.chances.low"
		trigger = {
			event_target:leader_1 = { has_leader_flag = low_psi }
		}
		event_target:leader_1 = { save_event_target_as = chosen_leader }
		hidden_effect = {
			random_list = {
				30 = { country_event = { id = utopia.3191 } }
				40 = { country_event = { id = utopia.3192 } }
				30 = {
					modifier = {
						factor = 0
						has_relic = r_zro_crystal
					}
					country_event = { id = utopia.3193 }
				}
			}
		}
	}
	option = {
		name = "utopia.3190.1.b"
		custom_tooltip = "shroud.unknown.chances.high"
		trigger = {
			exists = event_target:leader_2
			event_target:leader_2 = { has_leader_flag = high_psi }
		}
		event_target:leader_2 = { save_event_target_as = chosen_leader }
		hidden_effect = {
			random_list = {
				70 = { country_event = { id = utopia.3191 } }
				20 = { country_event = { id = utopia.3192 } }
				10 = {
					modifier = {
						factor = 0
						has_relic = r_zro_crystal
					}
					country_event = { id = utopia.3193 }
				}
			}
		}
	}
	option = {
		name = "utopia.3190.2.b"
		custom_tooltip = "shroud.unknown.chances.medium"
		trigger = {
			exists = event_target:leader_2
			event_target:leader_2 = { has_leader_flag = medium_psi }
		}
		event_target:leader_2 = { save_event_target_as = chosen_leader }
		hidden_effect = {
			random_list = {
				50 = { country_event = { id = utopia.3191 } }
				30 = { country_event = { id = utopia.3192 } }
				20 = {
					modifier = {
						factor = 0
						has_relic = r_zro_crystal
					}
					country_event = { id = utopia.3193 }
				}
			}
		}
	}
	option = {
		name = "utopia.3190.3.b"
		custom_tooltip = "shroud.unknown.chances.low"
		trigger = {
			exists = event_target:leader_2
			event_target:leader_2 = { has_leader_flag = low_psi }
		}
		event_target:leader_2 = { save_event_target_as = chosen_leader }
		hidden_effect = {
			random_list = {
				30 = { country_event = { id = utopia.3191 } }
				40 = { country_event = { id = utopia.3192 } }
				30 = {
					modifier = {
						factor = 0
						has_relic = r_zro_crystal
					}
					country_event = { id = utopia.3193 }
				}
			}
		}
	}

	option = {
		name = "utopia.3190.1.c"
		custom_tooltip = "shroud.unknown.chances.high"
		trigger = {
			exists = event_target:leader_3
			event_target:leader_3 = { has_leader_flag = high_psi }
		}
		event_target:leader_3 = { save_event_target_as = chosen_leader }
		hidden_effect = {
			random_list = {
				70 = { country_event = { id = utopia.3191 } }
				20 = { country_event = { id = utopia.3192 } }
				10 = {
					modifier = {
						factor = 0
						has_relic = r_zro_crystal
					}
					country_event = { id = utopia.3193 }
				}
			}
		}
	}
	option = {
		name = "utopia.3190.2.c"
		custom_tooltip = "shroud.unknown.chances.medium"
		trigger = {
			exists = event_target:leader_3
			event_target:leader_3 = { has_leader_flag = medium_psi }
		}
		event_target:leader_3 = { save_event_target_as = chosen_leader }
		hidden_effect = {
			random_list = {
				50 = { country_event = { id = utopia.3191 } }
				30 = { country_event = { id = utopia.3192 } }
				20 = {
					modifier = {
						factor = 0
						has_relic = r_zro_crystal
					}
					country_event = { id = utopia.3193 }
				}
			}
		}
	}
	option = {
		name = "utopia.3190.3.c"
		custom_tooltip = "shroud.unknown.chances.low"
		trigger = {
			exists = event_target:leader_3
			event_target:leader_3 = { has_leader_flag = low_psi }
		}
		event_target:leader_3 = { save_event_target_as = chosen_leader }
		hidden_effect = {
			random_list = {
				30 = { country_event = { id = utopia.3191 } }
				40 = { country_event = { id = utopia.3192 } }
				30 = {
					modifier = {
						factor = 0
						has_relic = r_zro_crystal
					}
					country_event = { id = utopia.3193 }
				}
			}
		}
	}

	option = {
		name = "utopia.3190.1.d"
		custom_tooltip = "shroud.unknown.chances.high"
		trigger = {
			exists = event_target:leader_4
			event_target:leader_4 = { has_leader_flag = high_psi }
		}
		event_target:leader_4 = { save_event_target_as = chosen_leader }
		hidden_effect = {
			random_list = {
				70 = { country_event = { id = utopia.3191 }}
				20 = { country_event = { id = utopia.3192 }}
				10 = {
					modifier = {
						factor = 0
						has_relic = r_zro_crystal
					}
					country_event = { id = utopia.3193 }
				}
			}
		}
	}
	option = {
		name = "utopia.3190.2.d"
		custom_tooltip = "shroud.unknown.chances.medium"
		trigger = {
			exists = event_target:leader_4
			event_target:leader_4 = { has_leader_flag = medium_psi }
		}
		event_target:leader_4 = { save_event_target_as = chosen_leader }
		hidden_effect = {
			random_list = {
				50 = { country_event = { id = utopia.3191 }}
				30 = { country_event = { id = utopia.3192 }}
				20 = {
					modifier = {
						factor = 0
						has_relic = r_zro_crystal
					}
					country_event = { id = utopia.3193 }
				}
			}
		}
	}
	option = {
		name = "utopia.3190.3.d"
		custom_tooltip = "shroud.unknown.chances.low"
		trigger = {
			exists = event_target:leader_4
			event_target:leader_4 = { has_leader_flag = low_psi }
		}
		event_target:leader_4 = { save_event_target_as = chosen_leader }
		hidden_effect = {
			random_list = {
				30 = { country_event = { id = utopia.3191 }}
				40 = { country_event = { id = utopia.3192 }}
				30 = {
					modifier = {
						factor = 0
						has_relic = r_zro_crystal
					}
					country_event = { id = utopia.3193 }
				}
			}
		}
	}

	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		default_hide_option = yes
	}
}

# Success - Chosen one
country_event = {	# MEMESIS LEADER TRAITS
	id = utopia.3191
	title = "utopia.3000.name"
	desc = "utopia.3191.desc"
	diplomatic = yes
	diplomatic_title = BLANK_STRING
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
		set_country_flag = shroud_vision_10
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}

	option = {
		name = "exit.shroud"
		default_hide_option = yes
		event_target:chosen_leader = {
			remove_all_negative_traits = yes
			remove_trait = leader_trait_psionic
			add_trait = leader_trait_chosen
		}
	}
}

# Failure
country_event = {
	id = utopia.3192
	title = "utopia.3000.name"
	desc = "utopia.3192.desc"
	diplomatic = yes
	diplomatic_title = BLANK_STRING
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}

	option = {
		name = "exit.shroud"
		event_target:chosen_leader = {
			kill_leader = { show_notification = no }
		}
		default_hide_option = yes
	}
}

# Critical Failure
country_event = {
	id = utopia.3193
	title = "utopia.3000.name"
	desc = "utopia.3193.desc"
	diplomatic = yes
	diplomatic_title = BLANK_STRING
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}

	option = {
		name = "exit.shroud"
		event_target:chosen_leader = {
			kill_leader = { show_notification = no }
		}
		hidden_effect = {
			country_event = { id = utopia.3024 }
		}
		default_hide_option = yes
	}
}

# Generic Vision
country_event = {
	id = utopia.3200
	title = "utopia.3000.name"
	desc = { text = utopia.3200.1.desc }
	desc = { text = utopia.3200.2.desc }
	desc = { text = utopia.3200.3.desc }
	desc = { text = utopia.3200.4.desc }
	desc = { text = utopia.3200.5.desc }
	desc = { text = utopia.3200.6.desc }
	desc = { text = utopia.3200.7.desc }
	desc = { text = utopia.3200.8.desc }
	desc = { text = utopia.3200.9.desc }
	
	diplomatic = yes
	diplomatic_title = BLANK_STRING
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
		randomize_shroud_flags = yes
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
		remove_shroud_flags = yes
	}

	### High
	option = {
		name = "boon.happiness.high"
		trigger = { has_country_flag = high.1 }
		custom_tooltip = "shroud.boon.chances.high"
		happiness_shroud_high = yes
	}
	option = {
		name = "boon.upkeep.high"
		trigger = { has_country_flag = high.2 }
		custom_tooltip = "shroud.boon.chances.high"
		upkeep_shroud_high = yes
	}
	option = {
		name = "boon.research.high"
		trigger = { has_country_flag = high.3 }
		custom_tooltip = "shroud.boon.chances.high"
		research_shroud_high = yes
	}
	option = {
		name = "boon.shields.high"
		trigger = { has_country_flag = high.4 }
		custom_tooltip = "shroud.boon.chances.high"
		shields_shroud_high = yes
	}
	option = {
		name = "boon.weapons.high"
		trigger = { has_country_flag = high.5 }
		custom_tooltip = "shroud.boon.chances.high"
		weapons_shroud_high = yes
	}
	option = {
		name = "boon.firing.high"
		trigger = { has_country_flag = high.6 }
		custom_tooltip = "shroud.boon.chances.high"
		firingrate_shroud_high = yes
	}
	option = {
		name = "boon.ethics.high"
		trigger = { has_country_flag = high.7 }
		custom_tooltip = "shroud.boon.chances.high"
		ethics_shroud_high = yes
	}
	option = {
		name = "boon.influence.high"
		trigger = { has_country_flag = high.8 }
		custom_tooltip = "shroud.boon.chances.high"
		influence_shroud_high = yes
	}
	option = {
		name = "boon.unity.high"
		trigger = { has_country_flag = high.9 }
		custom_tooltip = "shroud.boon.chances.high"
		unity_shroud_high = yes
	}
	option = {
		name = "boon.evasion.high"
		trigger = { has_country_flag = high.10 }
		custom_tooltip = "shroud.boon.chances.high"
		evasion_shroud_high = yes
	}
	option = {
		name = "boon.repair.high"
		trigger = { has_country_flag = high.11 }
		custom_tooltip = "shroud.boon.chances.high"
		repair_shroud_high = yes
	}
	option = {
		name = "boon.lifespans.high"
		trigger = { has_country_flag = high.12 }
		custom_tooltip = "shroud.boon.chances.high"
		lifespan_shroud_high = yes
	}
	option = {
		name = "boon.speed.high"
		trigger = { has_country_flag = high.13 }
		custom_tooltip = "shroud.boon.chances.high"
		speed_shroud_high = yes
	}
	option = {
		name = "boon.morale.high"
		trigger = { has_country_flag = high.14 }
		custom_tooltip = "shroud.boon.chances.high"
		morale_shroud_high = yes
	}
	option = {
		name = "boon.sensors.high"
		trigger = { has_country_flag = high.15 }
		custom_tooltip = "shroud.boon.chances.high"
		sensor_shroud_high = yes
	}
	option = {
		name = "shroud.avatar.high"
		trigger = { has_country_flag = high.16 }
		custom_tooltip = "shroud.boon.chances.high"
		avatar_shroud_high = yes
	}

	### Medium
	option = {
		name = "boon.happiness.medium"
		trigger = { has_country_flag = medium.1 }
		custom_tooltip = "shroud.boon.chances.medium"
		happiness_shroud_medium = yes
	}
	option = {
		name = "boon.upkeep.medium"
		trigger = { has_country_flag = medium.2 }
		custom_tooltip = "shroud.boon.chances.medium"
		upkeep_shroud_medium = yes
	}
	option = {
		name = "boon.research.medium"
		trigger = { has_country_flag = medium.3 }
		custom_tooltip = "shroud.boon.chances.medium"
		research_shroud_medium = yes
	}
	option = {
		name = "boon.shields.medium"
		trigger = { has_country_flag = medium.4 }
		custom_tooltip = "shroud.boon.chances.medium"
		shields_shroud_medium = yes
	}
	option = {
		name = "boon.weapons.medium"
		trigger = { has_country_flag = medium.5 }
		custom_tooltip = "shroud.boon.chances.medium"
		weapons_shroud_medium = yes
	}
	option = {
		name = "boon.firing.medium"
		trigger = { has_country_flag = medium.6 }
		custom_tooltip = "shroud.boon.chances.medium"
		firingrate_shroud_medium = yes
	}
	option = {
		name = "boon.ethics.medium"
		trigger = { has_country_flag = medium.7 }
		custom_tooltip = "shroud.boon.chances.medium"
		ethics_shroud_medium = yes
	}
	option = {
		name = "boon.influence.medium"
		trigger = { has_country_flag = medium.8 }
		custom_tooltip = "shroud.boon.chances.medium"
		influence_shroud_medium = yes
	}
	option = {
		name = "boon.unity.medium"
		trigger = { has_country_flag = medium.9 }
		custom_tooltip = "shroud.boon.chances.medium"
		unity_shroud_medium = yes
	}
	option = {
		name = "boon.evasion.medium"
		trigger = { has_country_flag = medium.10 }
		custom_tooltip = "shroud.boon.chances.medium"
		evasion_shroud_medium = yes
	}
	option = {
		name = "boon.repair.medium"
		trigger = { has_country_flag = medium.11 }
		custom_tooltip = "shroud.boon.chances.medium"
		repair_shroud_medium = yes
	}
	option = {
		name = "boon.lifespans.medium"
		trigger = { has_country_flag = medium.12 }
		custom_tooltip = "shroud.boon.chances.medium"
		lifespan_shroud_medium = yes
	}
	option = {
		name = "boon.speed.medium"
		trigger = { has_country_flag = medium.13 }
		custom_tooltip = "shroud.boon.chances.medium"
		speed_shroud_medium = yes
	}
	option = {
		name = "boon.morale.medium"
		trigger = { has_country_flag = medium.14 }
		custom_tooltip = "shroud.boon.chances.medium"
		morale_shroud_medium = yes
	}
	option = {
		name = "boon.sensors.medium"
		trigger = { has_country_flag = medium.15 }
		custom_tooltip = "shroud.boon.chances.medium"
		sensor_shroud_medium = yes
	}
	option = {
		name = "shroud.avatar.medium"
		trigger = { has_country_flag = medium.16 }
		custom_tooltip = "shroud.boon.chances.medium"
		avatar_shroud_medium = yes
	}

	### Low
	option = {
		name = "boon.happiness.low"
		trigger = { has_country_flag = low.1 }
		custom_tooltip = "shroud.boon.chances.low"
		happiness_shroud_low = yes
	}
	option = {
		name = "boon.upkeep.low"
		trigger = { has_country_flag = low.2 }
		custom_tooltip = "shroud.boon.chances.low"
		upkeep_shroud_low = yes
	}
	option = {
		name = "boon.research.low"
		trigger = { has_country_flag = low.3 }
		custom_tooltip = "shroud.boon.chances.low"
		research_shroud_low = yes
	}
	option = {
		name = "boon.shields.low"
		trigger = { has_country_flag = low.4 }
		custom_tooltip = "shroud.boon.chances.low"
		shields_shroud_low = yes
	}
	option = {
		name = "boon.weapons.low"
		trigger = { has_country_flag = low.5 }
		custom_tooltip = "shroud.boon.chances.low"
		weapons_shroud_low = yes
	}
	option = {
		name = "boon.firing.low"
		trigger = { has_country_flag = low.6 }
		custom_tooltip = "shroud.boon.chances.low"
		firingrate_shroud_low = yes
	}
	option = {
		name = "boon.ethics.low"
		trigger = { has_country_flag = low.7 }
		custom_tooltip = "shroud.boon.chances.low"
		ethics_shroud_low = yes
	}
	option = {
		name = "boon.influence.low"
		trigger = { has_country_flag = low.8 }
		custom_tooltip = "shroud.boon.chances.low"
		influence_shroud_low = yes
	}
	option = {
		name = "boon.unity.low"
		trigger = { has_country_flag = low.9 }
		custom_tooltip = "shroud.boon.chances.low"
		unity_shroud_low = yes
	}
	option = {
		name = "boon.evasion.low"
		trigger = { has_country_flag = low.10 }
		custom_tooltip = "shroud.boon.chances.low"
		evasion_shroud_low = yes
	}
	option = {
		name = "boon.repair.low"
		trigger = { has_country_flag = low.11 }
		custom_tooltip = "shroud.boon.chances.low"
		repair_shroud_low = yes
	}
	option = {
		name = "boon.lifespans.low"
		trigger = { has_country_flag = low.12 }
		custom_tooltip = "shroud.boon.chances.low"
		lifespan_shroud_low = yes
	}
	option = {
		name = "boon.speed.low"
		trigger = { has_country_flag = low.13 }
		custom_tooltip = "shroud.boon.chances.low"
		speed_shroud_low = yes
	}
	option = {
		name = "boon.morale.low"
		trigger = { has_country_flag = low.14 }
		custom_tooltip = "shroud.boon.chances.low"
		morale_shroud_low = yes
	}
	option = {
		name = "boon.sensors.low"
		trigger = { has_country_flag = low.15 }
		custom_tooltip = "shroud.boon.chances.low"
		sensor_shroud_low = yes
	}
	option = {
		name = "shroud.avatar.low"
		trigger = { has_country_flag = low.16 }
		custom_tooltip = "shroud.boon.chances.low"
		avatar_shroud_low = yes
	}

	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		default_hide_option = yes
	}
}

# Patron Spirit
country_event = {
	id = utopia.3300
	title = "utopia.3000.name"
	desc = "utopia.3300.desc"
	diplomatic = yes
	diplomatic_title = BLANK_STRING
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
		if = {
			limit = {
				NOT = { has_country_flag = offered_covenant }
			}
			set_country_flag = offered_covenant
		}
		if = {
			limit = {
				any_owned_leader = {
					has_trait = leader_trait_chosen
				}
			}
			random_owned_leader = {
				limit = {
					has_trait = leader_trait_chosen
				}
				save_event_target_as = chosen_one
			}
			set_country_flag = has_chosen_one
		}
		else = {
			random_list = {
				33 = {
					modifier = {
						factor = 2
						has_relic = r_zro_crystal
					}
					set_country_flag = patron_deity_chance_high 
				}
				33 = { set_country_flag = patron_deity_chance_medium }
				33 = {
					modifier = {
						factor = 0.5
						has_relic = r_zro_crystal
					}
					set_country_flag = patron_deity_chance_low 
				}
			}
		}
	}
	
	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
			remove_country_flag = patron_deity_chance_high
			remove_country_flag = patron_deity_chance_medium
			remove_country_flag = patron_deity_chance_low
		}
	}
	
	option = {
		name = "utopia.3300.1.a"
		custom_tooltip = "shroud.unknown.chances.high"
		trigger = {
			has_country_flag = patron_deity_chance_high
		}
		hidden_effect = {
			random_list = {
				70 = { country_event = { id = utopia.3303 } }
				20 = { country_event = { id = utopia.3302 } }
				10 = { country_event = { id = utopia.3301 } }
			}
		}
	}
	option = {
		name = "utopia.3300.1.b"
		custom_tooltip = "shroud.unknown.chances.medium"
		trigger = {
			has_country_flag = patron_deity_chance_medium
		}
		hidden_effect = {
			random_list = {
				50 = { country_event = { id = utopia.3303 } }
				30 = { country_event = { id = utopia.3302 } }
				20 = { country_event = { id = utopia.3301 } }
			}
		}
	}
	option = {
		name = "utopia.3300.1.c"
		custom_tooltip = "shroud.unknown.chances.low"
		trigger = {
			has_country_flag = patron_deity_chance_low
		}
		hidden_effect = {
			random_list = {
				30 = { country_event = { id = utopia.3303 } }
				40 = { country_event = { id = utopia.3302 } }
				30 = { country_event = { id = utopia.3301 } }
			}
		}
	}
	option = {
		name = "utopia.3300.1.d"
		custom_tooltip = "shroud.unknown.chances.high"
		trigger = {
			has_country_flag = has_chosen_one
		}
		hidden_effect = {
			random_list = {
				85 = { country_event = { id = utopia.3303 } }
				10 = { country_event = { id = utopia.3302 } }
				5 = { country_event = { id = utopia.3301 } }
			}
		}
	}
	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		default_hide_option = yes
	}
}

# Failure
country_event = {
	id = utopia.3301
	title = "utopia.3000.name"
	desc = "utopia.3301.desc"
	diplomatic = yes
	diplomatic_title = BLANK_STRING
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}

	option = {
		name = "exit.shroud"
		default_hide_option = yes
	}
}

# Critical Failure
country_event = {	# MEMESIS ADD EXTRA LEADER TRAITS
	id = utopia.3302
	title = "utopia.3000.name"
	desc = "utopia.3302.desc"
	diplomatic = yes
	diplomatic_title = BLANK_STRING
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
		random_owned_leader = {
			limit = {
				OR = {
					# Chosen one
					has_trait = leader_trait_chosen

					# Psionic
					has_trait = leader_trait_psionic
					
					# Pure of form

					# Cyberpsionic

				}
			}
			save_event_target_as = leader_to_kill
		}
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}

	option = {
		name = "exit.shroud"
		default_hide_option = yes
		event_target:leader_to_kill = {
			kill_leader = { show_notification = no }
		}
	}
}

# Pick a Patron to contact
# utopia.3303
# Pick a Patron to contact
country_event = {
	id = utopia.3303

	hide_window = yes
	is_triggered_only = yes

	immediate = {
		random_list = {
			25 = {	# The Whisperers in the Void
				modifier = {
					factor = 1.5
					tec_country_whisperers_civics_like = yes
				}
				modifier = {
					factor = 0.7
					tec_country_whisperers_civics_dislike = yes
				}
				modifier = {
					factor = 1.3
					tec_country_whisperers_ethics_like = yes
				}
				modifier = {
					factor = 1.5
					tec_country_whisperers_ethics_like = { fanatic = yes }
				}
				modifier = {
					factor = 0.3
					tec_country_whisperers_ethics_dislike = yes
				}
				modifier = {
					factor = 0
					tec_country_whisperers_ethics_dislike = { fanatic = yes }
					NOT = { has_country_flag = contact_whisperers }
				}
				modifier = {
					factor = 1.3
					tec_country_whisperers_traditions_like = yes
				}
				modifier = {
					factor = 1.3
					tec_country_whisperers_aps_like = yes
				}

				modifier = {
					factor = 1.6
					tec_country_whisperers_other_like = yes
				}

				modifier = {
					factor = 0.001
					OR = {
						has_country_flag = contact_composer
						has_country_flag = contact_eater
						has_country_flag = contact_instrument
					}
				}
				country_event = { id = utopia.3304 }
			}
			25 = {	# The Composer of Strands
				modifier = {
					factor = 1.5
					tec_country_composer_civics_like = yes
				}
				modifier = {
					factor = 0.7
					tec_country_composer_civics_dislike = yes
				}
				modifier = {
					factor = 1.3
					tec_country_composer_ethics_like = yes
				}
				modifier = {
					factor = 1.5
					tec_country_composer_ethics_like = { fanatic = yes }
				}
				modifier = {
					factor = 0.3
					tec_country_composer_ethics_dislike = yes
				}
				modifier = {
					factor = 0
					tec_country_composer_ethics_dislike = { fanatic = yes }
					NOT = { has_country_flag = contact_composer }
				}
				modifier = {
					factor = 1.3
					tec_country_composer_traditions_like = yes
				}
				modifier = {
					factor = 1.3
					tec_country_composer_aps_like = yes
				}
				modifier = {
					factor = 1.6
					tec_country_composer_other_like = yes
				}
				modifier = {
					factor = 0.001
					OR = {
						has_country_flag = contact_whisperers
						has_country_flag = contact_eater
						has_country_flag = contact_instrument
					}
				}
				country_event = { id = utopia.3305 }
			}
			25 = {	# The Eater of Worlds
				modifier = {
					factor = 1.5
					tec_country_eater_civics_like = yes
				}
				modifier = {
					factor = 0.7
					tec_country_eater_civics_dislike = yes
				}
				modifier = {
					factor = 1.3
					tec_country_eater_ethics_like = yes
				}
				modifier = {
					factor = 1.5
					tec_country_eater_ethics_like = { fanatic = yes }
				}
				modifier = {
					factor = 0.3
					tec_country_eater_ethics_dislike = yes
				}
				modifier = {
					factor = 0
					tec_country_eater_ethics_dislike = { fanatic = yes }
					NOT = { has_country_flag = contact_eater }
				}
				modifier = {
					factor = 1.3
					tec_country_eater_traditions_like = yes
				}
				modifier = {
					factor = 1.3
					tec_country_eater_aps_like = yes
				}
				modifier = {
					factor = 1.6
					tec_country_eater_other_like = yes
				}

				modifier = {
					factor = 0.001
					OR = {
						has_country_flag = contact_composer
						has_country_flag = contact_whisperers
						has_country_flag = contact_instrument
					}
				}
				country_event = { id = utopia.3306 }
			}
			25 = {	# The Instrument of Desire
				modifier = {
					factor = 1.5
					tec_country_instrument_civics_like = yes
				}
				modifier = {
					factor = 0.7
					tec_country_instrument_civics_dislike = yes
				}
				modifier = {
					factor = 1.3
					tec_country_instrument_ethics_like = yes
				}
				modifier = {
					factor = 1.5
					tec_country_instrument_ethics_like = { fanatic = yes }
				}
				modifier = {
					factor = 0.3
					tec_country_instrument_ethics_dislike = yes
				}
				modifier = {
					factor = 0
					tec_country_instrument_ethics_dislike = { fanatic = yes }
					NOT = { has_country_flag = contact_instrument }
				}
				modifier = {
					factor = 1.3
					tec_country_instrument_traditions_like = yes
				}
				modifier = {
					factor = 1.3
					tec_country_instrument_aps_like = yes
				}

				modifier = {
					factor = 1.6
					tec_country_instrument_other_like = yes
				}


				modifier = {
					factor = 0.001
					OR = {
						has_country_flag = contact_composer
						has_country_flag = contact_eater
						has_country_flag = contact_whisperers
					}
				}
				country_event = { id = utopia.3307 }
			}
			2 = {
				modifier = {
					factor = 5
					any_country = {
						NOT = { is_same_value = ROOT }
						has_crisis_level = crisis_level_5 # Someone wants to destroy the galaxy? Let's give them a challenge.
					}
				}
				modifier = {
					factor = 5
					has_country_flag = knights_met_end_of_cycle
				}
				modifier = {
					factor = 0.3
					OR = {
						has_country_flag = contact_composer
						has_country_flag = contact_eater
						has_country_flag = contact_instrument
						has_country_flag = contact_whisperers
					}
				}
				if = {
					limit = {
						NOT = { has_global_flag = end_of_the_cycle }
					}
					country_event = { id = utopia.3308 } # The End of the Cycle - extremely rare
				}
				else = {
					random_list = {
						25 = { country_event = { id = utopia.3304 } }	# The Whisperers in the Void
						25 = { country_event = { id = utopia.3305 } }	# The Composer of Strands
						25 = { country_event = { id = utopia.3306 } }	# The Eater of Worlds
						25 = { country_event = { id = utopia.3307 } }	# The Instrument of Desire
					}
				}
			}
		}
	}

	after = {
		remove_country_flag = contact_composer
		remove_country_flag = contact_eater
		remove_country_flag = contact_instrument
		remove_country_flag = contact_whisperers
	}
}


# The Whisperers in the Void
country_event = {
	id = utopia.3304
	title = "utopia.3000.name"
	desc = "utopia.3304.desc"
	diplomatic = yes
	diplomatic_title = BLANK_STRING
	force_open = yes

	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}

	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}

	option = {
		name = "utopia.3304.a"
		trigger = {
			NOT = { has_country_flag = tradition_covenant }
		}
		custom_tooltip = "covenant.tooltip"
		add_modifier = { modifier = covenant_whisperers_in_the_void_0 days = -1 }
		if = {
			limit = {
				has_first_contact_dlc = yes
			}
			add_modifier = { modifier = covenant_whisperers_in_the_void_0_fircon days = -1 }
		}
		begin_event_chain = {
			event_chain = "whisperers_covenant_chain"
			target = this
		}
		hidden_effect = {
			set_country_flag = has_shroud_patron
			set_country_flag = whisperers_covenant_confirmed
			country_event = { id = utopia.3310 } # Covenant Sealed
			set_variable = {
				which = whisperers_covenant_rank
				value = 1
			}
		}
	}
	option = { #Tradition Covenant
		name = "utopia.3304.a"
		trigger = {
			has_country_flag = tradition_covenant
		}
		custom_tooltip = "covenant.tooltip"
		add_modifier = { modifier = covenant_whisperers_in_the_void_0 days = -1 }
		if = {
			limit = {
				has_first_contact_dlc = yes
			}
			add_modifier = { modifier = covenant_whisperers_in_the_void_0_fircon days = -1 }
		}
		hidden_effect = {
			set_country_flag = has_shroud_patron
			remove_country_flag = tradition_covenant
			country_event = { id = utopia.3310 } # Covenant Sealed
			if = {
				limit = {
					tec_has_any_psionic_ascension_finished = yes
					NOT = { has_country_flag = confirmation_incoming }
				}
				country_event = { id = utopia.2658 days = 360 }
			}
		}
	}
	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		default_hide_option = yes
		hidden_effect = {
			remove_country_flag = form_covenant_flag
		}
	}
}

# The Composer of Strands
country_event = {
	id = utopia.3305
	title = "utopia.3000.name"
	desc = "utopia.3305.desc"
	diplomatic = yes
	diplomatic_title = BLANK_STRING
	force_open = yes

	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}

	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}

	option = {
		name = "utopia.3305.a"
		trigger = {
			NOT = { has_country_flag = tradition_covenant }
		}
		custom_tooltip = "covenant.tooltip"
		add_modifier = { modifier = covenant_composer_of_strands_0 days = -1 }
		begin_event_chain = {
			event_chain = "composer_covenant_chain"
			target = this
		}
		hidden_effect = {
			set_country_flag = has_shroud_patron
			set_country_flag = composer_covenant_confirmed
			country_event = { id = utopia.3310 } # Covenant Sealed
			set_variable = {
				which = composer_covenant_rank
				value = 1
			}
		}
	}
	option = { #Tradition Covenant
		name = "utopia.3305.a"
		trigger = {
			has_country_flag = tradition_covenant
		}
		custom_tooltip = "covenant.tooltip"
		add_modifier = { modifier = covenant_composer_of_strands_0 days = -1 }
		hidden_effect = {
			set_country_flag = has_shroud_patron
			remove_country_flag = tradition_covenant
			country_event = { id = utopia.3310 } # Covenant Sealed
			if = {
				limit = {
					tec_has_any_psionic_ascension_finished = yes
					NOT = { has_country_flag = confirmation_incoming }
				}
				country_event = { id = utopia.2658 days = 360 }
			}
		}
	}
	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		default_hide_option = yes
		hidden_effect = {
			remove_country_flag = form_covenant_flag
		}
	}
}


# The Eater of Worlds
country_event = {
	id = utopia.3306
	title = "utopia.3000.name"
	desc = "utopia.3306.desc"
	diplomatic = yes
	diplomatic_title = BLANK_STRING
	force_open = yes

	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}

	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}

	option = {
		name = "utopia.3306.a"
		trigger = {
			NOT = { has_country_flag = tradition_covenant }
		}
		custom_tooltip = "covenant.tooltip"
		add_modifier = { modifier = covenant_eater_of_worlds_0 days = -1 }
		begin_event_chain = {
			event_chain = "eater_covenant_chain"
			target = this
		}
		hidden_effect = {
			set_country_flag = has_shroud_patron
			set_country_flag = eater_covenant_confirmed
			country_event = { id = utopia.3310 } # Covenant Sealed
			random_owned_planet = {
				limit = {
					is_capital = no
					any_owned_pop = {
						is_sapient = yes
						is_robot_pop = no
					}
				}
				random_owned_pop = {
					limit = {
						is_sapient = yes
						is_robot_pop = no
					}
					kill_pop = yes
				}
			}
			set_variable = {
				which = eater_covenant_rank
				value = 1
			}
		}
	}
	option = { # tradition covenant
		name = "utopia.3306.a"
		trigger = {
			has_country_flag = tradition_covenant
		}
		custom_tooltip = "covenant.tooltip"
		add_modifier = { modifier = covenant_eater_of_worlds_0 days = -1 }
		hidden_effect = {
			set_country_flag = has_shroud_patron
			remove_country_flag = tradition_covenant
			country_event = { id = utopia.3310 } # Covenant Sealed
			random_owned_planet = {
				limit = {
					is_capital = no
					any_owned_pop = {
						is_sapient = yes
						is_robot_pop = no
					}
				}
				random_owned_pop = {
					limit = {
						is_sapient = yes
						is_robot_pop = no
					}
					kill_pop = yes
				}
			}
			if = {
				limit = {
					tec_has_any_psionic_ascension_finished = yes
					NOT = { has_country_flag = confirmation_incoming }
				}
				country_event = { id = utopia.2658 days = 360 }
			}
		}
	}
	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		default_hide_option = yes
		hidden_effect = {
			remove_country_flag = form_covenant_flag
		}
	}
}

# The Instrument of Desire
country_event = {
	id = utopia.3307
	title = "utopia.3000.name"
	desc = "utopia.3307.desc"
	diplomatic = yes
	diplomatic_title = BLANK_STRING
	force_open = yes

	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}

	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}

	option = {
		name = "utopia.3307.a"
		trigger = {
			NOT = { has_country_flag = tradition_covenant }
		}
		custom_tooltip = "covenant.tooltip"
		add_modifier = { modifier = covenant_instrument_of_desire_0 days = -1 }
		begin_event_chain = {
			event_chain = "instrument_covenant_chain"
			target = this
		}
		hidden_effect = {
			set_country_flag = has_shroud_patron
			set_country_flag = instrument_covenant_confirmed
			country_event = { id = utopia.3310 } # Covenant Sealed
			set_variable = {
				which = instrument_covenant_rank
				value = 1
			}
		}
	}
	option = { #Tradition Covenant
		name = "utopia.3307.a"
		trigger = {
			has_country_flag = tradition_covenant
		}
		custom_tooltip = "covenant.tooltip"
		add_modifier = { modifier = covenant_instrument_of_desire_0 days = -1 }
		hidden_effect = {
			set_country_flag = has_shroud_patron
			remove_country_flag = tradition_covenant
			country_event = { id = utopia.3310 } # Covenant Sealed
			if = {
				limit = {
					tec_has_any_psionic_ascension_finished = yes
					NOT = { has_country_flag = confirmation_incoming }
				}
				country_event = { id = utopia.2658 days = 360 }
			}
		}
	}
	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		default_hide_option = yes
		hidden_effect = {
			remove_country_flag = form_covenant_flag
		}
	}
}

# The End of the Cycle
# utopia.3308

# Covenant Sealed
#utopia.3310

# The End of the Cycle: Reckoning
# utopia.3320

# utopia.3321

# utopia.3322

# utopia.3323

# utopia.3324

# Covenant Side Effects - Gatekeeper event
# utopia.3330


# Whisperers - Voices in my Head
country_event = { # MEMESIS ADD EXTRA LEADER TRAITS
	id = utopia.3331
	title = "utopia.3331.name"
	desc = "utopia.3331.desc"
	picture = GFX_evt_unspeakable_horror
	show_sound = event_mystic_reveal
	location = root
	
	is_triggered_only = yes
	
	trigger = {
		any_owned_leader = {
			tec_is_psionic_leader_non_chosen = yes
			NOT = { has_trait_tier1or2 = { TRAIT = leader_trait_substance_abuser } }
		}
	}
	
	immediate = {
		random_owned_leader = {
			limit = {
				tec_is_psionic_leader_non_chosen = yes
				NOT = { has_trait_tier1or2 = { TRAIT = leader_trait_substance_abuser } }
			}
			save_event_target_as = leader_target		
		}
	}
	
	option = {
		name = "utopia.3331.opt.a"
		event_target:leader_target = {
			add_trait = "leader_trait_substance_abuser"
		}
	}
}

# Whisperers - Suicide
country_event = { # MEMESIS ADD EXTRA LEADER TRAITS
	id = utopia.3332
	title = "utopia.3332.name"
	desc = "utopia.3332.desc"
	picture = GFX_evt_unspeakable_horror
	show_sound = event_mystic_reveal
	location = root
	
	is_triggered_only = yes
	
	trigger = {
		any_owned_leader = {
			tec_is_psionic_leader_non_chosen = yes
		}
	}
	
	immediate = {
		random_owned_leader = {
			limit = {
				tec_is_psionic_leader_non_chosen = yes
			}
			save_event_target_as = leader_target		
		}
	}
	
	option = {
		name = "utopia.3332.opt.a"
		event_target:leader_target = {
			kill_leader = { show_notification = no }
		}
	}
}

# Whisperers - Dangerous Ideas - Faction drift and Stability
country_event = { # MEMESIS ADD EXTRA POP TRAITS
	id = utopia.3333
	title = "utopia.3333.name"
	desc = "utopia.3333.desc"
	picture = GFX_evt_unspeakable_horror
	show_sound = event_mystic_reveal
	location = root
	
	is_triggered_only = yes
	
	trigger = {
		any_owned_planet = {
			num_pops > 1
			NOR = {
				has_modifier = whisperers_madness
				has_modifier = whisperers_psychosis
			}
			any_owned_pop = {
				tec_is_total_psionic_species = yes
			}
		}
	}
	
	immediate = {
		random_owned_planet = {
			limit = {
				num_pops > 1
				NOR = {
					has_modifier = whisperers_madness
					has_modifier = whisperers_psychosis
				}
				any_owned_pop = {
					tec_is_total_psionic_species = yes
				}
			}
			random_owned_pop = {
				kill_pop = yes
			}
		}
	}
	
	option = {
		name = "utopia.3333.opt.a"
		add_modifier = {
			modifier = whisperers_madness
			days = 3600
		}
	}
}

# Whisperers - Psychosis - Unity loss and faction drift
country_event = { # MEMESIS ADD EXTRA POP TRAITS
	id = utopia.3334
	title = "utopia.3334.name"
	desc = "utopia.3334.desc"
	picture = GFX_evt_unspeakable_horror
	show_sound = event_mystic_reveal
	location = root
	
	is_triggered_only = yes
	
	trigger = {
		any_owned_planet = {
			num_pops > 1
			NOR = {
				has_modifier = whisperers_madness
				has_modifier = whisperers_psychosis
			}
			any_owned_pop = {
				tec_is_total_psionic_species = yes
			}
		}
	}
	
	immediate = {
		random_owned_planet = {
			limit = {
				num_pops > 1
				NOR = {
					has_modifier = whisperers_madness
					has_modifier = whisperers_psychosis
				}
				any_owned_pop = {
					tec_is_total_psionic_species = yes
				}
			}
			random_owned_pop = {
				kill_pop = yes
			}
		}
	}
	
	option = {
		name = "utopia.3334.opt.a"
		event_target:planet_target = {
			add_modifier = {
				modifier = whisperers_psychosis
				days = 3600
			}
		}
	}
}


# Eater - Nibbly - Eats Leader
# utopia.3335

# Eater - Hungry
# utopia.3336

# Eater - Ravenous
# utopia.3337

# Instrument - Deviant Planet
# utopia.3338

# Instrument - Deviant Empire
# utopia.3339

# Instrument - Consumer Goods
# utopia.3340

# Composer of Strands does his thing...
country_event = { # MEMESIS ADD EXTRA POP TRAITS
	id = utopia.3341
	title = "utopia.3341.name"
	desc = "utopia.3341.desc"
	picture = GFX_evt_unspeakable_horror
	show_sound = event_mystic_reveal
	location = root
	
	is_triggered_only = yes
	
	immediate = {
		random_owned_planet = {
			limit = {
				any_owned_pop = {
					tec_is_total_psionic_species = yes
				}
			}
			random_owned_pop = {
				limit = {
					tec_is_total_psionic_species = yes
				}
				species = { save_event_target_as = species_target }
			}
		}
	}
	
	option = {
		name = "utopia.3341.opt.a"
		event_target:species_target = {
			mutate_species = yes
		}
	}
}

# Eater - Hungry - Eats Chunk of planet
# utopia.3342

# Eater - Peckish - Eats 1 pop
# utopia.3343

#Instrument - flag cleanup event
# utopia.3344

# Composer of Strands - Leader devolves in a writhing mass
country_event = {
	id = utopia.3345
	title = "utopia.3345.name"
	desc = "utopia.3345.desc"
	picture = GFX_evt_unspeakable_horror
	show_sound = event_mystic_reveal
	location = root

	is_triggered_only = yes

	trigger = {
		any_owned_leader = {
			tec_is_psionic_leader_non_chosen = yes
		}
	}

	immediate = {
		random_owned_leader = {
			limit = {
				tec_is_psionic_leader_non_chosen = yes
			}
			save_event_target_as = leader_target
		}
	}

	option = {
		name = "utopia.3345.opt.a"
		event_target:leader_target = {
			kill_leader = { show_notification = no }
		}
	}
}

# Composer of Strands - Pops get devolved
country_event = {
	id = utopia.3346
	title = "utopia.3346.name"
	desc = "utopia.3346.desc"
	picture = GFX_evt_unspeakable_horror
	show_sound = event_mystic_reveal
	location = event_target:devolved_species_planet

	is_triggered_only = yes

	trigger = {
		any_owned_planet = {
			count_owned_pop = {
				count >= 8
				limit = {
					is_sapient = yes
					tec_is_total_psionic_species = yes
					has_presapient_trait = no
				}
			}
		}
	}

	immediate = {
		random_owned_planet = {
			limit = {
				count_owned_pop = {
					count >= 8
					limit = {
						is_sapient = yes
						tec_is_total_psionic_species = yes
						has_presapient_trait = no
					}
				}
			}
			save_event_target_as = devolved_species_planet
			random_owned_pop = {
				limit = {
					is_sapient = yes
					tec_is_total_psionic_species = yes
					has_presapient_trait = no
				}
				species = { save_event_target_as = species_target }
				create_random_devolved_species = yes
			}
			while = {
				count = 4
				random_owned_pop = {
					limit = {
						is_sapient = yes
						tec_is_total_psionic_species = yes
						has_presapient_trait = no
					}
					change_species = event_target:devolved_species_target
				}
			}
			check_planet_employment = yes
		}
	}

	option = {
		name = "utopia.3346.opt.a"
		custom_tooltip = utopia.3346.opt.a.tt
	}
}

# Chosen One becomes ruler
country_event = { # MEMESIS REVIEW - NEW CIVICS MAYBE?
	id = utopia.3400
	title = "utopia.3400.name"
	desc = "utopia.3400.desc"
	picture = GFX_evt_psionics
	show_sound = event_mystic_reveal
	
	trigger = {
		tec_is_default_country = yes
		NOT = { has_country_flag = chosen_one_ruler_event }
		# Why block in some cases, we handle that in option below
		# OR = {
		#	is_democratic_authority = yes
		#	is_oligarchic_authority = yes
		#	is_dictatorial_authority = yes
		#	# MegaCorps deliberately excluded.
		# 	has_authority = auth_tec_patrocorporate
		# }
		is_regular_empire = yes
		any_owned_leader = {
			tec_is_psionic_leader_is_chosen = yes
		}
	}

	mean_time_to_happen = {
		months = 120
	}
	
	immediate = {
		set_country_flag = chosen_one_ruler_event
		random_owned_leader = {
			limit = {
				tec_is_psionic_leader_is_chosen = yes
			}
			save_event_target_as = chosen_one
			species = { save_event_target_as = chosen_one_species }
		}
	}
	
	option = {
		name = "utopia.3400.a"
		ai_chance = {
			factor = 100
			modifier = {
				factor = 40
				has_ethic = ethic_egalitarian
			}
			modifier = {
				factor = 80
				has_ethic = ethic_fanatic_egalitarian
			}
		}
		custom_tooltip = reject_god_emperor
	}
	option = {
		name = "utopia.3400.b"
		ai_chance = {
			factor = 150
			modifier = {
				factor = 40
				has_ethic = ethic_authoritarian
			}
			modifier = {
				factor = 80
				has_ethic = ethic_fanatic_authoritarian
			}
		}
		#
		if = {
			limit = {
				has_ethic = ethic_fanatic_authoritarian
				has_ethic = ethic_fanatic_spiritualist
			}
			# Do nothing
			set_timed_country_flag = {
				flag = tec_uh_this_does_nothing
				days = 1
			}
		}
		else_if = {
			limit = {
				has_ethic = ethic_fanatic_spiritualist
				NOR = {
					has_ethic = ethic_fanatic_authoritarian
					has_ethic = ethic_authoritarian
				}
			}
			shift_ethic = "ethic_authoritarian"
			shift_ethic = "ethic_fanatic_spiritualist"
		}
		else_if = {
			limit = {
				has_ethic = ethic_fanatic_authoritarian
				NOR = {
					has_ethic = ethic_spiritualist
					has_ethic = ethic_fanatic_spiritualist
				}
			}
			shift_ethic = "ethic_fanatic_authoritarian"
			shift_ethic = "ethic_spiritualist"
		}
		else = {
			shift_ethic = "ethic_fanatic_authoritarian"
			shift_ethic = "ethic_spiritualist"
		}
		if = {
			limit = {
				is_megacorp = no
				OR = {
					tec_is_aiauth_empire = no
					AND = {
						tec_is_aiauth_empire = yes
						ruler = {
							NOT = { is_same_value = event_target:chosen_one }
						}
					}
				}
				NOT = { has_origin = origin_legendary_leader_dictatorial }
			}
			change_government = {
				authority = auth_tec_theocracy
				cooldown = no
				remove_invalid_civics = yes
			}
		}
		# TODO - ROdah we need to review this, added as below mostly to not bork the origin for now
		if = {
			limit = {
				has_origin = origin_legendary_leader_dictatorial
			}
			set_origin = origin_legendary_leader_imperial
			change_government = {
				authority = auth_imperial
				cooldown = no
				remove_invalid_civics = yes
			}
		}
		if = {
			limit = {
				is_megacorp = yes
				OR = {
					tec_is_aiauth_empire = no
					AND = {
						tec_is_aiauth_empire = yes
						ruler = {
							NOT = { is_same_value = event_target:chosen_one }
						}
					}
				}
			}
			change_government = {
				authority = auth_tec_patrocorporate
				remove_invalid_civics = yes
				cooldown = no
			}
		}

		force_add_civic = civic_psionic_sovereign
		set_government_cooldown = no
		ruler = {
			exile_leader_as = destituted_ruler_chosen_one
		}
		set_leader = event_target:chosen_one
		hidden_effect = {
			every_country = {
				limit = {
					is_ai = no
					NOT = { is_same_value = root }
					has_communications = root
				}
				country_event = { id = utopia.3401 days = 4 }
			}
			country_event = { id = utopia.3402 days = 5 }
		}
	}
}

# Empire accepts Chosen One as ruler
# utopia.3401

# Change empire name
# utopia.3402