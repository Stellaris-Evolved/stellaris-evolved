# events\!_antidesync_events.txt

namespace = antidesync_evolved

#antidesync_evolved.10XX = leader desyncs
#antidesync_evolved.20XX = pop desyncs
#antidesync_evolved.30XX = modifier desyncs (not detected)

#antidesync_evolved.90XX = bandaids


# ---- First round! Leaders getting mismatched ethics!
# scope: country, from: leader
#on_added_to_leader_pool

country_event = {
	id = antidesync_evolved.1001
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		always = yes
	}

	immediate = {
		from = {
			save_event_target_as = tec_temp_leader
			# Changes ethic to gestalt to normalize
			change_background_ethic = ethic_gestalt_consciousness
			# We sample from the population of the species and apply an ethic
			creator = {
				random_owned_pop = {
					limit = {
						is_exact_same_species = event_target:tec_temp_leader
						NOR = {
							has_trait = trait_mechanical
							has_trait = trait_tec_bioservant
							has_trait = trait_zombie
							has_trait = trait_nerve_stapled
							has_trait = trait_presapient_proles
							has_trait = trait_syncretic_proles
						}
					}
					switch = {
						trigger = has_ethic
						# Vanilla
						ethic_authoritarian = {
							event_target:tec_temp_leader = {
								change_background_ethic = ethic_authoritarian
							}
						}
						ethic_egalitarian = {
							event_target:tec_temp_leader = {
								change_background_ethic = ethic_egalitarian
							}
						}
						ethic_xenophobe = {
							event_target:tec_temp_leader = {
								change_background_ethic = ethic_xenophobe
							}
						}
						ethic_xenophile = {
							event_target:tec_temp_leader = {
								change_background_ethic = ethic_xenophile
							}
						}
						ethic_militarist = {
							event_target:tec_temp_leader = {
								change_background_ethic = ethic_militarist
							}
						}
						ethic_pacifist = {
							event_target:tec_temp_leader = {
								change_background_ethic = ethic_pacifist
							}
						}
						ethic_spiritualist = {
							event_target:tec_temp_leader = {
								change_background_ethic = ethic_spiritualist
							}
						}
						ethic_materialist = {
							event_target:tec_temp_leader = {
								change_background_ethic = ethic_materialist
							}
						}
						# Evolved
						ethic_cooperative = {
							event_target:tec_temp_leader = {
								change_background_ethic = ethic_cooperative
							}
						}
						ethic_competitive = {
							event_target:tec_temp_leader = {
								change_background_ethic = ethic_competitive
							}
						}
						ethic_ecologist = {
							event_target:tec_temp_leader = {
								change_background_ethic = ethic_ecologist
							}
						}
						ethic_industrialist = {
							event_target:tec_temp_leader = {
								change_background_ethic = ethic_industrialist
							}
						}
						ethic_elitist = {
							event_target:tec_temp_leader = {
								change_background_ethic = ethic_elitist
							}
						}
						ethic_pluralist = {
							event_target:tec_temp_leader = {
								change_background_ethic = ethic_pluralist
							}
						}
						# Gestalt
						ethic_gestalt_consciousness = {
							event_target:tec_temp_leader = {
								change_background_ethic = ethic_gestalt_consciousness
							}
						}
					}
				}
			}
			# Now that ethics have been changed...
			# Technically this event should trigger before extra traits
			# So lets nuke it
			remove_all_traits = yes
			set_variable = {
				which = var_level
				value = trigger:has_skill
			}
			change_variable = {
				which = var_level
				value = -1
			}
			set_skill = 1
			# Adds a new starting trait
			# (now weighted properly by non ghost ethics)
			add_trait_no_notify = "random_common"
			# Increases the skills equal to the level -1
			if = {
				limit = {
					check_variable = {
						which = var_level
						value > 0
					}
				}
				add_skill_without_trait_selection = var_level
			}
			# Lets clean it
			clear_variable = var_level
		}
	}
}
country_event = { # Leader level handler
	id = antidesync_evolved.1002
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		always = yes
	}

	immediate = {
		from = {
			set_skill = trigger:has_skill
		}
		#every_owned_leader = {
		#	set_skill = trigger:has_skill
		#}
	}
}



# ---- Second round! Pops getting mismatched ethics!
# Triggered at on_pop_ethic_changed
# Just to be sure, on_pop_added too

pop_event = {
	id = antidesync_evolved.2001
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		always = yes
	}

	immediate = {
		# Lets shoehorn the ethic to see if this works
		switch = {
			trigger = has_ethic
			# Vanilla
			ethic_authoritarian = {
				pop_change_ethic = ethic_authoritarian
			}
			ethic_egalitarian = {
				pop_change_ethic = ethic_egalitarian
			}
			ethic_xenophobe = {
				pop_change_ethic = ethic_xenophobe
			}
			ethic_xenophile = {
				pop_change_ethic = ethic_xenophile
			}
			ethic_militarist = {
				pop_change_ethic = ethic_militarist
			}
			ethic_pacifist = {
				pop_change_ethic = ethic_pacifist
			}
			ethic_spiritualist = {
				pop_change_ethic = ethic_spiritualist
			}
			ethic_materialist = {
				pop_change_ethic = ethic_materialist
			}
			# Evolved
			ethic_cooperative = {
				pop_change_ethic = ethic_cooperative
			}
			ethic_competitive = {
				pop_change_ethic = ethic_competitive
			}
			ethic_ecologist = {
				pop_change_ethic = ethic_ecologist
			}
			ethic_industrialist = {
				pop_change_ethic = ethic_industrialist
			}
			ethic_elitist = {
				pop_change_ethic = ethic_elitist
			}
			ethic_pluralist = {
				pop_change_ethic = ethic_pluralist
			}
			# Gestalt
			ethic_gestalt_consciousness = {
				wipe_pop_ethos = yes
			}
			# Gestalt evolved
			ethic_gestalt_overconsumption = {
				pop_change_ethic = ethic_gestalt_consciousness
			}
			ethic_gestalt_preservation = {
				pop_change_ethic = ethic_gestalt_consciousness
			}
			ethic_gestalt_empathy = {
				pop_change_ethic = ethic_gestalt_consciousness
			}
			ethic_gestalt_apathy = {
				pop_change_ethic = ethic_gestalt_consciousness
			}
			ethic_gestalt_introspective = {
				pop_change_ethic = ethic_gestalt_consciousness
			}
			ethic_gestalt_extrospective = {
				pop_change_ethic = ethic_gestalt_consciousness
			}
		}
	}
}

# just to be sure...
	# A pop has been added to the planet
	# Root = pop
	# From = planet
	#