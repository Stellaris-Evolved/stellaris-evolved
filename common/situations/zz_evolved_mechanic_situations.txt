# common\situations\zz_evolved_mechanic_situations.txt

situation_tec_psionic_planet_ascension = {
	desc = {
		text = situation_tec_psionic_planet_ascension_desc
		trigger = {
			hidden_trigger = {
				always = yes
			}
		}
	}
	picture = GFX_evt_psionics
	category = positive
	complete_icon_frame = GFX_situation_outcome_frame_green
	complete_icon = GFX_situation_outcome_unknown
	fail_icon_frame = GFX_situation_outcome_frame_red
	fail_icon = GFX_situation_outcome_negative
	start_value = 0

	progress_direction = monodirectional

	on_start = {
		set_situation_locked = no
	}

	on_fail = {
		# This should never happen, but if it does...
		owner = {
			start_situation = {
				type = situation_tec_psionic_planet_ascension
				target = prev.target
				effect = {
					copy_flags_and_variables_from = prevprev
				}
			}
		}
		destroy_situation = this
	}

	on_monthly = {
		# nothing for now
		random_events = {
			# Nothing
			200 = 0
			# Negative random outcomes
			#2 = tec_gene_path.200011
			#2 = tec_gene_path.200012
			#1 = tec_gene_path.200013
			# Positive random outcomes
			#2 = tec_gene_path.200021
			#2 = tec_gene_path.200022
			#1 = tec_gene_path.200023
		}
	}

	on_progress_complete = {
		hidden_effect = {
			target = {
				planet_event = {
					id = tec_psionic_path.20001
				}
			}
			owner = {
				start_situation = {
					type = situation_tec_psionic_planet_ascension
					target = prev.target
					effect = {
						copy_flags_and_variables_from = prevprev
						prevprev = {
							switch = {
								trigger = current_situation_approach
								situation_approach_tec_psionic_planet_ascension_normal = {
									prev = {
										set_situation_approach = situation_approach_tec_psionic_planet_ascension_normal
									}
								}
								situation_approach_tec_psionic_planet_ascension_forced = {
									prev = {
										set_situation_approach = situation_approach_tec_psionic_planet_ascension_forced
									}
								}
								situation_approach_tec_psionic_planet_ascension_slaves = {
									prev = {
										set_situation_approach = situation_approach_tec_psionic_planet_ascension_slaves
									}
								}
								situation_approach_tec_psionic_planet_ascension_xenos = {
									prev = {
										set_situation_approach = situation_approach_tec_psionic_planet_ascension_xenos
									}
								}
							}
						}
					}
				}
			}
		}
		custom_tooltip = situation_tec_psionic_planet_ascension_end_tooltip
		destroy_situation = this
	}

	stages = {
		# Under 0
		situation_tec_psionic_planet_ascension_stage_1 = {
			icon = GFX_situation_stage_1
			icon_background = GFX_situation_stage_frame_blue
			end = 120
			on_first_enter = {
				#hidden_effect = {
				#	situation_event = {
				#		id = tec_gene_path.100115
				#	}
				#}
			}
		}
	}

	# Approaches
	approach = { # Basic
		name = situation_approach_tec_psionic_planet_ascension_normal
		icon = GFX_situation_approach_pop
		icon_background = GFX_situation_approach_bg_tec_purple
		on_select = {
			custom_tooltip = situation_approach_tec_psionic_planet_ascension_normal_desc
			hidden_effect = {
				target = {
					remove_planet_flag = tec_psionic_planet_ascension_normal
					remove_planet_flag = tec_psionic_planet_ascension_slaves
					remove_planet_flag = tec_psionic_planet_ascension_xenos
					set_planet_flag = tec_psionic_planet_ascension_normal
				}
			}
		}
		default = yes
		resources = {
			category = situations
			upkeep = {
				trigger = {
					NOT = { has_situation_flag = situation_tec_psionic_first_ascension_planet }
				}
				sr_zro = 5
			}
		}

		ai_weight = {
			base = 1
		}
	}

	approach = { # Accelerated
		name = situation_approach_tec_psionic_planet_ascension_forced
		icon = GFX_situation_approach_tec_mind
		icon_background = GFX_situation_approach_bg_tec_purple
		potential = {
			hidden_trigger = {
				owner = { is_ai = no }
			}
		}
		on_select = {
			custom_tooltip = situation_approach_tec_psionic_planet_ascension_forced_desc
			target = {
				remove_planet_flag = tec_psionic_planet_ascension_normal
				remove_planet_flag = tec_psionic_planet_ascension_slaves
				remove_planet_flag = tec_psionic_planet_ascension_xenos
				set_planet_flag = tec_psionic_planet_ascension_normal
			}
		}
		resources = {
			category = situations
			upkeep = {
				trigger = {
					NOT = { has_situation_flag = situation_tec_psionic_first_ascension_planet }
				}
				sr_zro = 5
			}
			upkeep = {
				sr_zro = 10
			}
		}

		ai_weight = {
			base = 0
		}
	}

	approach = { # Slaves
		name = situation_approach_tec_psionic_planet_ascension_slaves
		icon = GFX_situation_approach_fist
		icon_background = GFX_situation_approach_bg_tec_purple
		on_select = {
			custom_tooltip = situation_approach_tec_psionic_planet_ascension_slaves_desc
			target = {
				remove_planet_flag = tec_psionic_planet_ascension_normal
				remove_planet_flag = tec_psionic_planet_ascension_slaves
				remove_planet_flag = tec_psionic_planet_ascension_xenos
				set_planet_flag = tec_psionic_planet_ascension_slaves
			}
		}
		potential = {
			exists = owner
			owner = {
				allows_slavery = yes
			}
		}

		resources = {
			category = situations
			upkeep = {
				trigger = {
					NOT = { has_situation_flag = situation_tec_psionic_first_ascension_planet }
				}
				sr_zro = 5
			}
		}

		ai_weight = {
			add = 10
		}
	}

	approach = { # Xenos
		name = situation_approach_tec_psionic_planet_ascension_xenos
		icon = GFX_situation_approach_kneel
		icon_background = GFX_situation_approach_bg_tec_purple
		on_select = {
			custom_tooltip = situation_approach_tec_psionic_planet_ascension_xenos_desc
			target = {
				remove_planet_flag = tec_psionic_planet_ascension_normal
				remove_planet_flag = tec_psionic_planet_ascension_slaves
				remove_planet_flag = tec_psionic_planet_ascension_xenos
				set_planet_flag = tec_psionic_planet_ascension_xenos
			}
		}
		potential = {
			exists = owner
			owner = {
				is_xenophobe = yes
			}
		}

		resources = {
			category = situations
			upkeep = {
				trigger = {
					NOT = { has_situation_flag = situation_tec_psionic_first_ascension_planet }
				}
				sr_zro = 5
			}
		}

		ai_weight = {
			add = 100
		}
	}

	# /

	monthly_progress = {
		base = 0
		# Debug
		modifier = {
			add = 10
			desc = EXCELLENT
			OR = {
				has_situation_flag = situation_tec_debug
				owner = {
					has_country_flag = situation_tec_debug
				}
			}
		}
		modifier = {
			add = 5
			desc = EXCELLENT
			OR = {
				has_situation_flag = situation_tec_debug_2
				owner = {
					has_country_flag = situation_tec_debug_2
				}
			}
		}
		modifier = {
			add = -10
			desc = EXCELLENT
			OR = {
				has_situation_flag = situation_tec_debug_negative
				owner = {
					has_country_flag = situation_tec_debug_negative
				}
			}
		}
		modifier = {
			add = -5
			desc = EXCELLENT
			OR = {
				has_situation_flag = situation_tec_debug_negative_2
				owner = {
					has_country_flag = situation_tec_debug_negative_2
				}
			}
		}
		# /
		# Approaches
		modifier = {
			add = 1
			desc = situation_approach_tec_psionic_planet_ascension_normal
			current_situation_approach = situation_approach_tec_psionic_planet_ascension_normal
		}
		modifier = {
			add = 2
			desc = situation_approach_tec_psionic_planet_ascension_forced
			current_situation_approach = situation_approach_tec_psionic_planet_ascension_forced
		}
		modifier = {
			add = 1
			desc = situation_approach_tec_psionic_planet_ascension_slaves
			current_situation_approach = situation_approach_tec_psionic_planet_ascension_slaves
		}
		modifier = {
			add = 1
			desc = situation_approach_tec_psionic_planet_ascension_xenos
			current_situation_approach = situation_approach_tec_psionic_planet_ascension_xenos
		}
		modifier = {
			mult = 0.2
			desc = situation_tec_psionic_planet_ascension_slow_progression
			has_situation_flag = situation_tec_psionic_first_ascension_planet
			exists = owner
			NOT = {
				owner = {
					has_country_flag = tec_psionics_t2_completed
				}
			}
		}
		modifier = {
			mult = 0
			desc = sr_zro_deficit
			exists = owner
			owner = {
				OR = {
					has_deficit = sr_zro
					has_modifier = sr_zro_deficit
					has_actual_deficit = {
						RESOURCE = sr_zro
					}
				}
			}
		}
	}

	abort_trigger = {
		OR = {
			NOT = { exists = owner }
			#NOT = { exists = target.owner }
			#target.owner = {
			#	NOT = { is_same_value = prevprev.owner }
			#}
		}

	}
}