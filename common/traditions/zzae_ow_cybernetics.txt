# common\traditions\zzae_ow_cybernetics.txt

#	1
# 2		4
# 3		5

tr_cybernetics_adopt = {
	possible = {
		if = {
			limit = {
				tec_has_cybernetic_ascension_origin = yes
			}
			has_technology = tech_integrated_cybernetics
		}
		else = {
			custom_tooltip = {
				text = tr_tec_cybernetics_path_unlocked
				OR = {
					has_country_flag = tec_unlocks_tradition_cybernetics
					has_country_flag = tec_cybernetic_t1_assimilation
				}
			}
		}
	}

	unlocks_agenda = agenda_cybernetic_advantage
	custom_tooltip = tr_cybernetics_adopt_tooltip

	on_enabled = {
		hidden_effect = {
			# This is all moved to on_tradition_picked :
			# tec_cybernetic_path.110
		}
	}

	ai_weight = {
		factor = 1000
	}

	tradition_swap = {
		name = tr_cybernetics_adopt_utopia
		inherit_name = yes
		inherit_icon = yes
		trigger = {
			has_machine_age_dlc = no
			is_hive_empire = no
		}
		custom_tooltip = tr_cybernetics_adopt_utopia_tooltip
		on_enabled = {
			hidden_effect = {
				# Allows assimilation of cyborg pops into cyborgs
				set_country_flag = tec_cybernetic_t1_assimilation
				# Assimilation gives extra resources
				# Added on previous flag
				country_event = { # TODO ASCENSION EVENT FOR CYBERNETICS
					id = utopia.2500
				}
			}
		}
		weight = {
			factor = 1
		}
	}

	tradition_swap = {
		name = tr_cybernetics_adopt_hive
		inherit_name = yes
		inherit_icon = yes
		trigger = {
			is_hive_empire = yes
			has_machine_age_dlc = yes
		}
		custom_tooltip = tr_cybernetics_adopt_hive_tooltip
		on_enabled = {
			hidden_effect = {
				# Allows assimilation of cyborg pops into cyborgs
				set_country_flag = tec_cybernetic_t1_assimilation
				# Assimilation gives extra resources
				# Added on previous flag
				country_event = { # TODO ASCENSION CHECK SITUATION
					id = cyber.1
				}
			}
		}
		weight = {
			factor = 1
		}
	}

	tradition_swap = {
		name = tr_cybernetics_adopt_hive_utopia
		inherit_name = yes
		inherit_icon = yes
		trigger = {
			is_hive_empire = yes
			has_machine_age_dlc = no
		}
		custom_tooltip = tr_cybernetics_adopt_hive_utopia_tooltip
		on_enabled = {
			hidden_effect = {
				# Allows assimilation of cyborg pops into cyborgs
				set_country_flag = tec_cybernetic_t1_assimilation
				# Assimilation gives extra resources
				# Added on previous flag
				country_event = { # TODO ASCENSION EVENT FOR CYBERNETICS
					id = utopia.2500
				}
			}
		}
		weight = {
			factor = 1
		}
	}
}

tr_cybernetics_finish = {

	custom_tooltip = tr_cybernetics_finish_tooltip
	triggered_modifier = {
		potential = {
			OR = {
				has_machine_age_dlc = no
				has_country_flag = cybernetics_traditions_unlocked
			}
		}
		BIOLOGICAL_species_trait_picks_add = 1
		# BIOSERVANT_species_trait_picks_add = 1
		# REPLICANT_species_trait_picks_add = 1
		ROBOT_species_trait_picks_add = 1
		MACHINE_species_trait_picks_add = 1
		ascension_perks_add = 1
	}

	on_enabled = {
		# T2 Gate
		hidden_effect = {
			
			# Allows assimilation of cyborg pops into cyborgs
			# Assimilation gives extra resources
			set_country_flag = tec_cybernetic_t1_assimilation
			# Added on previous flag

			refresh_portraits = character
			set_country_flag = tec_cybernetics_gate
			country_event = { # GATE/MIXED Announcer
				id = tec_cybernetic_path.150
				days = 360
			}
			if = { # MACHINE AGE
				limit = {
					has_machine_age_dlc = yes
					has_country_flag = cybernetics_traditions_unlocked
					NOT = { has_origin = origin_cybernetic_creed }
				}
				country_event = {
					id = cyber.500
					days = 180
				}
			}
			if = {	# LUMINARY Things
				limit = {
					OR = {
						has_origin = origin_legendary_leader_dictatorial
						AND = {
							has_country_flag = paragon_origin_reformists_gone
							has_origin = origin_legendary_leader_imperial
						}
					}
					NOT = { has_country_flag = luminary_ascension_path }
					exists = ruler
					ruler = { has_leader_flag = paragon_origin_legendary_leader }
				}
				country_event = {
					id = paragon.5201 days = 3600 random = 7200
				}
			}
		}
	}

	ai_weight = {
		factor = 1000
	}

	tradition_swap = {
		name = tr_cybernetics_finish_situation
		inherit_name = yes
		inherit_icon = yes
		trigger = {
			has_machine_age_dlc = yes
			NOT = { has_country_flag = cybernetics_traditions_unlocked }
		}
		custom_tooltip = tr_cybernetics_finish_situation_effects
	}
}

tr_cybernetics_transubstantiation_synthesis = {
	possible = {
		if = {
			limit = { has_machine_age_dlc = no }
			if = {
				limit = { is_cyborg_empire = yes }
			}
			else = {
				custom_tooltip = {
					fail_text = REQUIRES_CYBORG_EMPIRE_UTOPIA
					is_cyborg_empire = yes
				}
			}
		}
	}
	custom_tooltip = tr_cybernetics_transubstantiation_synthesis_tooltip

	on_enabled = {
		hidden_effect = {
			refresh_portraits = character
		}
	}

	ai_weight = {
		factor = 1000
	}

	tradition_swap = {
		name = tr_cybernetics_organ_harvesting
		inherit_name = no
		inherit_icon = no
		trigger = {
			is_homicidal = yes
			has_country_flag = cybernetics_traditions_unlocked
		}
		custom_tooltip = tr_cybernetics_organ_harvesting_tooltip
		on_enabled = {
			hidden_effect = {
				refresh_portraits = character
			}
		}
	}

	tradition_swap = {
		name = tr_cybernetics_transubstantiation_synthesis_situation
		inherit_name = yes
		inherit_icon = yes
		trigger = {
			has_machine_age_dlc = yes
			is_homicidal = no
			NOT = { has_country_flag = cybernetics_traditions_unlocked }
		}
		custom_tooltip = tr_cybernetics_transubstantiation_synthesis_situation_effects

		on_enabled = {
			hidden_effect = {
				refresh_portraits = character
			}
		}
	}

	tradition_swap = {
		name = tr_cybernetics_organ_harvesting_situation
		inherit_name = no
		inherit_icon = no
		trigger = {
			has_machine_age_dlc = yes
			is_homicidal = yes
			NOT = { has_country_flag = cybernetics_traditions_unlocked }
		}
		custom_tooltip = tr_cybernetics_organ_harvesting_situation_effects

		on_enabled = {
			hidden_effect = {
				refresh_portraits = character
			}
		}
	}
}

tr_cybernetics_metabolic_reprocessing = {
	possible = {
		has_tradition = tr_cybernetics_transubstantiation_synthesis
	}

	custom_tooltip_with_modifiers = tr_cybernetics_metabolic_reprocessing_tooltip
	modifier = {
		planet_jobs_tec_cybernetics_upkeep_mult = -0.1
	}

	ai_weight = {
		factor = 1000
	}

	tradition_swap = {
		name = tr_cybernetics_metabolic_reprocessing_hive
		inherit_name = yes
		inherit_icon = yes
		trigger = {
			is_hive_empire = yes
			has_country_flag = cybernetics_traditions_unlocked
		}
		custom_tooltip = tr_cybernetics_metabolic_reprocessing_hive_desc
		modifier = {
			planet_pops_cyborgs_upkeep_mult = -0.10
		}
	}

	tradition_swap = {
		name = tr_cybernetics_metabolic_reprocessing_situation
		inherit_name = yes
		inherit_icon = yes
		trigger = {
			has_machine_age_dlc = yes
			is_hive_empire = no
			NOT = { has_country_flag = cybernetics_traditions_unlocked }
		}
		custom_tooltip = tr_cybernetics_metabolic_reprocessing_situation_effects
	}

	tradition_swap = {
		name = tr_cybernetics_metabolic_reprocessing_hive_situation
		inherit_name = yes
		inherit_icon = yes
		trigger = {
			has_machine_age_dlc = yes
			is_hive_empire = yes
			NOT = { has_country_flag = cybernetics_traditions_unlocked }
		}
		custom_tooltip = tr_cybernetics_metabolic_reprocessing_situation_hive_effects
	}
}

tr_cybernetics_integrated_anatomy = {
	possible = {
		has_tradition = tr_cybernetics_transubstantiation_synthesis
	}

	custom_tooltip = tr_cybernetics_integrated_anatomy_tooltip
	modifier = {
		BIOLOGICAL_species_trait_picks_add = 2
		# BIOSERVANT_species_trait_picks_add = 1
		# REPLICANT_species_trait_picks_add = 1
	}

	on_enabled = {
		hidden_effect = {
			# Gives cybernetic t1 traits and frames
			set_country_flag = tec_allow_t1_cybernetics
			# Allows application and removal of cybernetic traits onto cybernetic species.
			set_country_flag = can_remove_positive_traits_organic
			set_country_flag = can_remove_positive_traits_organic
			set_country_flag = can_modify_organic_portraits
		}
	}

	ai_weight = {
		factor = 1000
	}

	tradition_swap = {
		name = tr_cybernetics_integrated_anatomy_situation
		inherit_name = yes
		inherit_icon = yes
		trigger = {
			has_machine_age_dlc = yes
			NOT = { has_country_flag = cybernetics_traditions_unlocked }
		}
		custom_tooltip = tr_cybernetics_integrated_anatomy_situation_effects
	}
}

tr_cybernetics_augmentation_overload = {
	possible = {
		has_tradition = tr_cybernetics_metabolic_reprocessing
	}
	custom_tooltip = tr_cybernetics_augmentation_overload_desc

	ai_weight = {
		factor = 1000
	}

	tradition_swap = {
		name = tr_cybernetics_augmentation_centers
		inherit_name = no
		inherit_icon = yes
		trigger = {
			has_machine_age_dlc = no
			is_hive_empire = no
		}
		custom_tooltip = tr_cybernetics_augmentation_centers_desc
	}

	tradition_swap = {
		name = tr_cybernetics_augmentation_overload_situation
		inherit_name = yes
		inherit_icon = yes
		trigger = {
			has_machine_age_dlc = yes
			is_hive_empire = no
			NOT = { has_country_flag = cybernetics_traditions_unlocked }
		}
		custom_tooltip = tr_cybernetics_augmentation_overload_situation_effects
	}

	tradition_swap = {
		name = tr_cybernetics_synaptic_sub_processing
		inherit_name = no
		inherit_icon = no
		trigger = {
			always = no
			is_hive_empire = yes
			has_country_flag = cybernetics_traditions_unlocked
		}
		custom_tooltip_with_modifiers = tr_cybernetics_synaptic_sub_processing_tooltip
		#modifier = {
		#	# Just no LOL
		#	empire_size_districts_mult = -0.5
		#}
	}

	tradition_swap = {
		name = tr_cybernetics_synaptic_sub_processing_situation
		inherit_name = no
		inherit_icon = no
		trigger = {
			always = no
			has_machine_age_dlc = yes
			is_hive_empire = yes
			NOT = { has_country_flag = cybernetics_traditions_unlocked }
		}
		custom_tooltip = tr_cybernetics_synaptic_sub_processing_situation_effects
	}
}

tr_cybernetics_modular_cybernetics = {
	possible = {
		has_tradition = tr_cybernetics_integrated_anatomy
	}

	custom_tooltip = tr_cybernetics_modular_cybernetics_tooltip
	modifier = {
		MODIFY_SPECIES_COST_MULT = -0.5
		# These are hidden as cyborg trait becomes a 'negative' due to cost
		BIOLOGICAL_species_trait_picks_add = 1
		# BIOSERVANT_species_trait_picks_add = 1
		# # Remove if replicant is handled differently
		# REPLICANT_species_trait_picks_add = 1
	}

	ai_weight = {
		factor = 1000
	}

	tradition_swap = {
		name = tr_cybernetics_modular_cybernetics_hive
		inherit_name = yes
		inherit_icon = yes
		trigger = {
			is_hive_empire = yes
			has_country_flag = cybernetics_traditions_unlocked
		}
		custom_tooltip = tr_cybernetics_modular_cybernetics_hive_tt
		modifier = {
			modify_species_cost_mult = -0.50
		}
		weight = {
			factor = 1
		}
	}

	tradition_swap = {
		name = tr_cybernetics_modular_cybernetics_machine
		inherit_name = yes
		inherit_icon = yes
		inherit_effects = no
		trigger = {
			is_machine_empire = yes
		}
		custom_tooltip = tr_cybernetics_modular_cybernetics_machine_tooltip
		modifier = {
			MODIFY_SPECIES_COST_MULT = -0.5
			
			# These are hidden as cyborg trait becomes a 'negative' fdue to cost
			BIOLOGICAL_species_trait_picks_add = 1
			# BIOSERVANT_species_trait_picks_add = 1
			# # Remove if replicant is handled differently
			# REPLICANT_species_trait_picks_add = 1
		}
	}

	tradition_swap = {
		name = tr_cybernetics_modular_cybernetics_situation
		inherit_name = yes
		inherit_icon = yes
		trigger = {
			has_machine_age_dlc = yes
			is_hive_empire = no
			NOT = { has_country_flag = cybernetics_traditions_unlocked }
		}
		custom_tooltip = tr_cybernetics_modular_cybernetics_situation_effects
	}

	tradition_swap = {
		name = tr_cybernetics_modular_cybernetics_hive_situation
		inherit_name = yes
		inherit_icon = yes
		trigger = {
			has_machine_age_dlc = yes
			is_hive_empire = yes
			NOT = { has_country_flag = cybernetics_traditions_unlocked }
		}
		custom_tooltip = tr_cybernetics_modular_cybernetics_hive_situation_effects
	}
}