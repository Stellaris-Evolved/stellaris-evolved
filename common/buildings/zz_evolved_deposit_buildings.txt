# common\buildings\zz_evolved_deposit_buildings.txt

#########################
## Limited by deposits ##
#########################
 # Motes
 	building_mote_harvesters = {
 		base_buildtime = @b2_time
 		base_cap_amount = 1
 		position_priority = 40		# Planet Feature
 		ai_estimate_without_unemployment = yes

 		category = resource

 		prerequisites = {
 			"tech_mine_volatile_motes"
 		}

 		show_tech_unlock_if = {
 			tec_is_biohive = no
 		}

 		potential = {
 			NOT = {
 				has_modifier = resort_colony
 			}
 			tec_adds_motes_deposit = yes
 			exists = owner
 			owner = {
 				tec_is_biohive = no
 			}
 		}

		allow = {
			tec_only_one_strategic_booster_group = {
				STRATEGIC_MINER = no
			}
		}

 		destroy_trigger = {
 			tec_adds_motes_deposit = no
 		}

 		convert_to = {
 			building_mote_harvesters
 			building_tec_biohive_mote_harvesters
 			#building_tec_lithohive_mote_harvesters
 		}

 		resources = {
 			category = planet_buildings
 			inline_script = {
 				script = buildings/resources/tec_resource_cost
 				tier = 4
 			}
 		}

		# Text
		custom_tooltip = building_tec_sr_miner_motes_effect

 		inline_script = {	# Base
 			script = modifiers/tec_refiner_efficiency
 			eco_category = planet_chemists
 			resource = volatile_motes
			base_add = 0.75
			base_upkeep = 3
 			mult = 1
 			trigger = ""
 		}
 		inline_script = {	# Scaling
			script = modifiers/tec_refiner_efficiency
			eco_category = planet_chemists
			resource = volatile_motes
			base_add = 0.25
			base_upkeep = 1
			mult = modifier:building_mote_harvesters_max
			trigger = ""
		}

 		inline_script = {
 			script = jobs/tec_chemist
 			count = 1
 			mult = modifier:building_mote_harvesters_max
 			display = with_desc
 			trigger = ""
 			default_job = chemist
 		}

 		inline_script = {
 			script = buildings/tec_aibait
 			trigger = ""
 		}
 	}
 	building_tec_biohive_mote_harvesters = {
 		base_buildtime = @b2_time
 		base_cap_amount = 1
 		position_priority = 40		# Planet Feature
 		ai_estimate_without_unemployment = yes
 		icon = building_mote_harvesters		#BIOHIVE ART PLACEHOLDER!!!!

 		category = resource

 		prerequisites = {
 			"tech_mine_volatile_motes"
 		}

 		show_tech_unlock_if = {
 			tec_is_biohive = yes
 		}

 		potential = {
 			NOT = {
 				has_modifier = resort_colony
 			}
 			tec_adds_motes_deposit = yes
 			exists = owner
 			owner = {
 				tec_is_biohive = yes
 			}
 		}

		allow = {
			tec_only_one_strategic_booster_group = {
				STRATEGIC_MINER = no
			}
		}

 		destroy_trigger = {
 			tec_adds_motes_deposit = no
 		}

 		convert_to = {
 			building_mote_harvesters
 			building_tec_biohive_mote_harvesters
 			#building_tec_lithohive_mote_harvesters
 		}

 		resources = {
 			category = planet_buildings
 			inline_script = {
 				script = buildings/resources/tec_resource_cost
 				tier = 4
 			}
 		}

		# Text
		custom_tooltip = building_tec_sr_miner_motes_effect

 		inline_script = {	# Base
 			script = modifiers/tec_refiner_efficiency
 			eco_category = planet_chemists
 			resource = volatile_motes
			base_add = 0.75
			base_upkeep = 3
 			mult = 1
 			trigger = ""
 		}
		 inline_script = {	# Scaling
			script = modifiers/tec_refiner_efficiency
			eco_category = planet_chemists
			resource = volatile_motes
			base_add = 0.25
			base_upkeep = 1
			mult = modifier:building_mote_harvesters_max
			trigger = ""
		}

 		inline_script = {
 			script = jobs/tec_chemist
 			count = 1
 			mult = modifier:building_mote_harvesters_max
 			display = with_desc
 			trigger = ""
 			default_job = chemist_drone
 		}

 		inline_script = {
 			script = buildings/tec_aibait
 			trigger = ""
 		}
 	}
 	#building_tec_lithohive_mote_harvesters
 # /
 # Gas
 	building_gas_extractors = {
 		base_buildtime = @b2_time
 		base_cap_amount = 1
 		position_priority = 40		# Planet Feature
 		ai_estimate_without_unemployment = yes

 		category = resource

 		prerequisites = {
 			"tech_mine_exotic_gases"
 		}

 		show_tech_unlock_if = {
 			tec_is_biohive = no
 		}

 		potential = {
 			# These are now other buildings because the fix of max building autogenerated modifiers
 			NOT = {
 				has_modifier = resort_colony
 			}
 			tec_adds_gases_deposit = yes
 			exists = owner
 			owner = {
 				tec_is_biohive = no
 			}
 		}

		allow = {
			tec_only_one_strategic_booster_group = {
				STRATEGIC_MINER = no
			}
		}

 		destroy_trigger = {
 			tec_adds_gases_deposit = no
 		}

 		convert_to = {
 			building_gas_extractors
 			building_tec_biohive_gas_extractors
 			#building_tec_lithohive_gas_extractors
 		}

 		resources = {
 			category = planet_buildings
 			inline_script = {
 				script = buildings/resources/tec_resource_cost
 				tier = 4
 			}
 		}

		# Text
		custom_tooltip = building_tec_sr_miner_gases_effect

		inline_script = {	# Base
 			script = modifiers/tec_refiner_efficiency
 			eco_category = planet_refiners
 			resource = exotic_gases
			base_add = 0.75
			base_upkeep = 3
 			mult = 1
 			trigger = ""
 		}
		inline_script = {	# Scaling
			script = modifiers/tec_refiner_efficiency
			eco_category = planet_refiners
			resource = exotic_gases
			base_add = 0.25
			base_upkeep = 1
			mult = modifier:building_gas_extractors_max
			trigger = ""
		}

 		inline_script = {
 			script = jobs/tec_gas_refiner
 			count = 1
 			mult = modifier:building_gas_extractors_max
 			display = with_desc
 			trigger = ""
 			default_job = gas_refiner
 		}

 		inline_script = {
 			script = buildings/tec_aibait
 			trigger = ""
 		}
 	}
 	building_tec_biohive_gas_extractors = {
 		base_buildtime = @b2_time
 		base_cap_amount = 1
 		position_priority = 40		# Planet Feature
 		ai_estimate_without_unemployment = yes
 		icon = building_gas_extractors		#BIOHIVE ART PLACEHOLDER!!!!

 		category = resource

 		prerequisites = {
 			"tech_mine_exotic_gases"
 		}

 		show_tech_unlock_if = {
 			tec_is_biohive = yes
 		}

 		potential = {
 			# These are now other buildings because the fix of max building autogenerated modifiers
 			NOT = {
 				has_modifier = resort_colony
 			}
 			tec_adds_gases_deposit = yes
 			exists = owner
 			owner = {
 				tec_is_biohive = yes
 			}
 		}

		allow = {
			tec_only_one_strategic_booster_group = {
				STRATEGIC_MINER = no
			}
		}

 		destroy_trigger = {
 			tec_adds_gases_deposit = no
 		}

 		convert_to = {
 			building_gas_extractors
 			building_tec_biohive_gas_extractors
 			#building_tec_lithohive_gas_extractors
 		}

 		resources = {
 			category = planet_buildings
 			inline_script = {
 				script = buildings/resources/tec_resource_cost
 				tier = 4
 			}
 		}

		# Text
		custom_tooltip = building_tec_sr_miner_gases_effect

		inline_script = {	# Base
 			script = modifiers/tec_refiner_efficiency
 			eco_category = planet_refiners
 			resource = exotic_gases
			base_add = 0.75
			base_upkeep = 3
 			mult = 1
 			trigger = ""
 		}
		inline_script = {	# Scaling
			script = modifiers/tec_refiner_efficiency
			eco_category = planet_refiners
			resource = exotic_gases
			base_add = 0.25
			base_upkeep = 1
			mult = modifier:building_gas_extractors_max
			trigger = ""
		}

 		inline_script = {
 			script = jobs/tec_gas_refiner
 			count = 1
 			mult = modifier:building_gas_extractors_max
 			display = with_desc
 			trigger = ""
 			default_job = gas_refiner_drone
 		}

 		inline_script = {
 			script = buildings/tec_aibait
 			trigger = ""
 		}
 	}
 	#building_tec_lithohive_gas_extractors
 # /
 # Crystals
 	building_crystal_mines = {
 		base_buildtime = @b2_time
 		base_cap_amount = 1
 		position_priority = 40		# Planet Feature
 		ai_estimate_without_unemployment = yes

 		category = resource

 		prerequisites = {
 			"tech_mine_rare_crystals"
 		}

 		show_tech_unlock_if = {
 			tec_is_biohive = no
 		}

 		potential = {
 			NOT = {
 				has_modifier = resort_colony
 			}
 			tec_adds_crystals_deposit = yes
 			exists = owner
 			owner = {
 				tec_is_biohive = no
 			}
 		}

		allow = {
			tec_only_one_strategic_booster_group = {
				STRATEGIC_MINER = no
			}
		}

 		destroy_trigger = {
 			tec_adds_crystals_deposit = no
 		}

 		convert_to = {
 			building_crystal_mines
 			building_tec_biohive_crystal_mines
 			#building_tec_lithohive_crystal_mines
 		}

 		resources = {
 			category = planet_buildings
 			inline_script = {
 				script = buildings/resources/tec_resource_cost
 				tier = 4
 			}
 		}

		# Text
		custom_tooltip = building_tec_sr_miner_crystals_effect

		inline_script = {	# Base
 			script = modifiers/tec_refiner_efficiency
 			eco_category = planet_translucers
 			resource = rare_crystals
			base_add = 0.75
			base_upkeep = 3
 			mult = 1
 			trigger = ""
 		}
		inline_script = {	# Scaling
			script = modifiers/tec_refiner_efficiency
			eco_category = planet_translucers
			resource = rare_crystals
			base_add = 0.25
			base_upkeep = 1
			mult = modifier:building_crystal_mines_max
			trigger = ""
		}

 		inline_script = {
 			script = jobs/tec_translucer
 			count = 1
 			mult = modifier:building_crystal_mines_max
 			display = with_desc
 			trigger = ""
 			default_job = translucer
 		}

 		inline_script = {
 			script = buildings/tec_aibait
 			trigger = ""
 		}
 	}
 	building_tec_biohive_crystal_mines = {
 		base_buildtime = @b2_time
 		base_cap_amount = 1
 		position_priority = 40		# Planet Feature
 		ai_estimate_without_unemployment = yes
 		icon = building_crystal_mines		#BIOHIVE ART PLACEHOLDER!!!!

 		category = resource

 		prerequisites = {
 			"tech_mine_rare_crystals"
 		}

 		show_tech_unlock_if = {
 			tec_is_biohive = yes
 		}

 		potential = {
 			NOT = {
 				has_modifier = resort_colony
 			}
 			tec_adds_crystals_deposit = yes
 			exists = owner
 			owner = {
 				tec_is_biohive = yes
 			}
 		}

		allow = {
			tec_only_one_strategic_booster_group = {
				STRATEGIC_MINER = no
			}
		}

 		destroy_trigger = {
 			tec_adds_crystals_deposit = no
 		}

 		convert_to = {
 			building_crystal_mines
 			building_tec_biohive_crystal_mines
 			#building_tec_lithohive_crystal_mines
 		}

 		resources = {
 			category = planet_buildings
 			inline_script = {
 				script = buildings/resources/tec_resource_cost
 				tier = 4
 			}
 		}

		# Text
		custom_tooltip = building_tec_sr_miner_crystals_effect

		inline_script = {	# Base
 			script = modifiers/tec_refiner_efficiency
 			eco_category = planet_translucers
 			resource = rare_crystals
			base_add = 0.75
			base_upkeep = 3
 			mult = 1
 			trigger = ""
 		}
		inline_script = {	# Scaling
			script = modifiers/tec_refiner_efficiency
			eco_category = planet_translucers
			resource = rare_crystals
			base_add = 0.25
			base_upkeep = 1
			mult = modifier:building_crystal_mines_max
			trigger = ""
		}

 		inline_script = {
 			script = jobs/tec_translucer
 			count = 1
 			mult = modifier:building_crystal_mines_max
 			display = with_desc
 			trigger = ""
 			default_job = translucer_drone
 		}

 		inline_script = {
 			script = buildings/tec_aibait
 			trigger = ""
 		}
 	}
	#building_tec_lithohive_crystal_mines
 # All resources
	building_tec_strategic_miner = {
		icon = building_tec_strategic_optimizator
		base_buildtime = @b2_time
		base_cap_amount = 1
		position_priority = 40		# Planet Feature
		ai_estimate_without_unemployment = yes

		category = resource

		potential = {
			exists = owner
			OR = {
				AND = {
					owner = { has_technology = tech_mine_volatile_motes }
					tec_adds_motes_deposit = yes
				}
				AND = {
					owner = { has_technology = tech_mine_rare_crystals }
					tec_adds_crystals_deposit = yes
				}
				AND = {
					owner = { has_technology = tech_mine_exotic_gases }
					tec_adds_gases_deposit = yes
				}
			}
			owner = {
				tec_is_biohive = no
			}
			tec_planet_blocks_menial_buildings = no
		}

		allow = {
			tec_only_one_strategic_booster_group = {
				STRATEGIC_MINER = yes
			}
		}

		# TODO COSMIC STORMS - Add mutual exclusivity with the others

		convert_to = {
			building_tec_strategic_miner
			building_tec_biohive_strategic_miner
			#building_tec_lithohive_mote_harvesters
		}

		resources = {
			category = planet_buildings
			inline_script = {
				script = buildings/resources/tec_resource_cost
				tier = 4
			}
		}

		# Text
		custom_tooltip = building_tec_sr_miner_all_effect

		# Modifiers
		inline_script = {
			script = modifiers/tec_sr_miner_efficiency
			eco_category = planet_sr_miners
			resource = volatile_motes
			mult = modifier:building_mote_harvesters_max
			trigger = ""
			default = no
		}
		inline_script = {
			script = modifiers/tec_sr_miner_efficiency
			eco_category = planet_sr_miners
			resource = rare_crystals
			mult = modifier:building_crystal_mines_max
			trigger = ""
			default = no
		}
		inline_script = {
			script = modifiers/tec_sr_miner_efficiency
			eco_category = planet_sr_miners
			resource = exotic_gases
			mult = modifier:building_gas_extractors_max
			trigger = ""
			default = no
		}

		# Jobs
		inline_script = {
			script = jobs/tec_mote_harvester
			count = 2
			mult = modifier:building_mote_harvesters_max
			display = with_desc
			trigger = ""
			default_job = mote_harvester
		}
		inline_script = {
			script = jobs/tec_crystal_miner
			count = 2
			mult = modifier:building_crystal_mines_max
			display = with_desc
			trigger = ""
			default_job = crystal_miner
		}
		inline_script = {
			script = jobs/tec_gas_extractor
			count = 2
			mult = modifier:building_gas_extractors_max
			display = with_desc
			trigger = ""
			default_job = gas_extractor
		}

		# AI
		inline_script = {
			script = buildings/tec_aibait
			trigger = ""
		}
	}
	building_tec_biohive_strategic_miner = {
		icon = building_tec_strategic_optimizator
		base_buildtime = @b2_time
		base_cap_amount = 1
		position_priority = 40		# Planet Feature
		ai_estimate_without_unemployment = yes

		category = resource

		potential = {
			OR = {
				AND = {
					owner = { has_technology = tech_mine_volatile_motes }
					tec_adds_motes_deposit = yes
				}
				AND = {
					owner = { has_technology = tech_mine_rare_crystals }
					tec_adds_crystals_deposit = yes
				}
				AND = {
					owner = { has_technology = tech_mine_exotic_gases }
					tec_adds_gases_deposit = yes
				}
			}
			exists = owner
			owner = {
				tec_is_biohive = yes
			}
			tec_planet_blocks_menial_buildings = no
		}

		allow = {
			tec_only_one_strategic_booster_group = {
				STRATEGIC_MINER = yes
			}
		}

		convert_to = {
			building_tec_strategic_miner
			building_tec_biohive_strategic_miner
			#building_tec_lithohive_strategic_miner
		}

		resources = {
			category = planet_buildings
			inline_script = {
				script = buildings/resources/tec_resource_cost
				tier = 4
			}
		}

		# Text
		custom_tooltip = building_tec_sr_miner_all_effect

		# Modifiers
		inline_script = {
			script = modifiers/tec_sr_miner_efficiency
			eco_category = planet_sr_miners
			resource = volatile_motes
			mult = modifier:building_mote_harvesters_max
			trigger = "
				check_variable_arithmetic = {
					which = modifier:building_mote_harvesters_max
					value > 0
				}
			"
		}
		inline_script = {
			script = modifiers/tec_sr_miner_efficiency
			eco_category = planet_sr_miners
			resource = rare_crystals
			mult = modifier:building_crystal_mines_max
			trigger = "
				check_variable_arithmetic = {
					which = modifier:building_crystal_mines_max
					value > 0
				}
			"
		}
		inline_script = {
			script = modifiers/tec_sr_miner_efficiency
			eco_category = planet_sr_miners
			resource = exotic_gases
			mult = modifier:building_gas_extractors_max
			trigger = "
				check_variable_arithmetic = {
					which = modifier:building_gas_extractors_max
					value > 0
				}
			"
		}

		# Jobs
		inline_script = {
			script = jobs/tec_mote_harvester
			count = 2
			mult = modifier:building_mote_harvesters_max
			display = with_desc
			trigger = ""
			default_job = mote_harvester
		}

		inline_script = {
			script = jobs/tec_crystal_miner
			count = 2
			mult = modifier:building_crystal_mines_max
			display = with_desc
			trigger = ""
			default_job = crystal_miner
		}

		inline_script = {
			script = jobs/tec_gas_extractor
			count = 2
			mult = modifier:building_gas_extractors_max
			display = with_desc
			trigger = ""
			default_job = gas_extractor
		}

		inline_script = {
			script = buildings/tec_aibait
			trigger = ""
		}
	}
	#building_tec_lithohive_strategic_miner
# /
# Betharian
	building_betharian_power_plant = {
		base_buildtime = @b2_time
		base_cap_amount = 1
		position_priority = 40		# Planet Feature
		ai_estimate_without_unemployment = yes

		category = resource

		prerequisites = {
			"tech_mine_betharian"
		}

		show_tech_unlock_if = {
			tec_is_biohive = no
		}

		potential = {
			tec_has_betharian_deposit = yes
			exists = owner
			owner = {
				tec_is_biohive = no
			}
			tec_planet_blocks_menial_buildings = no
		}

		destroy_trigger = {
			tec_has_betharian_deposit = no
		}

		convert_to = {
			building_betharian_power_plant
			building_tec_biohive_betharian_power_plant
			#building_tec_lithohive_betharian_power_plant
		}
		
		resources = {
			category = planet_buildings
			inline_script = {
				script = buildings/resources/tec_resource_cost
				tier = 4
			}
			produces = {
				energy = 20
				multiplier = modifier:building_betharian_power_plant_max
			}
		}

		inline_script = {
			script = modifiers/tec_technician_efficiency
			count = 1
			mult = modifier:building_betharian_power_plant_max
			trigger = ""
		}

		inline_script = {
			script = jobs/tec_technician
			regular_count = 4
			regular_secondary_count = 4
			hive_count = 4
			hive_secondary_count = 4
			machine_count = 4
			machine_secondary_count = 4
			mult = modifier:building_betharian_power_plant_max
			display = with_desc
			trigger = ""
			default_job = technician
		}

		inline_script = {
			script = buildings/tec_aibait
			trigger = ""
		}
	}
	building_tec_biohive_betharian_power_plant = {
		base_buildtime = @b2_time
		base_cap_amount = 1
		position_priority = 40		# Planet Feature
		ai_estimate_without_unemployment = yes
		icon = building_betharian_power_plant		#BIOHIVE ART PLACEHOLDER!!!!

		category = resource

		prerequisites = {
			"tech_mine_betharian"
		}

		show_tech_unlock_if = {
			tec_is_biohive = yes
		}

		potential = {
			tec_has_betharian_deposit = yes
			exists = owner
			owner = {
				tec_is_biohive = yes
			}
			tec_planet_blocks_menial_buildings = no
		}

		destroy_trigger = {
			tec_has_betharian_deposit = no
		}

		convert_to = {
			building_betharian_power_plant
			building_tec_biohive_betharian_power_plant
			#building_tec_lithohive_betharian_power_plant
		}
		
		resources = {
			category = planet_buildings
			inline_script = {
				script = buildings/resources/tec_resource_cost
				tier = 4
			}
			produces = {
				energy = 20
				multiplier = modifier:building_betharian_power_plant_max
			}
		}

		inline_script = {
			script = modifiers/tec_technician_efficiency
			count = 1
			mult = modifier:building_betharian_power_plant_max
			trigger = ""
		}

		inline_script = {
			script = jobs/tec_technician
			regular_count = 4
			regular_secondary_count = 4
			hive_count = 4
			hive_secondary_count = 4
			machine_count = 4
			machine_secondary_count = 4
			mult = modifier:building_betharian_power_plant_max
			display = with_desc
			trigger = ""
			default_job = technician_drone
		}

		inline_script = {
			script = buildings/tec_aibait
			trigger = ""
		}
	}
	#building_tec_lithohive_betharian_power_plant
# /

# Other
	building_xeno_zoo = {
		base_buildtime = @b1_time
		base_cap_amount = 1
		position_priority = 40		# Planet Feature
		ai_estimate_without_unemployment = yes

		category = amenity

		prerequisites = {
			"tech_alien_life_studies"
		}

		potential = {
			exists = owner
			owner = {
				is_regular_empire = yes
				is_guided_sapience_empire = no
			}
			planet = {
				OR = {
					has_deposit = d_alien_pets_deposit
					has_deposit = d_avian_reserve
					AND = {
						exists = owner
						owner = { has_policy_flag = pre_sapients_protect }
						any_owned_pop = {
							is_sapient = no
						}
					}
					any_owned_pop = {
						is_livestock = yes
					}
				}
			}
		}

		destroy_trigger = {
			OR = {
				AND = {
					exists = owner
					owner = {
						OR = {
							is_regular_empire = no
							is_guided_sapience_empire = yes
						}
					}
				}
				planet = {
					NOR = {
						has_deposit = d_alien_pets_deposit
						AND = {
							exists = owner
							owner = { has_policy_flag = pre_sapients_protect }
							any_owned_pop = {
								is_sapient = no
							}
						}
						any_owned_pop = {
							is_livestock = yes
						}
					}
				}
			}
		}
		resources = {
			category = planet_buildings
			inline_script = {
				script = buildings/resources/tec_resource_cost
				tier = 1
			}
		}

		inline_script = {
			script = jobs/tec_job
			job = xeno_zoo_keeper
			count = 1
			mult = 1
			display = with_desc
			trigger = ""
		}

		inline_script = {
			script = jobs/tec_entertainer
			count = 1
			mult = 1
			display = with_desc
			trigger = ""
			default_job = entertainer
		}

		inline_script = {
			script = jobs/tec_livestock_zoo
			count = 3
			mult = 1
			display = with_desc
			trigger = "
				planet = {
					any_owned_pop = {
						is_livestock = yes
					}
				}
			"
		}
	}
# /

# ------- Evolved new ones
	#building_tec_zro_extractor

	#building_tec_zro_refiner

	#building_tec_zro_disperser

	#building_tec_livingmetal_extractor

	#building_tec_livingmetal_disperser

	#building_tec_darkmatter_lab

	#building_tec_nanite_extractor
# /
# ------- Slow colonization
	#building_tec_deposit_biofarm

	#building_tec_deposit_solarfarm

	#building_tec_deposit_moistfarm

	#building_tec_deposit_tritium

	#building_tec_deposit_icecrystals

	#building_tec_deposit_heatfarm

	#building_tec_deposit_coremining

	#building_tec_deposit_gravity

	#building_tec_deposit_rare
# /