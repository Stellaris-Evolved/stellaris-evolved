# - - - - - - - - - - - - - - - - - - - - - 
# GESTALT CAPITALS
# - - - - - - - - - - - - - - - - - - - - - 

# - - - - - - - - - - - - - - - - - - - - - 
# Regular Machine Capitals
# - - - - - - - - - - - - - - - - - - - - - 
# Uses standard set
# Colony
building_deployment_post = {
	capital = yes
	can_build = no
	can_demolish = no
	can_be_ruined = no
	can_be_disabled = no
	position_priority = 0		# Capital

	category = government

	upgrades = {
		building_machine_capital
	}

	potential = {
		exists = owner
		owner = {
			OR = {
				is_machine_empire = yes
				is_country_type = ai_empire
			}
			is_fallen_empire = no
		}
		NOR = {
			has_planet_flag = tec_replace_machine_capital_to_extraction
			has_planet_flag = tec_replace_machine_capital_to_production
		}
		uses_habitat_capitals = no
	}

	destroy_trigger = {
		exists = owner
		OR = {
			owner = {
				is_machine_empire = no
			}
			OR = {
				has_planet_flag = tec_replace_machine_capital_to_extraction
				has_planet_flag = tec_replace_machine_capital_to_production
			}
		}
	}

	convert_to = {
		# Regular
			building_colony_shelter
		# Hive
			building_tec_hive_sapling
			building_tec_cyberhive_sapling
			building_tec_biohive_sapling
		# Machine
			#building_deployment_post
			building_tec_machine_production_deployment_post
			building_tec_machine_extraction_deployment_post
			#building_tec_old_machine_deployment_post
		# FE
			building_ancient_control_center
			building_ancient_palace
		# Special regular
			building_resort_capital
			building_slave_capital
			#building_tec_sanctuary_capital
			#building_tec_necropolis_capital
			#building_tec_preserve_capital
			#building_tec_penal_capital
			#building_tec_heritage_capital
		# Special gestalt
	}

		
	resources = {
		category = planet_buildings
		upkeep = {
			energy = 1
		}
	}
	planet_modifier = {
		planet_housing_add = 5
		planet_amenities_add = 8
		planet_max_buildings_add = @build_slots_t1
	}

	inline_script = capitals/inline_evolved_colony

	inline_script = {
		script = capitals/inline_evolved_common_modifiers	
		tier = 1
	}

	inline_script = {
		script = capitals/inline_evolved_machine_assembly	
		tier = 1
	}

	inline_script = {
		script = capitals/inline_evolved_machine_capital
		tier =  1
	}

	ai_weight = {
		weight = 1
	}
}

# Administrative Array
building_machine_capital = {
	base_buildtime = @b2_time
	capital = yes
	can_build = no
	can_demolish = no
	can_be_ruined = no
	can_be_disabled = no
	position_priority = 0		# Capital

	category = government

	prerequisites = {
		"tech_planetary_government"
	}

	show_tech_unlock_if = {
		is_machine_empire = yes
	}
	
	upgrades = {
		building_machine_major_capital
	}

	potential = {
		exists = owner
		owner = {
			OR = {
				is_machine_empire = yes
				is_country_type = ai_empire
				AND = {
					exists = event_target:mechanocalibrator_country
					is_same_value = event_target:mechanocalibrator_country
				}
			}
			is_fallen_empire = no
		}
		NOR = {
			has_planet_flag = tec_replace_machine_capital_to_extraction
			has_planet_flag = tec_replace_machine_capital_to_production
		}
		uses_habitat_capitals = no
	}

	destroy_trigger = {
		exists = owner
		OR = {
			owner = {
				is_machine_empire = no
			}
			has_planet_flag = tec_replace_machine_capital_to_extraction
			has_planet_flag = tec_replace_machine_capital_to_production
		}
	}

	convert_to = {
		# Regular
			building_capital
		# Hive	
			building_hive_capital
			building_tec_cyberhive_capital
			building_tec_biohive_capital
		# Machine
			#building_machine_capital
			building_tec_machine_extraction_capital
			building_tec_machine_production_capital
			#building_tec_old_machine_capital
		# FE
			building_ancient_control_center
			building_ancient_palace
		# Special regular
			building_resort_capital
			building_slave_capital
			#building_tec_sanctuary_capital
			#building_tec_necropolis_capital
			#building_tec_preserve_capital
			#building_tec_penal_capital
			#building_tec_heritage_capital
		# Special gestalt

	}

	allow = {
		num_pops >= @pops_t2
	}

	resources = {
		category = planet_buildings
		inline_script = {
			script = buildings/inline_evolved_resource_cost
			tier = 2
		}
	}

	planet_modifier = {
		planet_housing_add = 5
		planet_amenities_no_happiness_add = 10
		planet_max_buildings_add = @build_slots_t2
		planet_max_branch_office_buildings_add = @branch_slots_t1
	}

	inline_script = {
		script = capitals/inline_evolved_common_modifiers	
		tier = 2
	}

	inline_script = {
		script = capitals/inline_evolved_machine_assembly	
		tier = 2
	}

	inline_script = {
		script = capitals/inline_evolved_machine_capital
		tier =  2
	}
}

# Planetary Processor
building_machine_major_capital = {
	base_buildtime = @b3_time
	capital = yes
	can_build = no
	can_demolish = no
	can_be_ruined = no
	can_be_disabled = no
	position_priority = 0		# Capital

	category = government
	
	prerequisites = {
		"tech_colonial_centralization"
	}

	show_tech_unlock_if = {
		is_machine_empire = yes
	}

	upgrades = {
		"building_machine_system_capital"
	}

	potential = {
		exists = owner
		owner = {
			OR = {
				is_machine_empire = yes
				is_country_type = ai_empire
			}
			is_fallen_empire = no
		}
		NOR = {
			has_planet_flag = tec_replace_machine_capital_to_extraction
			has_planet_flag = tec_replace_machine_capital_to_production
		}
		uses_habitat_capitals = no
	}
	
	allow = {
		num_pops >= @pops_t3
	}

	destroy_trigger = {
		exists = owner
		OR = {
			owner = {
				is_machine_empire = no
			}
			has_planet_flag = tec_replace_machine_capital_to_extraction
			has_planet_flag = tec_replace_machine_capital_to_production
		}
	}
	

	convert_to = {
		# Regular
			building_major_capital
		# Hive
			building_hive_major_capital
			building_tec_cyberhive_major_capital
			building_tec_biohive_major_capital
		# Machine
			#building_machine_major_capital
			building_tec_machine_extraction_major_capital
			building_tec_machine_production_major_capital
			#building_tec_old_machine_major_capital
		# FE
			building_ancient_control_center
			building_ancient_palace
		# Special regular
			building_resort_major_capital
			building_slave_major_capital
			#building_tec_sanctuary_major_capital
			#building_tec_necropolis_major_capital
			#building_tec_preserve_major_capital
			#building_tec_penal_major_capital
			#building_tec_heritage_major_capital
		# Special gestalt
	}

	resources = {
		category = planet_buildings
		inline_script = {
			script = buildings/inline_evolved_resource_cost
			tier = 3
		}
	}

	planet_modifier = {
		planet_housing_add = 10
		planet_amenities_no_happiness_add = 15
		planet_max_buildings_add = @build_slots_t3
		planet_max_branch_office_buildings_add = @branch_slots_t2
	}

	inline_script = {
		script = capitals/inline_evolved_common_modifiers	
		tier = 3
	}

	inline_script = {
		script = capitals/inline_evolved_machine_assembly	
		tier = 3
	}

	inline_script = {
		script = capitals/inline_evolved_machine_capital
		tier = 3
	}
}

# Primary Nexus
building_machine_system_capital = {
	base_buildtime = @b4_time
	capital = yes
	can_build = no
	can_demolish = no
	can_be_ruined = no
	can_be_disabled = no

	category = government

	prerequisites = {
		"tech_galactic_administration"
	}

	show_tech_unlock_if = {
		is_machine_empire = yes
	}

	upgrades = {
		"building_machine_galactic_capital"
	}

	potential = {
		exists = owner
		owner = {
			OR = {
				is_machine_empire = yes
				is_country_type = ai_empire
			}
			is_fallen_empire = no
		}
		# Galactic emperor and etc trigger goes here
		tec_has_special_advanced_capital = no
		NOR = {
			has_planet_flag = tec_replace_machine_capital_to_extraction
			has_planet_flag = tec_replace_machine_capital_to_production
		}
		uses_habitat_capitals = no
	}
	
	allow = {
		num_pops >= @pops_t4
	}

	destroy_trigger = {
		exists = owner
		OR = {
			owner = {
				is_machine_empire = no
			}
			has_planet_flag = tec_replace_machine_capital_to_extraction
			has_planet_flag = tec_replace_machine_capital_to_production
		}
	}

	convert_to = {
		# Regular
			building_system_capital
		# Hive
			building_hive_system_capital
			building_tec_cyberhive_system_capital
			building_tec_biohive_system_capital
		# Machine
			#building_machine_system_capital
			building_tec_machine_extraction_system_capital
			building_tec_machine_production_system_capital
			#building_tec_old_machine_system_capital
		# FE
			building_ancient_control_center
			building_ancient_palace
		# Special regular
			building_resort_major_capital
			building_slave_major_capital
			#building_tec_sanctuary_major_capital
			#building_tec_necropolis_major_capital
			#building_tec_preserve_major_capital
			#building_tec_penal_major_capital
			#building_tec_heritage_major_capital
		# Special gestalt

	}

	resources = {
		category = planet_buildings
		inline_script = {
			script = buildings/inline_evolved_resource_cost
			tier = 4
		}
	}

	planet_modifier = {
		planet_housing_add = 15
		planet_amenities_no_happiness_add = 20
		planet_max_buildings_add = @build_slots_t4
		planet_max_branch_office_buildings_add = @branch_slots_t3
	}

	inline_script = {
		script = capitals/inline_evolved_common_modifiers	
		tier = 4
	}

	inline_script = {
		script = capitals/inline_evolved_machine_assembly	
		tier = 4
	}

	inline_script = {
		script = capitals/inline_evolved_machine_capital
		tier =  4
	}
}

# Alpha Nexus
building_machine_galactic_capital = {
	base_buildtime = @b4_time
	capital = yes
	can_build = no
	can_demolish = no
	can_be_ruined = no
	can_be_disabled = no
	position_priority = 0		# Capital
	
	category = government

	prerequisites = {
		"tech_tec_imperial_coordination"
	}

	show_tech_unlock_if = {
		is_machine_empire = yes
	}

	potential = {
		exists = owner
		owner = {
			OR = {
				is_machine_empire = yes
				is_country_type = ai_empire
				
			}
			is_fallen_empire = no
			is_galactic_emperor = no
		}
		# Galactic emperor and etc trigger goes here
		tec_has_special_advanced_capital = no
		NOR = {
			has_planet_flag = tec_replace_machine_capital_to_extraction
			has_planet_flag = tec_replace_machine_capital_to_production
		}
		uses_habitat_capitals = no
	}

	allow = {
		num_pops >= @pops_t5
	}

	destroy_trigger = {
		exists = owner
		OR = {
			owner = {
				is_machine_empire = no
			}
			has_planet_flag = tec_replace_machine_capital_to_extraction
			has_planet_flag = tec_replace_machine_capital_to_production
		}
	}

	convert_to = {
		# Regular
			building_galactic_capital
		# Hive
			building_hive_system_capital
			building_tec_cyberhive_system_capital
			building_tec_biohive_system_capital
		# Machine
			#building_machine_system_capital
			building_tec_machine_extraction_system_capital
			building_tec_machine_production_system_capital
			#building_tec_old_machine_system_capital
		# FE
			building_ancient_control_center
			building_ancient_palace
		# Special regular
			building_resort_major_capital
			building_slave_major_capital
			#building_tec_sanctuary_major_capital
			#building_tec_necropolis_major_capital
			#building_tec_preserve_major_capital
			#building_tec_penal_major_capital
			#building_tec_heritage_major_capital
		# Special gestalt

		# Imperial
			building_imperial_capital
			building_imperial_hive_capital
			building_imperial_machine_capital
	}


	resources = {
		category = planet_buildings
		inline_script = {
			script = buildings/inline_evolved_resource_cost
			tier = 4
		}
	}

	planet_modifier = {
		planet_housing_add = 20
		planet_amenities_no_happiness_add = 25
		planet_max_buildings_add = @build_slots_t5
		planet_max_branch_office_buildings_add = @branch_slots_t4
	}

	
	inline_script = {
		script = capitals/inline_evolved_common_modifiers	
		tier = 5
	}
	inline_script = {
		script = capitals/inline_evolved_machine_assembly	
		tier = 5
	}

	inline_script = {
		script = capitals/inline_evolved_machine_capital
		tier = 5
	}
}

# - - - - - - - - - - - - - - - - - - - - - 
# Galactic Imperium Capital
# Imperial Center
building_imperial_machine_capital = {
	icon = building_imperial_capital # base is UGLY AS FUCK
	base_buildtime = @b4_time
	capital = yes
	can_build = no
	can_demolish = no
	can_be_ruined = no
	can_be_disabled = no
	position_priority = 0		# Capital

	category = government

	prerequisites = {
	}

	potential = {
		exists = owner
		owner = {
			OR = {
				is_machine_empire = yes
				is_country_type = ai_empire
			}
			is_galactic_emperor = yes
		}
		planet = { is_capital = yes }
	}

	convert_to = {
		# Regular
			building_galactic_capital
		# Hive
			building_hive_system_capital
			building_tec_cyberhive_system_capital
			building_tec_biohive_system_capital
		# Machine
			building_machine_system_capital
			#building_tec_old_machine_system_capital
		# FE
			building_ancient_control_center
			building_ancient_palace
		
		# Special regular
			building_resort_major_capital
			building_slave_major_capital
			#building_tec_sanctuary_major_capital
			#building_tec_necropolis_major_capital
			#building_tec_preserve_major_capital
			#building_tec_penal_major_capital
			#building_tec_heritage_major_capital
		# Special gestalt

		# Imperial
			building_imperial_capital
			building_imperial_hive_capital
			#building_imperial_machine_capital
	}

	allow = {
		num_pops >= @pops_t4
	}

	resources = {
		category = planet_buildings
		inline_script = {
			script = buildings/inline_evolved_resource_cost
			tier = 4
		}
	}

	planet_modifier = {
		planet_housing_add = 30
		planet_amenities_add = 30
		planet_max_buildings_add = 11
		planet_max_branch_office_buildings_add = 4
	}

	inline_script = {
		script = capitals/inline_evolved_common_modifiers	
		tier = 6
	}
	inline_script = {
		script = capitals/inline_evolved_machine_assembly	
		tier = 6
	}
	inline_script = {
		script = capitals/inline_evolved_machine_capital
		tier = 6
	}
}

# - - - - - - - - - - - - - - - - - - - - - 
# Special Capitals
# Colony
building_tec_machine_production_deployment_post = {
	capital = yes
	can_build = no
	can_demolish = no
	can_be_ruined = no
	can_be_disabled = no
	position_priority = 0		# Capital

	category = government

	upgrades = {
		building_tec_machine_production_capital
	}

	potential = {
		exists = owner
		owner = {
			OR = {
				is_machine_empire = yes
				is_country_type = ai_empire
			}
			is_fallen_empire = no
		}
		has_planet_flag = tec_replace_machine_capital_to_production
		tec_allows_machine_alt_capitals = yes
	}

	destroy_trigger = {
		exists = owner
		OR = {
			owner = {
				is_machine_empire = no
			}
			NOT = {
				has_planet_flag = tec_replace_machine_capital_to_production
			}
			tec_allows_machine_alt_capitals = no
		}
	}

	on_destroy = {
		remove_planet_flag = tec_replace_machine_capital_to_extraction
	}

	convert_to = {
		# Regular
			building_colony_shelter
		# Hive
			building_tec_hive_sapling
			building_tec_cyberhive_sapling
			building_tec_biohive_sapling
		# Machine
			building_deployment_post
			#building_tec_machine_production_deployment_post
			building_tec_machine_extraction_deployment_post
			#building_tec_old_machine_deployment_post
		# FE
			building_ancient_control_center
			building_ancient_palace
		# Special regular
			building_resort_capital
			building_slave_capital
			#building_tec_sanctuary_capital
			#building_tec_necropolis_capital
			#building_tec_preserve_capital
			#building_tec_penal_capital
			#building_tec_heritage_capital
		# Special gestalt
	
	}

	resources = {
		category = planet_buildings
		upkeep = {
			energy = 1
		}
	}

	triggered_desc = {
		text = tec_machine_production_capital_effects
	}

	planet_modifier = {
		planet_housing_add = 5
		planet_amenities_add = 8
		planet_jobs_complex_drone_produces_mult = 0.1
		planet_jobs_complex_drone_upkeep_mult = 0.1
		planet_max_buildings_add = @build_slots_t1
	}


	# Biotrophies
	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				has_valid_civic = civic_machine_servitor
			}
		}
		planet_bio_trophies_produces_mult = 0.1
	}

	inline_script = capitals/inline_evolved_colony
	inline_script = {
		script = capitals/inline_evolved_common_modifiers	
		tier = 1
	}
	inline_script = {
		script = capitals/inline_evolved_machine_capital
		tier = 1
	}

	ai_weight = {
		weight = 1
	}
}

# Production Array
building_tec_machine_production_capital = {
	base_buildtime = @b2_time
	capital = yes
	can_build = no
	can_demolish = no
	can_be_ruined = no
	can_be_disabled = no
	position_priority = 0		# Capital

	category = government

	prerequisites = {
		"tech_planetary_government"
	}

	show_tech_unlock_if = {
		always = no
	}
	
	upgrades = {
		building_tec_machine_production_major_capital
	}

	potential = {
		exists = owner
		owner = {
			OR = {
				is_machine_empire = yes
				is_country_type = ai_empire
				AND = {
					exists = event_target:mechanocalibrator_country
					is_same_value = event_target:mechanocalibrator_country
				}
			}
			is_fallen_empire = no
		}
		has_planet_flag = tec_replace_machine_capital_to_production
		tec_allows_machine_alt_capitals = yes
	}

	destroy_trigger = {
		exists = owner
		OR = {
			owner = {
				is_machine_empire = no
			}
			NOT = {
				has_planet_flag = tec_replace_machine_capital_to_production
			}
			tec_allows_machine_alt_capitals = no
		}
	}

	on_destroy = {
		remove_planet_flag = tec_replace_machine_capital_to_extraction
	}

	convert_to = {
		# Regular
			building_capital
		# Hive
			building_hive_capital
			building_tec_cyberhive_capital
			building_tec_biohive_capital
		# Machine
			building_machine_capital
			#building_tec_machine_production_capital
			building_tec_machine_extraction_capital
			#building_tec_old_machine_capital
		# FE
			building_ancient_control_center
			building_ancient_palace
			building_resort_capital
			building_slave_capital
		# Special regular
			building_resort_capital
			building_slave_capital
			#building_tec_sanctuary_capital
			#building_tec_necropolis_capital
			#building_tec_preserve_capital
			#building_tec_penal_capital
			#building_tec_heritage_capital
		# Special gestalt
	
	}

	allow = {
		num_pops >= @pops_t2
	}

	resources = {
		category = planet_buildings
		inline_script = {
			script = buildings/inline_evolved_resource_cost
			tier = 2
		}
	}

	triggered_desc = {
		text = tec_machine_production_capital_effects
	}

	planet_modifier = {
		planet_housing_add = 5
		planet_amenities_no_happiness_add = 10
		planet_jobs_complex_drone_produces_mult = 0.1
		planet_jobs_complex_drone_upkeep_mult = 0.1
		planet_max_buildings_add = @build_slots_t2
		planet_max_branch_office_buildings_add = @branch_slots_t1
	}


	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				has_valid_civic = civic_machine_servitor
			}
		}
		planet_bio_trophies_produces_mult = 0.1
	}
	inline_script = {
		script = capitals/inline_evolved_common_modifiers	
		tier = 2
	}
	
	inline_script = {
		script = capitals/inline_evolved_machine_capital
		tier = 2
	}
}

# Production Processor
building_tec_machine_production_major_capital = {
	base_buildtime = @b3_time
	capital = yes
	can_build = no
	can_demolish = no
	can_be_ruined = no
	can_be_disabled = no
	position_priority = 0		# Capital

	category = government
	
	prerequisites = {
		"tech_colonial_centralization"
	}

	show_tech_unlock_if = {
		always = no
	}

	upgrades = {
		building_tec_machine_production_system_capital
	}

	potential = {
		exists = owner
		owner = {
			OR = {
				is_machine_empire = yes
				is_country_type = ai_empire
			}
			is_fallen_empire = no
		}
		has_planet_flag = tec_replace_machine_capital_to_production
		tec_allows_machine_alt_capitals = yes
	}
	
	allow = {
		num_pops >= @pops_t3
	}

	destroy_trigger = {
		exists = owner
		OR = {
			owner = {
				is_machine_empire = no
			}
			NOT = {
				has_planet_flag = tec_replace_machine_capital_to_production
			}
			tec_allows_machine_alt_capitals = no
		}
	}

	on_destroy = {
		remove_planet_flag = tec_replace_machine_capital_to_extraction
	}

	convert_to = {
		# Regular
			building_major_capital
		# Hive
			building_hive_major_capital
			building_tec_cyberhive_major_capital
			building_tec_biohive_major_capital
		# Machine
			building_machine_major_capital
			#building_tec_machine_production_major_capital
			building_tec_machine_extraction_major_capital
			#building_tec_old_machine_major_capital
		# FE
			building_ancient_control_center
			building_ancient_palace
		# Special regular
			building_resort_major_capital
			building_slave_major_capital
			#building_tec_sanctuary_major_capital
			#building_tec_necropolis_major_capital
			#building_tec_preserve_major_capital
			#building_tec_penal_major_capital
			#building_tec_heritage_major_capital
		# Special gestalt

	}

	resources = {
		category = planet_buildings
		inline_script = {
			script = buildings/inline_evolved_resource_cost
			tier = 3
		}
	}

	triggered_desc = {
		text = tec_machine_production_capital_effects
	}

	planet_modifier = {
		planet_housing_add = 10
		planet_amenities_no_happiness_add = 15
		planet_jobs_complex_drone_produces_mult = 0.2
		planet_jobs_complex_drone_upkeep_mult = 0.2
		planet_max_buildings_add = @build_slots_t3
		planet_max_branch_office_buildings_add = @branch_slots_t2
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				has_valid_civic = civic_machine_servitor
			}
		}
		planet_bio_trophies_produces_mult = 0.2
	}

	inline_script = {
		script = capitals/inline_evolved_common_modifiers	
		tier = 3
	}
	inline_script = {
		script = capitals/inline_evolved_machine_capital
		tier = 3
	}
}

# Production Nexus
building_tec_machine_production_system_capital = {
	base_buildtime = @b4_time
	capital = yes
	can_build = no
	can_demolish = no
	can_be_ruined = no
	can_be_disabled = no

	category = government

	prerequisites = {
		"tech_galactic_administration"
	}

	show_tech_unlock_if = {
		always = no
	}

	upgrades = {
		building_tec_machine_production_galactic_capital
	}

	potential = {
		exists = owner
		owner = {
			OR = {
				is_machine_empire = yes
				is_country_type = ai_empire
			}
			is_fallen_empire = no
		}
		# Galactic emperor and etc trigger goes here
		tec_has_special_advanced_capital = no
		has_planet_flag = tec_replace_machine_capital_to_production
		tec_allows_machine_alt_capitals = yes
	}
	
	allow = {
		num_pops >= @pops_t4
	}

	destroy_trigger = {
		exists = owner
		OR = {
			owner = {
				is_machine_empire = no
			}
			NOT = {
				has_planet_flag = tec_replace_machine_capital_to_production
			}
			tec_allows_machine_alt_capitals = no
		}
	}

	on_destroy = {
		remove_planet_flag = tec_replace_machine_capital_to_extraction
	}

	convert_to = {
		# Regular
			building_galactic_capital
		# Hive
			building_hive_system_capital
			building_tec_cyberhive_system_capital
			building_tec_biohive_system_capital
		# Machine
			building_machine_system_capital
			#building_tec_machine_production_system_capital
			building_tec_machine_extraction_system_capital
			#building_tec_old_machine_system_capital
		# FE
			building_ancient_control_center
			building_ancient_palace
		# Special regular
			building_resort_major_capital
			building_slave_major_capital
			#building_tec_sanctuary_major_capital
			#building_tec_necropolis_major_capital
			#building_tec_preserve_major_capital
			#building_tec_penal_major_capital
			#building_tec_heritage_major_capital
		# Special gestalt

		# Imperial
			building_imperial_capital
			building_imperial_hive_capital
			building_imperial_machine_capital
	}

	resources = {
		category = planet_buildings
		inline_script = {
			script = buildings/inline_evolved_resource_cost
			tier = 4
		}
	}

	triggered_desc = {
		text = tec_machine_production_capital_effects
	}

	planet_modifier = {
		planet_housing_add = 15
		planet_amenities_no_happiness_add = 20
		planet_jobs_complex_drone_produces_mult = 0.3
		planet_jobs_complex_drone_upkeep_mult = 0.3
		planet_max_buildings_add = @build_slots_t4
		planet_max_branch_office_buildings_add = @branch_slots_t3
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				has_valid_civic = civic_machine_servitor
			}
		}
		planet_bio_trophies_produces_mult = 0.3
	}
	
	inline_script = {
		script = capitals/inline_evolved_common_modifiers	
		tier = 4
	}
	inline_script = {
		script = capitals/inline_evolved_machine_capital
		tier = 4
	}
}

# Production Core
building_tec_machine_production_galactic_capital = {
	base_buildtime = @b4_time
	capital = yes
	can_build = no
	can_demolish = no
	can_be_ruined = no
	can_be_disabled = no
	position_priority = 0		# Capital
	
	category = government

	prerequisites = {
		"tech_tec_imperial_coordination"
	}

	show_tech_unlock_if = {
		always = no
	}

	potential = {
		exists = owner
		owner = {
			OR = {
				is_machine_empire = yes
				is_country_type = ai_empire
				
			}
			is_fallen_empire = no
		}
		# Galactic emperor and etc trigger goes here
		tec_has_special_advanced_capital = no
		has_planet_flag = tec_replace_machine_capital_to_production
		tec_allows_machine_alt_capitals = yes
	}

	allow = {
		num_pops >= @pops_t5
	}

	destroy_trigger = {
		exists = owner
		OR = {
			owner = {
				is_machine_empire = no
			}
			NOT = {
				has_planet_flag = tec_replace_machine_capital_to_production
			}
			tec_allows_machine_alt_capitals = no
		}
	}

	on_destroy = {
		remove_planet_flag = tec_replace_machine_capital_to_extraction
	}

	convert_to = {
		# Regular
			building_system_capital
		# Hive
			building_hive_system_capital
			building_tec_cyberhive_system_capital
			building_tec_biohive_system_capital
		# Machine
			building_machine_system_capital
			#building_tec_machine_production_system_capital
			building_tec_machine_extraction_system_capital
			#building_tec_old_machine_system_capital
		# FE
			building_ancient_control_center
			building_ancient_palace
		# Special regular
			building_resort_major_capital
			building_slave_major_capital
			#building_tec_sanctuary_major_capital
			#building_tec_necropolis_major_capital
			#building_tec_preserve_major_capital
			#building_tec_penal_major_capital
			#building_tec_heritage_major_capital
		# Special gestalt

	}



	resources = {
		category = planet_buildings
		inline_script = {
			script = buildings/inline_evolved_resource_cost
			tier = 4
		}
	}

	triggered_desc = {
		text = tec_machine_production_capital_effects
	}

	planet_modifier = {
		planet_housing_add = 20
		planet_amenities_no_happiness_add = 25
		planet_jobs_complex_drone_produces_mult = 0.4
		planet_jobs_complex_drone_upkeep_mult = 0.4
		planet_max_buildings_add = @build_slots_t5
		planet_max_branch_office_buildings_add = @branch_slots_t4
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				has_valid_civic = civic_machine_servitor
			}
		}
		planet_bio_trophies_produces_mult = 0.4
	}

	inline_script = {
		script = capitals/inline_evolved_common_modifiers	
		tier = 5
	}
	inline_script = {
		script = capitals/inline_evolved_machine_capital
		tier = 5
	}
}

# - - - - - - - - - - - - - - - - - - - - - 
# Colony
building_tec_machine_extraction_deployment_post = {
	capital = yes
	can_build = no
	can_demolish = no
	can_be_ruined = no
	can_be_disabled = no
	position_priority = 0		# Capital

	category = government

	upgrades = {
		building_tec_machine_extraction_capital
	}

	potential = {
		exists = owner
		owner = {
			OR = {
				is_machine_empire = yes
				is_country_type = ai_empire
			}
			is_fallen_empire = no
		}
		has_planet_flag = tec_replace_machine_capital_to_extraction
		# Not an automatable planet
		tec_allows_machine_alt_capitals = yes
	}

	destroy_trigger = {
		exists = owner
		OR = {
			owner = {
				is_machine_empire = no
			}
			NOT = {
				has_planet_flag = tec_replace_machine_capital_to_extraction
			}
			# Not an automatable planet
			tec_allows_machine_alt_capitals = no
		}
	}

	on_destroy = {
		remove_planet_flag = tec_replace_machine_capital_to_extraction
	}

	convert_to = {
		# Regular
			building_colony_shelter
		# Hive
			building_tec_hive_sapling
			building_tec_cyberhive_sapling
			building_tec_biohive_sapling
		# Machine
			building_deployment_post
			building_tec_machine_production_deployment_post
			#building_tec_machine_extraction_deployment_post
			#building_tec_old_machine_deployment_post
		# FE
			building_ancient_control_center
			building_ancient_palace
		# Special regular
			building_resort_capital
			building_slave_capital
			#building_tec_sanctuary_capital
			#building_tec_necropolis_capital
			#building_tec_preserve_capital
			#building_tec_penal_capital
			#building_tec_heritage_capital
		# Special gestalt
	
	}
		
	resources = {
		category = planet_buildings
		upkeep = {
			energy = 1
		}
	}

	triggered_desc = {
		text = tec_machine_extraction_capital_effects
	}

	planet_modifier = {
		planet_housing_add = 5
		planet_amenities_add = 10
		planet_max_buildings_add = @build_slots_t1
	}

	inline_script = capitals/inline_evolved_colony
	inline_script = {
		script = capitals/inline_evolved_common_modifiers	
		tier = 1
	}
	inline_script = {
		script = capitals/inline_evolved_machine_capital
		tier = 1
	}

	ai_weight = {
		weight = 1
	}
}

# Extraction Array
building_tec_machine_extraction_capital = {
	base_buildtime = @b2_time
	capital = yes
	can_build = no
	can_demolish = no
	can_be_ruined = no
	can_be_disabled = no
	position_priority = 0		# Capital

	category = government

	prerequisites = {
		"tech_planetary_government"
	}

	show_tech_unlock_if = {
		always = no
	}
	
	upgrades = {
		building_tec_machine_extraction_major_capital
	}

	potential = {
		exists = owner
		owner = {
			OR = {
				is_machine_empire = yes
				is_country_type = ai_empire
				AND = {
					exists = event_target:mechanocalibrator_country
					is_same_value = event_target:mechanocalibrator_country
				}
			}
			is_fallen_empire = no
		}
		has_planet_flag = tec_replace_machine_capital_to_extraction
		tec_allows_machine_alt_capitals = yes
	}

	destroy_trigger = {
		exists = owner
		OR = {
			owner = {
				is_machine_empire = no
			}
			NOT = {
				has_planet_flag = tec_replace_machine_capital_to_extraction
			}
			# Not an automatable planet
			tec_allows_machine_alt_capitals = no
		}
	}

	on_destroy = {
		remove_planet_flag = tec_replace_machine_capital_to_extraction
	}

	convert_to = {
		# Regular
			building_capital
		# Hive
			building_hive_capital
			building_tec_cyberhive_capital
			building_tec_biohive_capital
		# Machine
			building_machine_capital
			building_tec_machine_production_capital
			#building_tec_machine_extraction_capital
			#building_tec_old_machine_capital
		# FE
			building_ancient_control_center
			building_ancient_palace
			building_resort_capital
			building_slave_capital
		# Special regular
			building_resort_capital
			building_slave_capital
			#building_tec_sanctuary_capital
			#building_tec_necropolis_capital
			#building_tec_preserve_capital
			#building_tec_penal_capital
			#building_tec_heritage_capital
		# Special gestalt
	
	}

	allow = {
		num_pops >= @pops_t2
	}

	resources = {
		category = planet_buildings
		inline_script = {
			script = buildings/inline_evolved_resource_cost
			tier = 2
		}
	}

	triggered_desc = {
		text = tec_machine_extraction_capital_effects
	}

	planet_modifier = {
		planet_housing_add = 5
		planet_amenities_no_happiness_add = 15
		planet_max_buildings_add = @build_slots_t2
		planet_max_branch_office_buildings_add = @branch_slots_t1
	}

	inline_script = {
		script = capitals/inline_evolved_common_modifiers	
		tier = 2
	}
	inline_script = {
		script = capitals/inline_evolved_machine_capital
		tier = 2
	}
}

# Extraction Processor
building_tec_machine_extraction_major_capital = {
	base_buildtime = @b3_time
	capital = yes
	can_build = no
	can_demolish = no
	can_be_ruined = no
	can_be_disabled = no
	position_priority = 0		# Capital

	category = government
	
	prerequisites = {
		"tech_colonial_centralization"
	}

	show_tech_unlock_if = {
		always = no
	}

	upgrades = {
		building_tec_machine_extraction_system_capital	
	}

	potential = {
		exists = owner
		owner = {
			OR = {
				is_machine_empire = yes
				is_country_type = ai_empire
			}
			is_fallen_empire = no
		}
		has_planet_flag = tec_replace_machine_capital_to_extraction
		tec_allows_machine_alt_capitals = yes
	}
	
	allow = {
		num_pops >= @pops_t3
	}

	destroy_trigger = {
		exists = owner
		OR = {
			owner = {
				is_machine_empire = no
			}
			NOT = {
				has_planet_flag = tec_replace_machine_capital_to_extraction
			}
			# Not an automatable planet
			tec_allows_machine_alt_capitals = no
		}
	}

	on_destroy = {
		remove_planet_flag = tec_replace_machine_capital_to_extraction
	}

	convert_to = {
		# Regular
			building_major_capital
		# Hive
			building_hive_major_capital
			building_tec_cyberhive_major_capital
			building_tec_biohive_major_capital
		# Machine
			building_machine_major_capital
			building_tec_machine_production_major_capital
			#building_tec_machine_extraction_major_capital
			#building_tec_old_machine_major_capital
		# FE
			building_ancient_control_center
			building_ancient_palace
		# Special regular
			building_resort_major_capital
			building_slave_major_capital
			#building_tec_sanctuary_major_capital
			#building_tec_necropolis_major_capital
			#building_tec_preserve_major_capital
			#building_tec_penal_major_capital
			#building_tec_heritage_major_capital
		# Special gestalt

	}

	resources = {
		category = planet_buildings
		inline_script = {
			script = buildings/inline_evolved_resource_cost
			tier = 3
		}
	}

	triggered_desc = {
		text = tec_machine_extraction_capital_effects
	}

	planet_modifier = {
		planet_housing_add = 10
		planet_amenities_no_happiness_add = 20
		planet_max_buildings_add = @build_slots_t3
		planet_max_branch_office_buildings_add = @branch_slots_t2
	}
	inline_script = {
		script = capitals/inline_evolved_common_modifiers	
		tier = 3
	}

	inline_script = {
		script = capitals/inline_evolved_machine_capital
		tier = 3
	}
}

# Extraction Nexus
building_tec_machine_extraction_system_capital = {
	base_buildtime = @b4_time
	capital = yes
	can_build = no
	can_demolish = no
	can_be_ruined = no
	can_be_disabled = no

	category = government

	prerequisites = {
		"tech_galactic_administration"
	}

	show_tech_unlock_if = {
		always = no
	}

	upgrades = {
		building_tec_machine_extraction_galactic_capital
	}

	potential = {
		exists = owner
		owner = {
			OR = {
				is_machine_empire = yes
				is_country_type = ai_empire
			}
			is_fallen_empire = no
		}
		# Galactic emperor and etc trigger goes here
		tec_has_special_advanced_capital = no
		has_planet_flag = tec_replace_machine_capital_to_extraction
		tec_allows_machine_alt_capitals = yes
	}
	
	allow = {
		num_pops >= @pops_t4
	}

	destroy_trigger = {
		exists = owner
		OR = {
			owner = {
				is_machine_empire = no
			}
			NOT = {
				has_planet_flag = tec_replace_machine_capital_to_extraction
			}
			# Not an automatable planet
			tec_allows_machine_alt_capitals = no
		}
	}

	on_destroy = {
		remove_planet_flag = tec_replace_machine_capital_to_extraction
	}

	convert_to = {
		# Regular
			building_system_capital
		# Hive
			building_hive_system_capital
			building_tec_cyberhive_system_capital
			building_tec_biohive_system_capital
		# Machine
			building_machine_system_capital
			building_tec_machine_production_system_capital
			#building_tec_machine_extraction_system_capital
			#building_tec_old_machine_system_capital
		# FE
			building_ancient_control_center
			building_ancient_palace
		# Special regular
			building_resort_major_capital
			building_slave_major_capital
			#building_tec_sanctuary_major_capital
			#building_tec_necropolis_major_capital
			#building_tec_preserve_major_capital
			#building_tec_penal_major_capital
			#building_tec_heritage_major_capital
		# Special gestalt

	}

	resources = {
		category = planet_buildings
		inline_script = {
			script = buildings/inline_evolved_resource_cost
			tier = 4
		}
	}

	triggered_desc = {
		text = tec_machine_extraction_capital_effects
	}

	planet_modifier = {
		planet_housing_add = 15
		planet_amenities_no_happiness_add = 25
		planet_max_buildings_add = @build_slots_t4
		planet_max_branch_office_buildings_add = @branch_slots_t3
	}

	inline_script = {
		script = capitals/inline_evolved_common_modifiers	
		tier = 4
	}
	inline_script = {
		script = capitals/inline_evolved_machine_capital
		tier = 4
	}
}

# Extraction Core
building_tec_machine_extraction_galactic_capital = {
	base_buildtime = @b4_time
	capital = yes
	can_build = no
	can_demolish = no
	can_be_ruined = no
	can_be_disabled = no
	position_priority = 0		# Capital
	
	category = government

	prerequisites = {
		"tech_tec_imperial_coordination"
	}

	show_tech_unlock_if = {
		always = no
	}

	potential = {
		exists = owner
		owner = {
			OR = {
				is_machine_empire = yes
				is_country_type = ai_empire
				
			}
			is_fallen_empire = no
		}
		# Galactic emperor and etc trigger goes here
		tec_has_special_advanced_capital = no
		has_planet_flag = tec_replace_machine_capital_to_extraction
		tec_allows_machine_alt_capitals = yes
	}

	allow = {
		num_pops >= @pops_t5
	}

	destroy_trigger = {
		exists = owner
		OR = {
			owner = {
				is_machine_empire = no
			}
			NOT = {
				has_planet_flag = tec_replace_machine_capital_to_extraction
			}
			# Not an automatable planet
			tec_allows_machine_alt_capitals = no
		}
	}

	on_destroy = {
		remove_planet_flag = tec_replace_machine_capital_to_extraction
	}

	convert_to = {
		# Regular
			building_galactic_capital
		# Hive
			building_hive_system_capital
			building_tec_cyberhive_system_capital
			building_tec_biohive_system_capital
		# Machine
			building_machine_system_capital
			building_tec_machine_production_system_capital
			#building_tec_machine_extraction_system_capital
			#building_tec_old_machine_system_capital
		# FE
			building_ancient_control_center
			building_ancient_palace
		# Special regular
			building_resort_major_capital
			building_slave_major_capital
			#building_tec_sanctuary_major_capital
			#building_tec_necropolis_major_capital
			#building_tec_preserve_major_capital
			#building_tec_penal_major_capital
			#building_tec_heritage_major_capital
		# Special gestalt

		# Imperial
			building_imperial_capital
			building_imperial_hive_capital
			building_imperial_machine_capital
	}


	resources = {
		category = planet_buildings
		inline_script = {
			script = buildings/inline_evolved_resource_cost
			tier = 4
		}
	}

	triggered_desc = {
		text = tec_machine_extraction_capital_effects
	}

	planet_modifier = {
		planet_housing_add = 20
		planet_amenities_no_happiness_add = 30
		planet_max_buildings_add = @build_slots_t5
		planet_max_branch_office_buildings_add = @branch_slots_t4
	}
	inline_script = {
		script = capitals/inline_evolved_common_modifiers	
		tier = 5
	}

	inline_script = {
		script = capitals/inline_evolved_machine_capital
		tier = 5
	}
}

# Genesis Array

# Genesis Preserve

# Genesis Core

# - - - - - - - - - - - - - - - - - - - - - 
# Old-Machine Capitals
# - - - - - - - - - - - - - - - - - - - - - 
# Note: Uses standard tile for the production and extraction alt machine capitals
# Uses old-machine set - names may change

# Colonization Ark
#building_tec_oldmachine_deployment_post
# Control Ark
#building_machine_capital
# Processing Ark
#building_machine_major_capital
# Nexus Ark
#building_machine_system_capital
# Alpha Ark
#building_machine_galactic_capital
# - - - - - - - - - - - - - - - - - - - - - 
# Galactic Imperium Capital
# Imperial Ark






# - For managing - ignore this
#T1 capitals - colony
	# Regular -----------------------------------
	#	building_colony_shelter
	#	building_tec_scifi_shelter
	#	building_tec_arkship_shelter
	# Hive --------------------------------------
	#	building_tec_hive_sapling
	#	building_tec_cyberhive_sapling
	#	building_tec_biohive_sapling
	#	building_tec_biomorph_hive_sapling
	#	building_tec_lithomorph_hive_sapling
	# Machine -----------------------------------
	#	building_deployment_post
	#	building_tec_old_machine_deployment_post
	# FE ----------------------------------------
	#	building_ancient_control_center
	#	building_ancient_palace

#T2 capitals - admin
	# Regular -----------------------------------
	#	building_capital
	#	building_tec_scifi_capital
	#	building_resort_capital
	#	building_slave_capital
	#	building_tec_sanctuary_capital
	#	building_tec_necropolis_capital
	#	building_tec_reserve_capital
	# Hive --------------------------------------
	#	building_hive_capital
	#	building_tec_cyberhive_capital
	#	building_tec_biohive_capital
	#	building_tec_biomorph_hive_capital
	#	building_tec_lithomorph_hive_capital
	# Machine -----------------------------------
	#	building_machine_capital
	#	building_tec_old_machine_capital
	# FE ----------------------------------------
	#	building_ancient_control_center
	#	building_ancient_palace

#T3 capitals
	# Regular -----------------------------------
	#	building_major_capital
	#	building_tec_scifi_major_capital
	#	building_resort_major_capital
	#	building_slave_major_capital
	#	building_tec_sanctuary_major_capital
	#	building_tec_necropolis_major_capital
	#	building_tec_reserve_major_capital
	# Hive --------------------------------------
	#	building_hive_major_capital
	#	building_tec_cyberhive_major_capital
	#	building_tec_biohive_major_capital
	#	building_tec_biomorph_hive_major_capital
	#	building_tec_lithomorph_hive_major_capital
	# Machine -----------------------------------
	#	building_machine_major_capital
	#	building_tec_old_machine_major_capital
	# FE ----------------------------------------
	#	building_ancient_control_center
	#	building_ancient_palace

#T4 capitals - starts swap of imperial
	# Regular -----------------------------------
	#	building_system_capital
	#	building_imperial_capital
	#	building_tec_scifi_system_capital
	#	building_tec_scifi_imperial_capital
	#	building_resort_major_capital
	#	building_slave_major_capital
	#	building_tec_sanctuary_major_capital
	#	building_tec_necropolis_major_capital
	#	building_tec_reserve_major_capital
	# Hive --------------------------------------
	#	building_hive_system_capital
	#	building_imperial_hive_capital
	#	building_tec_cyberhive_system_capital
	#	building_tec_cyberhive_imperial_capital
	#	building_tec_biohive_system_capital
	#	building_tec_biohive_imperial_capital
	#	building_tec_biomorph_hive_system_capital
	#	building_tec_biomorph_hive_imperial_capital
	#	building_tec_lithomorph_hive_system_capital
	#	building_tec_lithomorph_hive_imperial_capital
	# Machine -----------------------------------
	#	building_machine_system_capital
	#	building_imperial_machine_capital
	#	building_tec_old_machine_system_capital
	#	building_tec_old_machine_imperial_capital
	# FE ----------------------------------------
	#	building_ancient_control_center
	#	building_ancient_palace
	
#T5 capitals - Max
	# Regular -----------------------------------
	#	building_galactic_capital
	#	building_imperial_capital
	#	building_tec_scifi_galactic_capital
	#	building_tec_scifi_imperial_capital
	#	building_resort_major_capital
	#	building_slave_major_capital
	#	building_tec_sanctuary_major_capital
	#	building_tec_necropolis_major_capital
	#	building_tec_reserve_major_capital
	# Hive --------------------------------------
	#	building_hive_galactic_capital
	#	building_imperial_hive_capital
	#	building_tec_cyberhive_galactic_capital
	#	building_tec_cyberhive_imperial_capital
	#	building_tec_biohive_galactic_capital
	#	building_tec_biohive_imperial_capital
	#	building_tec_biomorph_hive_galactic_capital
	#	building_tec_biomorph_hive_imperial_capital
	#	building_tec_lithomorph_hive_galactic_capital
	#	building_tec_lithomorph_hive_imperial_capital
	# Machine -----------------------------------
	#	building_machine_galactic_capital
	#	building_imperial_machine_capital
	#	building_tec_old_machine_galactic_capital
	#	building_tec_old_machine_imperial_capital
	# FE ----------------------------------------
	#	building_ancient_control_center
	#	building_ancient_palace
	
#T6 capitals - Imperial to imperial
	# Regular -----------------------------------
	#	building_galactic_capital
	#	building_imperial_capital
	#	building_tec_scifi_galactic_capital
	#	building_tec_scifi_imperial_capital
	#	building_resort_major_capital
	#	building_slave_major_capital
	#	building_tec_sanctuary_major_capital
	#	building_tec_necropolis_major_capital
	#	building_tec_reserve_major_capital
	# Hive --------------------------------------
	#	building_hive_galactic_capital
	#	building_imperial_hive_capital
	#	building_tec_cyberhive_galactic_capital
	#	building_tec_cyberhive_imperial_capital
	#	building_tec_biohive_galactic_capital
	#	building_tec_biohive_imperial_capital
	#	building_tec_biomorph_hive_galactic_capital
	#	building_tec_biomorph_hive_imperial_capital
	#	building_tec_lithomorph_hive_galactic_capital
	#	building_tec_lithomorph_hive_imperial_capital
	# Machine -----------------------------------
	#	building_machine_galactic_capital
	#	building_imperial_machine_capital
	#	building_tec_old_machine_galactic_capital
	#	building_tec_old_machine_imperial_capital
	# FE ----------------------------------------
	#	building_ancient_control_center
	#	building_ancient_palace