### -------------------------------
##	COMPATIBILITY SCRIPTED TRIGGERS
### -------------------------------

## Planetary Diversity

tec_is_pd_regular_planet = {
	always = no
}

tec_is_pd_nonconventional_world = {
	# End my suffering please
	OR = {
		uses_district_set = @pdarchive
		uses_district_set = @pdecocity
		uses_district_set = @pdpalacearc
		uses_district_set = @pdplanethab	
		uses_district_set = @pdbioforge
		uses_district_set = @pdbiocapital
		uses_district_set = @pdmachinefactory
		uses_district_set = @pdmachinecapital
		uses_district_set = @pdfloraforge
		uses_district_set = @pdmilarc
		uses_district_set = @pdbiofort
		uses_district_set = @pdmachinefort
		uses_district_set = @pdcorpoarc
	}
}
tec_is_pd_nonconventional_nonfactory_world = {
	# End my suffering please
	OR = {
		uses_district_set = @pdarchive
		uses_district_set = @pdecocity
		uses_district_set = @pdpalacearc
		uses_district_set = @pdplanethab
		#uses_district_set = @pdbioforge
		uses_district_set = @pdbiocapital
		#uses_district_set = @pdmachinefactory
		uses_district_set = @pdmachinecapital
		#uses_district_set = @pdfloraforge
		uses_district_set = @pdmilarc
		uses_district_set = @pdbiofort
		uses_district_set = @pdmachinefort
		uses_district_set = @pdcorpoarc
	}
}
tec_is_pd_nonconventional_nonrefinery_world = {
	# End my suffering please
	OR = {
		uses_district_set = @pdarchive
		uses_district_set = @pdecocity
		uses_district_set = @pdpalacearc
		uses_district_set = @pdplanethab	
		uses_district_set = @pdbioforge
		uses_district_set = @pdbiocapital
		#uses_district_set = @pdmachinefactory
		uses_district_set = @pdmachinecapital
		uses_district_set = @pdfloraforge
		uses_district_set = @pdmilarc
		uses_district_set = @pdbiofort
		uses_district_set = @pdmachinefort
		uses_district_set = @pdcorpoarc
	}
}
tec_is_pd_nonconventional_nonresearch_world = {
	# End my suffering please
	OR = {
		uses_district_set = city_world
		uses_district_set = ring_world
		uses_district_set = habitat
		uses_district_set = @pdarchive
		uses_district_set = @pdecocity
		uses_district_set = @pdpalacearc
		uses_district_set = @pdplanethab	
		uses_district_set = @pdbiocapital
		uses_district_set = @pdmachinefactory
		uses_district_set = @pdmachinecapital
		uses_district_set = @pdmilarc
		uses_district_set = @pdcorpoarc
	}
}
tec_is_pd_nonconventional_nonfortress_world = {
	# End my suffering please
	OR = {
		uses_district_set = @pdarchive
		uses_district_set = @pdecocity
		uses_district_set = @pdpalacearc
		uses_district_set = @pdplanethab	
		uses_district_set = @pdbioforge
		uses_district_set = @pdmachinefactory
		uses_district_set = @pdfloraforge
		uses_district_set = @pdmilarc
		uses_district_set = @pdbiofort
		uses_district_set = @pdmachinefort
		uses_district_set = @pdcorpoarc
	}
}
tec_is_pd_ecu = {
	# End my suffering please
	OR = {
		uses_district_set = @pdecocity
		uses_district_set = @pdpalacearc
		uses_district_set = @pdmachinecapital
		uses_district_set = @pdmilarc
		uses_district_set = @pdmachinecapital
		uses_district_set = @pdcorpoarc
	}
}
tec_is_pd_ecu_with_research = {
	# End my suffering please
	OR = {
		uses_district_set = @pdecocity
		uses_district_set = @pdpalacearc
		uses_district_set = @pdmilarc
		uses_district_set = @pdcorpoarc
	}
}

tec_is_pd_ecu_machine = {
	# End my suffering please
	OR = {
		uses_district_set = @pdmachinefactory
		uses_district_set = @pdmachinefort
	}
}


		

tec_is_pd_special_arcology_planet = {
	OR = {
		is_planet_class = @pc_ecocity
		is_planet_class = @pc_archive
		is_planet_class = @pc_machine_factory
		is_planet_class = @pc_bioforge
		is_planet_class = @pc_pd_gas_giant_hab
		is_planet_class = @pc_pd_barren_hab
		is_planet_class = @pc_pd_barren_cold_hab
		is_planet_class = @pc_pd_frozen_hab
		is_planet_class = @pc_pd_molten_hab
		is_planet_class = @pc_pd_toxic_hab
		is_planet_class = @pc_pd_hothouse_hab
	}
}

tec_is_pd_aquatic_planet = {
	OR = {
		is_planet_class = pc_ocean
		is_planet_class = @pc_aquatic
		is_planet_class = @pc_reef
		is_planet_class = @pc_desertislands
		is_planet_class = @pc_subarctic
	}
}

tec_has_pd_aquatic_planet_preference = {
	OR = {
		has_trait = trait_pc_ocean_preference
		has_trait = @trait_pc_aquatic_preference
		has_trait = @trait_pc_reef_preference
		has_trait = @trait_pc_desertislands_preference
		has_trait = @trait_pc_subarctic_preference
	}
}

tec_is_pd_special_arcology_planet_rural = {
	OR = {
		is_planet_class = @pc_pdhive1
		is_planet_class = @pc_pdhive2
		is_planet_class = @pc_ecocity
		is_planet_class = @pc_archive
		is_planet_class = @pc_machine_factory
		is_planet_class = @pc_bioforge
		is_planet_class = @pc_pd_gas_giant_hab
		is_planet_class = @pc_pd_barren_hab
		is_planet_class = @pc_pd_barren_cold_hab
		is_planet_class = @pc_pd_frozen_hab
		is_planet_class = @pc_pd_molten_hab
		is_planet_class = @pc_pd_toxic_hab
		is_planet_class = @pc_pd_hothouse_hab
	}
}


tec_is_pd_special_arcology_planet_rural_uncapped = {
	OR = {
		is_planet_class = @pc_pdhive1
		is_planet_class = @pc_pdhive2
	}
}

tec_is_pd_habitat_mimic_planet = {
	# for planetary colony habitats
	OR = {
		uses_district_set = @pdarchive
		uses_district_set = @giga_habitat
		uses_district_set = @pdplanethab
	}
}

tec_is_pd_habitat_planet = {
	# for planetary colony habitats
	OR = {
		uses_district_set = @pdplanethab
		uses_district_set = @pdarchive
		tec_is_pd_habitat_mimic_planet = yes
	}
}

tec_uses_regular_capital_override = {
	# w h y
	OR = {
		uses_district_set = @pdarchive
		uses_district_set = @giga_habitat
	}
}

tec_uses_habitat_capital_override = {
	# for planetary colony habitats
	OR = {

	}
}

tec_is_pd_void_neutral_planets = {
	# for planetary colony habitats
	OR = {
		has_modifier = pm_tec_ecoworld_planet
		is_planet_class = @pc_ecocity
		is_planet_class = @pc_archive
	}
}

tec_is_pd_city_planet = {
	OR = {
		is_pd_arcology = yes
		is_pd_hive_arcology = yes
		is_pd_robot_arcology = yes
	}
}

tec_is_pd_exotic_planets = {
	#INSERT
	OR = {
		is_pd_exotic = yes
	}
}

tec_is_pd_perfect_planets = {
	# for planetary perfect planets
	OR = {
		is_pd_unique = yes
		is_planet_class = @pc_pdshroud
	#	tec_is_pd_exotic_planets = yes
	}
}

tec_is_modded_uncapped_planet= {
	OR = {
		has_modifier = @pleasure_palace
		uses_district_set = @giga_alderson
		uses_district_set = @giga_birch
	}

}

tec_is_modded_space_arcology = {
	OR = {
		uses_district_set = @giga_alderson
		uses_district_set = @giga_birch
		uses_district_set = @giga_planet
	}
}


	# New arcologies
tec_pd_arcology_housing_trigger = {
	OR = {
		uses_district_set = @pdecocity
		uses_district_set = @pdmilarc
		uses_district_set = @pdcorpoarc
	}
}

tec_pd_arcology_arms_trigger = {
	uses_district_set = @pdmilarc
}

tec_pd_arcology_leisure_trigger = {
	OR = {
		uses_district_set = @pdecocity
		uses_district_set = @pdmilarc
		uses_district_set = @pdcorpoarc
	}
}

tec_pd_arcology_organic_housing_trigger = {
	OR = {
		uses_district_set = @pdecocity
		uses_district_set = @pdmilarc
	}
}

tec_pd_arcology_administrative_trigger = {
	OR = {
		uses_district_set = @pdecocity
		uses_district_set = @pdcorpoarc
		uses_district_set = @pdmilarc
	}
}

tec_pd_arcology_religious_trigger = {
	OR = {
		uses_district_set = @pdecocity
		uses_district_set = @pdcorpoarc
		uses_district_set = @pdmilarc
	}
}


# PSE compatibility
pse_species_is_psionic = { #species scope
	species = {
		OR = {
			# Vanilla
			has_trait = trait_latent_psionic
			has_trait = trait_psionic
			# Evolved
			tec_is_any_psionic_species = yes
		}
	}
}

pse_leader_is_psionic = { #use at leader scope
	OR = {
		has_trait = leader_trait_admiral_psionic
		has_trait = leader_trait_general_psionic
		has_trait = leader_trait_governor_psionic
		has_trait = leader_trait_scientist_psionic
		has_trait = leader_trait_ruler_psionic
		has_trait = leader_trait_admiral_chosen
		has_trait = leader_trait_general_chosen
		has_trait = leader_trait_governor_chosen
		has_trait = leader_trait_scientist_chosen
		has_trait = leader_trait_ruler_chosen

		# Evolved
		tec_is_psionic_leader = yes
	}
}



# BSW2 COMPATIBILITY

# checks whether an empire may research tesla weapons : requires machine or synthetically-ascended empire
ESC_TRIGGER_may_research_tesla_weapons = {
	OR = {
		has_country_flag = ESC_COUNTRY_FLAG_mod_allow_tesla_weapons
		is_machine_empire = yes
		NOT = { host_has_dlc = "Utopia" }
		AND = {
			host_has_dlc = "Utopia"
			OR = {
				has_ascension_perk = ap_synthetic_evolution
				#evolved
					has_ascension_perk = ap_tec_replicant
				# /
			}
		}
	}
}

# checks whether an empire may research cybernetically-augmented amoeba : requires machine or cybernetic empire
ESC_TRIGGER_may_research_cybernetic_amoeba = {
	OR = {
		has_country_flag = ESC_COUNTRY_FLAG_mod_allow_cybernetic_amoeba
		is_machine_empire = yes
		NOT = { host_has_dlc = "Utopia" }
		AND = {
			host_has_dlc = "Utopia"
			tec_has_cybernetic_ascension_path = yes
		}
	}
}

# checks whether a machine empire can do special project to research psionics
ESC_TRIGGER_can_do_machine_psionics_special_project = {
	is_machine_empire = yes
	any_owned_pop = {
		is_being_purged = no
		is_enslaved = no
		OR = {
			has_trait = trait_psionic
			has_trait = trait_latent_psionic
			# Evolved
				tec_is_any_psionic_species = yes
			# /	
		}
	}
}

# checks whether an empire may research basic psionic weapons : must know about psionics
ESC_TRIGGER_may_research_psionic_weapons_basic = {
	OR = {
		has_technology = tech_psionic_theory
		is_hive_empire = yes # hive minds are canonically psionic
		has_country_flag = ESC_COUNTRY_FLAG_machine_psionics
		has_ascension_perk = @MRE_psi_machine_ap
		has_country_flag = ESC_COUNTRY_FLAG_mod_allow_basic_psionic_weapons
	}
}

# checks whether an empire may research advanced psionic weapons : must be psionically ascended
ESC_TRIGGER_may_research_psionic_weapons_advanced = {
	OR = {
		has_country_flag = ESC_COUNTRY_FLAG_mod_allow_advanced_psionic_weapons
		has_ascension_perk = @FQ_Ompnipresence
		has_ascension_perk = @MRE_psi_machine_ap
		AND = {
			NOT = { host_has_dlc = "Utopia" }
			is_gestalt = no
		}
		AND = {
			host_has_dlc = "Utopia"
			OR = {
				has_tradition = tr_psionics_finish
				# Evolved
					has_ascension_perk = ap_tec_cyberpsionic
					has_ascension_perk = ap_tec_biopsionic
				# /
			}
		}
	}
}


# checks whether an empire may research advanced nanite weapons : must be machine or cybernetic
ESC_TRIGGER_may_research_nanite_weapons_advanced = {
	# NOT = { has_global_flag = ESC_GLOBAL_FLAG_nanite_technology_fobidden }
	OR = {
		has_country_flag = ESC_COUNTRY_FLAG_mod_allow_advanced_nanite_weapons
		is_machine_empire = yes
		NOT = { host_has_dlc = "Utopia" }
		AND = {
			host_has_dlc = "Utopia"
			tec_has_cybernetic_ascension_path = yes
		}
	}
}


# Other E&C / Bug branch comps
is_anthropocentric = {
	OR = {
		has_ethic = @ethic_anthropocentric
		has_ethic = @ethic_fanatic_anthropocentric
		is_industrialist = yes
	}
}

is_ecocentric = {
	OR = {
		has_ethic = @ethic_ecocentric
		has_ethic = @ethic_fanatic_ecocentric
		is_ecologist = yes
	}
}

is_competitive = {
	OR = {
		has_ethic = @ethic_competitive
		has_ethic = @ethic_fanatic_competitive
		is_competitive = yes
	}
}

is_cooperative = {
	OR = {
		has_ethic = @ethic_cooperative
		has_ethic = @ethic_fanatic_cooperative
		is_cooperative = yes
	}
}

